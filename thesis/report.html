<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>TeXtidote analysis</title>
<style type="text/css">
body {
  font-family: sans-serif;
}
.highlight, .highlight-sh, .highlight-spelling {
  padding: 2pt;
  border-radius: 4pt;
  cursor: help;
  opacity: 0.7;
  border: dashed 1px;
}
.highlight {
  background-color: orange;
  color: black;
}
.highlight-sh {
  background-color: yellow;
  color: black;
}
.highlight-spelling {
  background-color: red;
  color: white;
}
div.original-file {
  font-family: monospace;
  font-size: 11pt;
  background-color: #f8f8ff;
  padding: 20pt;
  border-radius: 6pt;
}
.textidote {
  	background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiICAgd2lkdGg9IjEwMC4wOTEwNW1tIiAgIGhlaWdodD0iMTguMjA5MDk5bW0iICAgdmlld0JveD0iMCAwIDEwMC4wOTEwNSAxOC4yMDkwOTkiICAgdmVyc2lvbj0iMS4xIiAgIGlkPSJzdmc4IiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IiAgIHNvZGlwb2RpOmRvY25hbWU9InRleHRpZG90ZS5zdmciPiAgPGRlZnMgICAgIGlkPSJkZWZzMiIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIGlkPSJiYXNlIiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiICAgICBib3JkZXJvcGFjaXR5PSIxLjAiICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIgICAgIGlua3NjYXBlOnpvb209IjEiICAgICBpbmtzY2FwZTpjeD0iLTI1NC4yNTMwOSIgICAgIGlua3NjYXBlOmN5PSItMjc4LjM3NTkxIiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9Im1tIiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIiAgICAgc2hvd2dyaWQ9ImZhbHNlIiAgICAgZml0LW1hcmdpbi10b3A9IjAiICAgICBmaXQtbWFyZ2luLWxlZnQ9IjAiICAgICBmaXQtbWFyZ2luLXJpZ2h0PSIwIiAgICAgZml0LW1hcmdpbi1ib3R0b209IjAiICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDIxIiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMjY1IiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIgLz4gIDxtZXRhZGF0YSAgICAgaWQ9Im1ldGFkYXRhNSI+ICAgIDxyZGY6UkRGPiAgICAgIDxjYzpXb3JrICAgICAgICAgcmRmOmFib3V0PSIiPiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+ICAgICAgICA8ZGM6dHlwZSAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4gICAgICAgIDxkYzp0aXRsZSAvPiAgICAgIDwvY2M6V29yaz4gICAgPC9yZGY6UkRGPiAgPC9tZXRhZGF0YT4gIDxnICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIgICAgIGlua3NjYXBlOmdyb3VwbW9kZT0ibGF5ZXIiICAgICBpZD0ibGF5ZXIxIiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI5LjczODA5NSwtNzAuNTc3NzUxKSI+ICAgIDxnICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjIwLjkyODk0NTU0cHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45Nzc1MzgyMztzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIgICAgICAgaWQ9InRleHQ4MzYiPiAgICAgIDxwYXRoICAgICAgICAgZD0ibSAzMC43MjY4NjQsNzEuNTY2NTIgNS4yMzIyMzYsMCAwLDQuMjA5MDQ0IDUuODEzNTk2LDAgMCwzLjYwNDQyOSAtNS44MTM1OTYsMCAwLDQuODEzNjU4IDUuODEzNTk2LDAgMCwzLjYwNDQyOSAtMTEuMDQ1ODMyLDAgMCwtMTYuMjMxNTYgeiIgICAgICAgICBzdHlsZT0iZm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDtmb250LWZhbWlseTpUdXRvcjstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOlR1dG9yO2ZpbGw6I2ZmZmZmZjtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45Nzc1MzgyMztzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIgICAgICAgICBpZD0icGF0aDMzODYiIC8+ICAgICAgPHBhdGggICAgICAgICBkPSJtIDQyLjMzNTg4OCw3NS43NzU1NjQgMTEuMDQ1ODMyLDAgMCw3LjgxMzQ3MyAtNS44MTM1OTYsMCAwLDAuNjA0NjE0IDUuODEzNTk2LDAgMCwzLjYwNDQyOSAtMTEuMDQ1ODMyLDAgMCwtMTIuMDIyNTE2IHogbSA1LjIzMjIzNiw0LjIwOTA0MyAwLjU4MTM2LDAgMCwtMC42MDQ2MTQgLTAuNTgxMzYsMCAwLDAuNjA0NjE0IHoiICAgICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7Zm9udC1mYW1pbHk6VHV0b3I7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpUdXRvcjtmaWxsOiNmZmZmZmY7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTc3NTM4MjM7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmUiICAgICAgICAgaWQ9InBhdGgzMzg4IiAvPiAgICAgIDxwYXRoICAgICAgICAgZD0ibSA1My45NDQ5MTIsNzUuNzc1NTY0IDUuMjMyMjM2LDAgMCwzLjYwNDQyOSAtNS4yMzIyMzYsMCAwLC0zLjYwNDQyOSB6IG0gNS44MTM1OTYsMCA1LjIzMjIzNiwwIDAsMy42MDQ0MjkgLTUuMjMyMjM2LDAgMCwtMy42MDQ0MjkgeiBtIC01LjgxMzU5Niw4LjQxODA4NyA1LjIzMjIzNiwwIDAsMy42MDQ0MjkgLTUuMjMyMjM2LDAgMCwtMy42MDQ0MjkgeiBtIDUuODEzNTk2LDAgNS4yMzIyMzYsMCAwLDMuNjA0NDI5IC01LjIzMjIzNiwwIDAsLTMuNjA0NDI5IHoiICAgICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7Zm9udC1mYW1pbHk6VHV0b3I7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpUdXRvcjtmaWxsOiNmZmZmZmY7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTc3NTM4MjM7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmUiICAgICAgICAgaWQ9InBhdGgzMzkwIiAvPiAgICAgIDxwYXRoICAgICAgICAgZD0ibSA2NS41NTM5MzYsNzEuNTY2NTIgNS4yMzIyMzYsMCAwLDQuMjA5MDQ0IDUuODEzNTk2LDAgMCwzLjYwNDQyOSAtNS44MTM1OTYsMCAwLDQuODEzNjU4IDUuODEzNTk2LDAgMCwzLjYwNDQyOSAtMTEuMDQ1ODMyLDAgMCwtMTYuMjMxNTYgeiIgICAgICAgICBzdHlsZT0iZm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDtmb250LWZhbWlseTpUdXRvcjstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOlR1dG9yO2ZpbGw6I2ZmZmZmZjtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45Nzc1MzgyMztzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIgICAgICAgICBpZD0icGF0aDMzOTIiIC8+ICAgICAgPHBhdGggICAgICAgICBkPSJtIDc3LjE2Mjk2LDc1Ljc3NTU2NCA1LjIzMjIzNiwwIDAsMTIuMDIyNTE2IC01LjIzMjIzNiwwIDAsLTEyLjAyMjUxNiB6IG0gMCwtNC4yMDkwNDQgNS4yMzIyMzYsMCAwLDMuNjA0NDMgLTUuMjMyMjM2LDAgMCwtMy42MDQ0MyB6IiAgICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtZmFtaWx5OlR1dG9yOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246VHV0b3I7ZmlsbDojZmZmZmZmO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk3NzUzODIzO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lIiAgICAgICAgIGlkPSJwYXRoMzM5NCIgLz4gICAgICA8cGF0aCAgICAgICAgIGQ9Im0gODIuOTY3NDcyLDc1Ljc3NTU2NCA1LjgxMzU5NiwwIDAsLTQuMjA5MDQ0IDUuMjMyMjM2LDAgMCwxNi4yMzE1NiAtMTEuMDQ1ODMyLDAgMCwtMTIuMDIyNTE2IHogbSA1LjIzMjIzNiw4LjQxODA4NyAwLjU4MTM2LDAgMCwtNC44MTM2NTggLTAuNTgxMzYsMCAwLDQuODEzNjU4IHoiICAgICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7Zm9udC1mYW1pbHk6VHV0b3I7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpUdXRvcjtmaWxsOiNmZmZmZmY7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTc3NTM4MjM7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmUiICAgICAgICAgaWQ9InBhdGgzMzk2IiAvPiAgICAgIDxwYXRoICAgICAgICAgZD0ibSA5NC41NzY0OTYsNzUuNzc1NTY0IDExLjA0NTgzNCwwIDAsMTIuMDIyNTE2IC0xMS4wNDU4MzQsMCAwLC0xMi4wMjI1MTYgeiBtIDUuMjMyMjM3LDguNDE4MDg3IDAuNTgxMzU3LDAgMCwtNC44MTM2NTggLTAuNTgxMzU3LDAgMCw0LjgxMzY1OCB6IiAgICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtZmFtaWx5OlR1dG9yOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246VHV0b3I7ZmlsbDojZmZmZmZmO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk3NzUzODIzO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lIiAgICAgICAgIGlkPSJwYXRoMzM5OCIgLz4gICAgICA8cGF0aCAgICAgICAgIGQ9Im0gMTA2LjE4NTUyLDcxLjU2NjUyIDUuMjMyMjQsMCAwLDQuMjA5MDQ0IDUuODEzNTksMCAwLDMuNjA0NDI5IC01LjgxMzU5LDAgMCw0LjgxMzY1OCA1LjgxMzU5LDAgMCwzLjYwNDQyOSAtMTEuMDQ1ODMsMCAwLC0xNi4yMzE1NiB6IiAgICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtZmFtaWx5OlR1dG9yOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246VHV0b3I7ZmlsbDojZmZmZmZmO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk3NzUzODIzO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lIiAgICAgICAgIGlkPSJwYXRoMzQwMCIgLz4gICAgICA8cGF0aCAgICAgICAgIGQ9Im0gMTE3Ljc5NDU0LDc1Ljc3NTU2NCAxMS4wNDU4NCwwIDAsNy44MTM0NzMgLTUuODEzNiwwIDAsMC42MDQ2MTQgNS44MTM2LDAgMCwzLjYwNDQyOSAtMTEuMDQ1ODQsMCAwLC0xMi4wMjI1MTYgeiBtIDUuMjMyMjQsNC4yMDkwNDMgMC41ODEzNiwwIDAsLTAuNjA0NjE0IC0wLjU4MTM2LDAgMCwwLjYwNDYxNCB6IiAgICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtZmFtaWx5OlR1dG9yOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246VHV0b3I7ZmlsbDojZmZmZmZmO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk3NzUzODIzO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lIiAgICAgICAgIGlkPSJwYXRoMzQwMiIgLz4gICAgPC9nPiAgPC9nPjwvc3ZnPg==);
}
h2.filename {
  font-family: monospace;
}
h1.textidote {
  width: 378px;
  height: 68px;
  display: block;
}
.keyword1 {
  font-weight: bold;
  color: green;
}
.keyword2 {
  font-weight: bold;
  color: darkblue;
}
.comment, .comment * {
  color: darkred;
  font-weight: normal;
}
.linenb {
  font-style: italic;
  color: lightgrey;
  width: 30pt;
  float: left;
  margin-top: 1pt;
  margin-bottom: 1pt;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.codeline {
  margin-left: -30pt;
  padding-left: 60pt;
  margin-top: 1pt;
  margin-bottom: 1pt;
}
.no-text {
  display: none;
}
.clear {
  clear: both;
}
</style>
</head>
<body>
<a href="https://sylvainhalle.github.io/textidote"><h1 class="textidote"><span class="no-text">Results of TeXtidote analysis</span></h1></a>
<p>Here is the result of analyzing your file(s) with TeXtidote. Hover the mouse over highlighted portions of the document to read a tooltip that gives you some writing advice.</p>
<h2 class="filename">tex/technologies.tex</h2>

<p>Found 2 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;1</div><div class="codeline"><span class="keyword1">\section</span> {Technologies}</div><div class="clear"></div>
<div class="linenb">&nbsp;2</div><div class="codeline">The following sections provide an overview of all the technologies used in the creation of the new emulators.</div><div class="clear"></div>
<div class="linenb">&nbsp;3</div><div class="codeline">Furthermore, a rationale is given for the choice of these technologies over alternatives.</div><div class="clear"></div>
<div class="linenb">&nbsp;4</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;5</div><div class="codeline"><span class="keyword1">\subsection</span>{WebAssembly}</div><div class="clear"></div>
<div class="linenb">&nbsp;6</div><div class="codeline">WebAssembly (Wasm) is a binary instruction format for a stack-based virtual machine. It is designed as a portable compilation target for programming languages, enabling the use of traditionally native languages such as C/C++ or Rust for web development.~\cite{wasmweb}</div><div class="clear"></div>
<div class="linenb">&nbsp;7</div><div class="codeline">Wasm, however, is not a replacement for JavaScript in its entirety.</div><div class="clear"></div>
<div class="linenb">&nbsp;8</div><div class="codeline">Rather, it is intended to complement JavaScript by being used to implement the computationally intensive parts of web applications, while all parts related to DOM manipulation and event handling continue to be written in JavaScript.</div><div class="clear"></div>
<div class="linenb">&nbsp;9</div><div class="codeline">It is being developed as a Web standard by the W3C WebAssembly Working Group, in which all major browser vendors are active participants~\cite{wasmmdn}.</div><div class="clear"></div>
<div class="linenb">10</div><div class="codeline">This makes Wasm code very portable between different browsers.</div><div class="clear"></div>
<div class="linenb">11</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">12</div><div class="codeline"><span class="keyword1">\subsection</span>{Rust}</div><div class="clear"></div>
<div class="linenb">13</div><div class="codeline">Rust is a multi-paradigm programming language that tries to combine high-level ergonomics with low-level control. \cite[Introduction]{klabnik2019rust}</div><div class="clear"></div>
<div class="linenb">14</div><div class="codeline">Besides being able to compile to native machine code, Rust is also capable of targeting Wasm as a platform, which makes it possible to use Rust for web development~\cite{rustwasm}.</div><div class="clear"></div>
<div class="linenb">15</div><div class="codeline">Just like C and C++, Rust does not use garbage collection at runtime by default, but unlike those languages, the programmer does not have to explicitly free the memory either.</div><div class="clear"></div>
<div class="linenb">16</div><div class="codeline">It instead relies on its compiler to automatically insert the necessary cleanup code. This is made possible by the ownership system, which tracks the lifetime of every reference in the program and ensures that nothing can be used after it has been deallocated.</div><div class="clear"></div>
<div class="linenb">17</div><div class="codeline">To achieve this, the compiler must enforce a set of rules whose violation results in a compilation error~\cite[<span class="highlight-sh" title="Do not refer to chapters using hard-coded numbers. Use \ref instead. [sh:hccha]">Chapter~4</span>]{klabnik2019rust}.</div><div class="clear"></div>
<div class="linenb">18</div><div class="codeline">With this unique approach, the same performance as C/C++ can be achieved without compromising memory safety.</div><div class="clear"></div>
<div class="linenb">19</div><div class="codeline">There are drawbacks to it, however: When more rules are imposed on the programmer, writing and especially refactoring code tends to become more tedious, since a simple change from an owned object to a reference in Rust often requires inserting explicit lifetimes into large portions of the code base.</div><div class="clear"></div>
<div class="linenb">20</div><div class="codeline">Despite this, Rust is the most popular language in the annual Stack Overflow developer survey for the seventh year in a row, suggesting that programmers are willing to trade some ease of use in writing for fewer memory-related bugs and vulnerabilities~\cite{sosurvey}.</div><div class="clear"></div>
<div class="linenb">21</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">22</div><div class="codeline"><span class="keyword1">\subsection</span>{The advantages of Rust and WebAssembly over JavaScript}</div><div class="clear"></div>
<div class="linenb">23</div><div class="codeline">WebAssembly offers significant performance improvements over JavaScript, often reaching execution times within 10\% of native code. Even the optimized subset of JavaScript known as \verb+asm.js+ is on average 33.7\% slower than Wasm~\cite[<span class="highlight-sh" title="Do not refer to chapters using hard-coded numbers. Use \ref instead. [sh:hccha]">Chapter~7</span>.3]{wasmspeed}.</div><div class="clear"></div>
<div class="linenb">24</div><div class="codeline">The advantages are not limited to performance, but also include the ability to use Rust's powerful and versatile type system on the web.</div><div class="clear"></div>
<div class="linenb">25</div><div class="codeline">This type system, inspired by ML and Haskell~\cite{rustinfluences}, provides programmers with a variety of ways to specify and limit the capabilities of certain types in their applications.</div><div class="clear"></div>
<div class="linenb">26</div><div class="codeline">It enables detection and prevention of entire classes of errors at compile time, drastically reducing the amount of end-to-end testing required. Research has shown that 15\% of errors in public JavaScript projects could have been prevented by a static type system~\cite{7985711}.</div><div class="clear"></div>
<div class="linenb">27</div><div class="codeline">This research was based on a direct extension of JavaScript with a type system, but it is reasonable to assume that a language fundamentally built around such a type system would benefit as much or even more.</div><div class="clear"></div>
<div class="linenb">28</div><div class="codeline">Some features in Rust's type system are especially valuable for writing emulators, namely Enums, Pattern Matching and Traits, whose influences on the design of the final application will be explained in further detail in \cref{implementation}.</div><div class="clear"></div>
<div class="linenb">29</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">30</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">31</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Performance</span></span></div><div class="clear"></div>
<div class="linenb">32</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Stability und reliability through the rich typesystem and ownership model</span></span></div><div class="clear"></div>
<div class="linenb">33</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> useful language features: Enums, Pattern Matching and Traits</span></span></div><div class="clear"></div>
<div class="linenb">34</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> https://dl.acm.org/doi/abs/10.1145/3062341.3062363</span></span></div><div class="clear"></div>
<div class="linenb">35</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> type system: inspired by ML and Haskell (https://doc.rust-lang.org/reference/influences.html)</span></span></div><div class="clear"></div>
<div class="linenb">36</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">37</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">38</div><div class="codeline"><span class="keyword1">\subsection</span>{The advantages of Rust over other WebAssembly languages} <span class="keyword1">\label</span>{rust-vs-other-wasm}</div><div class="clear"></div>
<div class="linenb">39</div><div class="codeline">Although Rust is relatively new as a language and its version 1.0 was only released in 2015~\cite{rustreleases}, it has already gained a lot of traction in the WebAssembly community.</div><div class="clear"></div>
<div class="linenb">40</div><div class="codeline">There are several reasons for this. Rust tries to strike a balance between high-level programming language accessibility and low-level performance.</div><div class="clear"></div>
<div class="linenb">41</div><div class="codeline">Due to its low-level nature and relatively small runtime without a garbage collector, it is very well suited for running in the browser.</div><div class="clear"></div>
<div class="linenb">42</div><div class="codeline">Other high-level languages would have to load their entire runtime when the site is loaded, since Wasm itself does not contain any memory management abstractions and instead lets the module manage a simple linear memory buffer.</div><div class="clear"></div>
<div class="linenb">43</div><div class="codeline">Complex runtime environments such as the Java Virtual Machine (JVM) would consequently lead to enormous package sizes and long loading screens.</div><div class="clear"></div>
<div class="linenb">44</div><div class="codeline">Languages that can run in constrained environments without virtual machines are therefore more suitable for this use case.</div><div class="clear"></div>
<div class="linenb">45</div><div class="codeline">That being said, Rust also offers advantages over other low-level languages such as C. Thanks to its emphasis on compiler-checked security guarantees, it offers a lower barrier to entry than C, while providing users with the same or even better performance~\cite{medin2021performance}.</div><div class="clear"></div>
<div class="linenb">46</div><div class="codeline">Like C++, Rust contains a more feature-rich standard library than C, with commonly used collections such as Vectors, equivalent to Java's ArrayList, and HashMaps.</div><div class="clear"></div>
<div class="linenb">47</div><div class="codeline">Rust is therefore very well suited for Wasm development and as a result has developed a strong ecosystem of libraries to support it in this area~\ref{rust-deps}.</div><div class="clear"></div>
<div class="linenb">48</div><div class="codeline">The combination of a language that is inherently suited to Wasm development, and the strong community behind it, gives Rust several important advantages over its competitors for this project.</div><div class="clear"></div>
<div class="linenb">49</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">50</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">51</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Performance and Bundle size (no GC, small runtime)</span></span></div><div class="clear"></div>
<div class="linenb">52</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> stable ecosystem: wasm-bindgen, web-sys, console\_error\_panic\_hook</span></span></div><div class="clear"></div>
<div class="linenb">53</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> stable language (multiple major releases, backwards compatibility)</span></span></div><div class="clear"></div>
<div class="linenb">54</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> safer than C/C++ https://msrc-blog.microsoft.com/2019/07/16/a-proactive-approach-to-more-secure-code/</span></span></div><div class="clear"></div>
<div class="linenb">55</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> good tooling: Cargo, Great error messages, editor support</span></span></div><div class="clear"></div>
<div class="linenb">56</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">57</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">58</div><div class="codeline"><span class="keyword1">\subsection</span>{ReactJS} <span class="keyword1">\label</span>{react-js}</div><div class="clear"></div>
<div class="linenb">59</div><div class="codeline">The modern web offers a seemingly infinite number of ways to create complex user experiences in the browser, most of which are built in JavaScript.</div><div class="clear"></div>
<div class="linenb">60</div><div class="codeline">Yet, the nature of this project would have allowed for an implementation without hand-written JavaScript.</div><div class="clear"></div>
<div class="linenb">61</div><div class="codeline">Since large portions of the project are written in Rust and compiled to WebAssembly, it would have been possible to simply render the entire application, including the interactive user interface, into a single canvas that also contains the screen.</div><div class="clear"></div>
<div class="linenb">62</div><div class="codeline">However, this is not optimal, because many features that the web browser inherently offers would not have been available, such as rearranging components to fit the width of the window, zooming into content to increase font size, supporting screen readers, etc.</div><div class="clear"></div>
<div class="linenb">63</div><div class="codeline">An alternative approach would have been to use the features provided by the browser, but interact with them directly from Rust.</div><div class="clear"></div>
<div class="linenb">64</div><div class="codeline">Yew is a Rust framework that would have made this process possible. It allows the programmer to use a component-based, responsive front-end architecture in Rust.</div><div class="clear"></div>
<div class="linenb">65</div><div class="codeline">The main reason ReactJS was chosen over Yew is its maturity. At the time of writing, the latest version of the framework is 0.20.0 and the project repository contains a warning about expected breaking API changes~\cite{yewweb}.</div><div class="clear"></div>
<div class="linenb">66</div><div class="codeline">In the future, Yew might be a better choice, as it fits more naturally into a Rust-dominated application, but for now it is not ready.</div><div class="clear"></div>
<div class="linenb">67</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">68</div><div class="codeline">ReactJS is one of the most popular front-end libraries in the world. It drastically simplifies the creation of interactive user interfaces by making views declarative.</div><div class="clear"></div>
<div class="linenb">69</div><div class="codeline">Instead of updating the HTML code every time something happens, ReactJS automatically updates the required components when the internal state of the application changes.</div><div class="clear"></div>
<div class="linenb">70</div><div class="codeline">It allows programmers to define encapsulated and reusable components that manage their own state and can be assembled into complex interfaces~\cite{reactweb}.</div><div class="clear"></div>
<div class="linenb">71</div><div class="codeline">Using ReactJS in this project allows for a simplified and streamlined front-end implementation.</div><div class="clear"></div>
<div class="linenb">72</div><div class="codeline">The declarative nature of React also ensures that the user interface (UI) always displays the most up-to-date data, without the need to manually update all the required HTML elements. This makes the final application more reliable and easier to maintain.</div><div class="clear"></div>
<div class="linenb">73</div><div class="codeline">There are several other JavaScript frameworks that offer similar features, such as Angular and VueJS, but none of them are as widely used as React~\cite{webframework}.</div><div class="clear"></div>
<div class="linenb">74</div><div class="codeline">Using the most widely used framework should make it easier for developers to contribute to the new implementation, as it is likely that a developer with experience in JavaScript will also have experience with ReactJS.</div><div class="clear"></div>
<div class="linenb">75</div><div class="codeline">For these reasons, ReactJS is a good choice for this application. It is mature, well supported, and easy to use.</div><div class="clear"></div>
<div class="linenb">76</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">77</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">78</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Industry standard for reactive frontend development</span></span></div><div class="clear"></div>
<div class="linenb">79</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> very stable and mature with tons of resources</span></span></div><div class="clear"></div>
<div class="linenb">80</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">81</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">82</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{The advantages of ReactJS over pure JavaScript}</span></span></div><div class="clear"></div>
<div class="linenb">83</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">84</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">85</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Component architecture simplifies code re-use</span></span></div><div class="clear"></div>
<div class="linenb">86</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> simple, declarative and efficient updates for Components</span></span></div><div class="clear"></div>
<div class="linenb">87</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> UI = f(state) instead of imperative spagetti code</span></span></div><div class="clear"></div>
<div class="linenb">88</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
</div>
<h2 class="filename">tex/evaluation.tex</h2>

<p>Found 0 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;&nbsp;1</div><div class="codeline"><span class="keyword1">\section</span>{Evaluation} <span class="keyword1">\label</span>{evaluation}</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;2</div><div class="codeline">When evaluating the success of a project, it is paramount to keep in mind the original goal of the project.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;3</div><div class="codeline">In this case, the primary goal was to provide an alternative VM emulator implementation to the participants of the Nand to Tetris course to make Project 9 and 12 more convenient.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;4</div><div class="codeline">Not only was this goal achieved, but in addition, the CPU emulator was also rewritten and both emulators have been integrated into a test-script-driven workflow, making them useful to course instructors.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;5</div><div class="codeline">Then again, projects do not exist in a vaccum, so the following sections contain a comprehensive comparison with the official emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;6</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;7</div><div class="codeline"><span class="keyword1">\subsection</span>{Comparison with the official Emulator based on compatability} <span class="keyword1">\label</span>{compatibility}</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;8</div><div class="codeline">It is impossible to test every existing program for the Hack VM, both due to the sheer volume of existing applications and the fact that many of these applications are not available to the public.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;9</div><div class="codeline">However, this is also not necessary, since the expected behavior of the emulators is clearly described in the book accompanying the course.</div><div class="clear"></div>
<div class="linenb">&nbsp;10</div><div class="codeline">By following the specification and testing the new implementation with a reasonable number of representative programs, one can determine the degree of compatibility.</div><div class="clear"></div>
<div class="linenb">&nbsp;11</div><div class="codeline">Those programs are listed in the appendix~\ref{table:tested}.</div><div class="clear"></div>
<div class="linenb">&nbsp;12</div><div class="codeline">The number of possible instructions in the VM is also manageable, so a sufficiently complex program will use every single available instruction, which further supports this claim.</div><div class="clear"></div>
<div class="linenb">&nbsp;13</div><div class="codeline">By and large, the new emulator behaves exactly like the old one.</div><div class="clear"></div>
<div class="linenb">&nbsp;14</div><div class="codeline">This even applies to behaviors that could be considered bugs, such as the way the keyboard handler in the Java implementation interprets each letter as a capital letter, thus limiting the entire input system to uppercase letters.</div><div class="clear"></div>
<div class="linenb">&nbsp;15</div><div class="codeline">This is not a technical limitation of either the VM or the Java input event, but simply a consequence of the implementation of the keyboard handler, and could easily be changed to allow lowercase letters as well.</div><div class="clear"></div>
<div class="linenb">&nbsp;16</div><div class="codeline">But that would affect a number of existing applications, since they only check for uppercase letters in their game code, which means that those applications could no longer be used without problems.</div><div class="clear"></div>
<div class="linenb">&nbsp;17</div><div class="codeline">For this reason, the new emulator also only passes uppercase letters to the VM, even if it needs a bit more code to behave that way.</div><div class="clear"></div>
<div class="linenb">&nbsp;18</div><div class="codeline">All keys are converted directly to uppercase after being read.</div><div class="clear"></div>
<div class="linenb">&nbsp;19</div><div class="codeline">In the future, it might be useful to add a compatibility setting to allow users to process lowercase letters as well, but due to time constraints in this project, it was decided to prioritize compatibility over correctness.</div><div class="clear"></div>
<div class="linenb">&nbsp;20</div><div class="codeline">There is only a single part of the new emulator that is known to behave at least partially differently to the official implementation.</div><div class="clear"></div>
<div class="linenb">&nbsp;21</div><div class="codeline">That is the implementation of the \verb+Sys.wait+ function, which was already discussed in~\cref{sys.wait-example}.</div><div class="clear"></div>
<div class="linenb">&nbsp;22</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;23</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;24</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> every program working. systematic approach because there are tons of non public programs. Example programs that use every instruction/stdlib-function</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;25</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Sys.wait not the same (but also different behaviour on official emulator, based on stdlib)</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;26</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Sys.wait behaves differently in vm stdlib on official emulator</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;27</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> keyboard bug for bug compatible</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;28</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;29</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;30</div><div class="codeline"><span class="keyword1">\subsection</span>{Comparison with the official Emulator based on UI} <span class="keyword1">\label</span>{ui-compatibility}</div><div class="clear"></div>
<div class="linenb">&nbsp;31</div><div class="codeline">The new emulator does not implement all the features of the official emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;32</div><div class="codeline">Some of these missing features are missing due to time constraints, such as test script support in the WebUI~\ref{future-work}.</div><div class="clear"></div>
<div class="linenb">&nbsp;33</div><div class="codeline">On the other hand, some features have been deliberately omitted because they serve little purpose but complicate the user interface.</div><div class="clear"></div>
<div class="linenb">&nbsp;34</div><div class="codeline">One such feature is the ability to animate the running program.</div><div class="clear"></div>
<div class="linenb">&nbsp;35</div><div class="codeline">When this option is enabled, the information about the internal memory and the current instruction is updated after each tick.</div><div class="clear"></div>
<div class="linenb">&nbsp;36</div><div class="codeline">Everytime one of those values changes, it is highlighted in the UI.</div><div class="clear"></div>
<div class="linenb">&nbsp;37</div><div class="codeline">This may seem useful at first, but while debugging, the user will usually use the step button instead, and when running the game, the animations have to be disabled for performance reasons.</div><div class="clear"></div>
<div class="linenb">&nbsp;38</div><div class="codeline">So this feature does not provide much value to the user.</div><div class="clear"></div>
<div class="linenb">&nbsp;39</div><div class="codeline">Instead of offering every possible feature, the new user interface is intentionally kept minmal to simplify usage and provide an experience that is more focused on actually running games at full speed.</div><div class="clear"></div>
<div class="linenb">&nbsp;40</div><div class="codeline">This is also the reason why most of the UI elements are completely hidden while the game is running.</div><div class="clear"></div>
<div class="linenb">&nbsp;41</div><div class="codeline">For the compiler development that is part of projects 10 and 11, it may be advantageous to continue using the official emulators for their advanced debugging features.</div><div class="clear"></div>
<div class="linenb">&nbsp;42</div><div class="codeline">In contrast, when it comes to playing and testing full games, the new emulators offer a superior experience.</div><div class="clear"></div>
<div class="linenb">&nbsp;43</div><div class="codeline">They also open up these games and programs to additional platforms, because the new emulators also work on phones and tablets, as long as a physical keyboard is connected or the application does not require user input~\ref{fig:ui-demo-mobile}.</div><div class="clear"></div>
<div class="linenb">&nbsp;44</div><div class="codeline">Another benefit of the new user interface is the unification of the VM and CPU emulators.</div><div class="clear"></div>
<div class="linenb">&nbsp;45</div><div class="codeline">The new emulator handles both types of applications within a single application, distinguishing between them based on their respective file extensions.</div><div class="clear"></div>
<div class="linenb">&nbsp;46</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;47</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">&nbsp;48</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">&nbsp;49</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=6cm]{fig/ui-demo-mobile.png}</div><div class="clear"></div>
<div class="linenb">&nbsp;50</div><div class="codeline">    <span class="keyword1">\caption</span>{The web-based user interface in a phone format.}<span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">&nbsp;51</div><div class="codeline">    <span class="keyword1">\label</span>{fig:ui-demo-mobile}</div><div class="clear"></div>
<div class="linenb">&nbsp;52</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;53</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;54</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;55</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> official has more features (including test scripts)</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;56</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> mine scales better</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;57</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> mine is available in the browser -&gt; also on mobile</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;58</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> mine handles cpu and vm in one ui</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;59</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;60</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;61</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsubsection</span>{Hosting the application}</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;62</div><div class="codeline">One of the biggest advantages of web-based applications is the ability to use them without a local installation, simply by opening a link in the user's web browser.</div><div class="clear"></div>
<div class="linenb">&nbsp;63</div><div class="codeline">This only works if the application is hosted on a public web server.</div><div class="clear"></div>
<div class="linenb">&nbsp;64</div><div class="codeline">For many applications, this means renting or operating an expensive server infrastructure for the backend of their service.</div><div class="clear"></div>
<div class="linenb">&nbsp;65</div><div class="codeline">In contrast, the new emulators are compiled to WebAssembly, which allows them to run entirely in the client's web browser.</div><div class="clear"></div>
<div class="linenb">&nbsp;66</div><div class="codeline">This means that no backend is needed and therefore a simple static file server is sufficient to host the entire application.</div><div class="clear"></div>
<div class="linenb">&nbsp;67</div><div class="codeline">GitHub offers such a file hosting service free of charge.</div><div class="clear"></div>
<div class="linenb">&nbsp;68</div><div class="codeline">It is called ``GitHub Pages'' and allows users to host static web resources by simply uploading them to a directory on GitHub's servers and marking that directory as public in the repository settings.</div><div class="clear"></div>
<div class="linenb">&nbsp;69</div><div class="codeline">In addition, GitHub offers a service called ``GitHub Actions'' that allows arbitrary code to be executed on Microsoft's servers depending on various events in the repository, such as a push to the main branch.</div><div class="clear"></div>
<div class="linenb">&nbsp;70</div><div class="codeline">Combining these two services, one can automatically build and deploy the entire WebAssembly application to Pages every time there is a push to the main branch.</div><div class="clear"></div>
<div class="linenb">&nbsp;71</div><div class="codeline">That is exactly what this project does, even though it is technically hosted on the HHU's internal GitLab instance.</div><div class="clear"></div>
<div class="linenb">&nbsp;72</div><div class="codeline">Every time there is a push to the GitLab instance, that push is automatically mirrored to GitHub, which then builds the Wasm and JavaScript code and deploys it to GitHub Pages.</div><div class="clear"></div>
<div class="linenb">&nbsp;73</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;74</div><div class="codeline"><span class="keyword1">\subsection</span>{Comparison with the official Emulator based on Performance} <span class="keyword1">\label</span>{sec:benchmarks}</div><div class="clear"></div>
<div class="linenb">&nbsp;75</div><div class="codeline">There are two distinct modes in which the Emulators can operate: the interactive mode, in which the display memory is actually rendered to a visible canvas, and the test mode, in which a test scripts runs without any further user input to verify the correctness of a hack program.</div><div class="clear"></div>
<div class="linenb">&nbsp;76</div><div class="codeline">From a performance point of view, only the former is relevant, since all test scripts used in the course finish so quickly that measuring the performance differences between emulators would basically be meaningless.</div><div class="clear"></div>
<div class="linenb">&nbsp;77</div><div class="codeline">So, to really evaluate the new emulators, a sufficiently complex graphical program is required.</div><div class="clear"></div>
<div class="linenb">&nbsp;78</div><div class="codeline">For this task, one of Gavin Stewart's impressive graphical demonstrations for the Hack platform was chosen.</div><div class="clear"></div>
<div class="linenb">&nbsp;79</div><div class="codeline">The GASchunky program~\cite{demos} renders a complex animation in an infinite loop to the internal display.</div><div class="clear"></div>
<div class="linenb">&nbsp;80</div><div class="codeline">It requires no user input, but uses almost all of the available functionality of the platform, making it a perfect choice for benchmarking.</div><div class="clear"></div>
<div class="linenb">&nbsp;81</div><div class="codeline">In order to turn it into a proper benchmark, the loop was removed, leaving only a single iteration of the animation to be played.</div><div class="clear"></div>
<div class="linenb">&nbsp;82</div><div class="codeline">\cref{fig:gaschunky-screenshot} shows a frame of the generated animation.</div><div class="clear"></div>
<div class="linenb">&nbsp;83</div><div class="codeline">Additionally, to make the comparisons fair, all \verb+Sys.wait+ calls have been removed from the program.</div><div class="clear"></div>
<div class="linenb">&nbsp;84</div><div class="codeline">The reason why this is important was discussed at the end of \cref{sys.wait-example}.</div><div class="clear"></div>
<div class="linenb">&nbsp;85</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;86</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">&nbsp;87</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">&nbsp;88</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=10cm]{fig/gaschunky.png}</div><div class="clear"></div>
<div class="linenb">&nbsp;89</div><div class="codeline">    <span class="keyword1">\caption</span>{A screenshot of the GASchunky animation in progress.}<span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">&nbsp;90</div><div class="codeline">    <span class="keyword1">\label</span>{fig:gaschunky-screenshot}</div><div class="clear"></div>
<div class="linenb">&nbsp;91</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;92</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;93</div><div class="codeline">There were also some changes made to the emulators themselves.</div><div class="clear"></div>
<div class="linenb">&nbsp;94</div><div class="codeline">Two statements have been added to the code for both the official and the new emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;95</div><div class="codeline">Both print the current system time in milliseconds and get executed when the start button is pressed and when the program returns from the main function respectively.</div><div class="clear"></div>
<div class="linenb">&nbsp;96</div><div class="codeline">Additionally in the third column of the ~\cref{table:gaschunky}, the one millisecond wait instruction in the FastforwardTask of the \verb+HackController.java+ was removed to ensure that the official emulator could run at its maximum speed.</div><div class="clear"></div>
<div class="linenb">&nbsp;97</div><div class="codeline">The new emulator was run both from the web UI and in desktop mode.</div><div class="clear"></div>
<div class="linenb">&nbsp;98</div><div class="codeline">In both cases the tickrate was set to one million, which is ten times as much as the normal maximum tickrate in the web UI.</div><div class="clear"></div>
<div class="linenb">&nbsp;99</div><div class="codeline">This limit is however arbitrarily chosen and therefore does not reflect the true performance of the system.</div><div class="clear"></div>
<div class="linenb">100</div><div class="codeline">At a tick rate of one million, the viewer can still see the animation clearly, which allows for a fair comparison~\ref{fig:gachunky-plot}.</div><div class="clear"></div>
<div class="linenb">101</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">102</div><div class="codeline"><span class="keyword2">\begin{table}</span>[ht]</div><div class="clear"></div>
<div class="linenb">103</div><div class="codeline">  <span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">104</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">105</div><div class="codeline">    <span class="keyword2">\begin{tabular}</span>{@{}lllll@{}}</div><div class="clear"></div>
<div class="linenb">106</div><div class="codeline">      \toprule</div><div class="clear"></div>
<div class="linenb">107</div><div class="codeline">      Run &amp; Official &amp; Official (no wait) &amp; Native &amp;   Web \\ \midrule</div><div class="clear"></div>
<div class="linenb">108</div><div class="codeline">      1   &amp;   36.16s &amp;             30.76s &amp;  1.01s &amp; 1.02s \\</div><div class="clear"></div>
<div class="linenb">109</div><div class="codeline">      2   &amp;   36.19s &amp;             31.17s &amp;  0.99s &amp; 1.03s \\</div><div class="clear"></div>
<div class="linenb">110</div><div class="codeline">      3   &amp;   35.93s &amp;             30.58s &amp;  1.02s &amp; 1.04s \\</div><div class="clear"></div>
<div class="linenb">111</div><div class="codeline">      4   &amp;   36.14s &amp;             30.65s &amp;  0.97s &amp; 1.06s \\</div><div class="clear"></div>
<div class="linenb">112</div><div class="codeline">      5   &amp;   36.16s &amp;             30.99s &amp;  0.95s &amp; 1.02s \\</div><div class="clear"></div>
<div class="linenb">113</div><div class="codeline">      6   &amp;   36.12s &amp;             30.81s &amp;  1.03s &amp; 1.07s \\</div><div class="clear"></div>
<div class="linenb">114</div><div class="codeline">      7   &amp;   36.27s &amp;             30.86s &amp;  1.06s &amp; 1.06s \\</div><div class="clear"></div>
<div class="linenb">115</div><div class="codeline">      8   &amp;   36.29s &amp;             30.86s &amp;  0.99s &amp; 1.05s \\</div><div class="clear"></div>
<div class="linenb">116</div><div class="codeline">      9   &amp;   35.86s &amp;             30.81s &amp;  1.01s &amp; 1.03s \\</div><div class="clear"></div>
<div class="linenb">117</div><div class="codeline">      10  &amp;   36.12s &amp;             30.74s &amp;  1.02s &amp; 1.04s \\ \bottomrule</div><div class="clear"></div>
<div class="linenb">118</div><div class="codeline">    <span class="keyword2">\end{tabular}</span></div><div class="clear"></div>
<div class="linenb">119</div><div class="codeline">    <span class="keyword1">\caption</span>{GASchunky benchmark (lower is faster).}<span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">120</div><div class="codeline">    <span class="keyword1">\label</span>{table:gaschunky}</div><div class="clear"></div>
<div class="linenb">121</div><div class="codeline">  <span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">122</div><div class="codeline"><span class="keyword2">\end{table}</span></div><div class="clear"></div>
<div class="linenb">123</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">124</div><div class="codeline"><span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">125</div><div class="codeline">  \centering</div><div class="clear"></div>
<div class="linenb">126</div><div class="codeline">  <span class="keyword2">\begin{tikzpicture}</span></div><div class="clear"></div>
<div class="linenb">127</div><div class="codeline">    <span class="keyword2">\begin{axis}</span>[</div><div class="clear"></div>
<div class="linenb">128</div><div class="codeline">      ymode=log,</div><div class="clear"></div>
<div class="linenb">129</div><div class="codeline">      ylabel=Seconds,</div><div class="clear"></div>
<div class="linenb">130</div><div class="codeline">      xlabel=Run,</div><div class="clear"></div>
<div class="linenb">131</div><div class="codeline">      legend pos=outer north east,</div><div class="clear"></div>
<div class="linenb">132</div><div class="codeline">      ]</div><div class="clear"></div>
<div class="linenb">133</div><div class="codeline">      \addplot coordinates {</div><div class="clear"></div>
<div class="linenb">134</div><div class="codeline">        (1,  36.16)</div><div class="clear"></div>
<div class="linenb">135</div><div class="codeline">        (2,  36.19)</div><div class="clear"></div>
<div class="linenb">136</div><div class="codeline">        (3,  35.93)</div><div class="clear"></div>
<div class="linenb">137</div><div class="codeline">        (4,  36.14)</div><div class="clear"></div>
<div class="linenb">138</div><div class="codeline">        (5,  36.16)</div><div class="clear"></div>
<div class="linenb">139</div><div class="codeline">        (6,  36.12)</div><div class="clear"></div>
<div class="linenb">140</div><div class="codeline">        (7,  36.27)</div><div class="clear"></div>
<div class="linenb">141</div><div class="codeline">        (8,  36.29)</div><div class="clear"></div>
<div class="linenb">142</div><div class="codeline">        (9,  35.86)</div><div class="clear"></div>
<div class="linenb">143</div><div class="codeline">        (10, 36.12)</div><div class="clear"></div>
<div class="linenb">144</div><div class="codeline">      };</div><div class="clear"></div>
<div class="linenb">145</div><div class="codeline">      \addplot coordinates {</div><div class="clear"></div>
<div class="linenb">146</div><div class="codeline">        (1,  30.76)</div><div class="clear"></div>
<div class="linenb">147</div><div class="codeline">        (2,  31.17)</div><div class="clear"></div>
<div class="linenb">148</div><div class="codeline">        (3,  30.58)</div><div class="clear"></div>
<div class="linenb">149</div><div class="codeline">        (4,  30.65)</div><div class="clear"></div>
<div class="linenb">150</div><div class="codeline">        (5,  30.99)</div><div class="clear"></div>
<div class="linenb">151</div><div class="codeline">        (6,  30.81)</div><div class="clear"></div>
<div class="linenb">152</div><div class="codeline">        (7,  30.86)</div><div class="clear"></div>
<div class="linenb">153</div><div class="codeline">        (8,  30.86)</div><div class="clear"></div>
<div class="linenb">154</div><div class="codeline">        (9,  30.81)</div><div class="clear"></div>
<div class="linenb">155</div><div class="codeline">        (10, 30.74)</div><div class="clear"></div>
<div class="linenb">156</div><div class="codeline">      };</div><div class="clear"></div>
<div class="linenb">157</div><div class="codeline">      \addplot coordinates {</div><div class="clear"></div>
<div class="linenb">158</div><div class="codeline">        (1,  1.01)</div><div class="clear"></div>
<div class="linenb">159</div><div class="codeline">        (2,  0.99)</div><div class="clear"></div>
<div class="linenb">160</div><div class="codeline">        (3,  1.02)</div><div class="clear"></div>
<div class="linenb">161</div><div class="codeline">        (4,  0.97)</div><div class="clear"></div>
<div class="linenb">162</div><div class="codeline">        (5,  0.95)</div><div class="clear"></div>
<div class="linenb">163</div><div class="codeline">        (6,  1.03)</div><div class="clear"></div>
<div class="linenb">164</div><div class="codeline">        (7,  1.06)</div><div class="clear"></div>
<div class="linenb">165</div><div class="codeline">        (8,  0.99)</div><div class="clear"></div>
<div class="linenb">166</div><div class="codeline">        (9,  1.01)</div><div class="clear"></div>
<div class="linenb">167</div><div class="codeline">        (10, 1.02)</div><div class="clear"></div>
<div class="linenb">168</div><div class="codeline">      };</div><div class="clear"></div>
<div class="linenb">169</div><div class="codeline">      \addplot coordinates {</div><div class="clear"></div>
<div class="linenb">170</div><div class="codeline">        (1,  1.02)</div><div class="clear"></div>
<div class="linenb">171</div><div class="codeline">        (2,  1.03)</div><div class="clear"></div>
<div class="linenb">172</div><div class="codeline">        (3,  1.04)</div><div class="clear"></div>
<div class="linenb">173</div><div class="codeline">        (4,  1.06)</div><div class="clear"></div>
<div class="linenb">174</div><div class="codeline">        (5,  1.02)</div><div class="clear"></div>
<div class="linenb">175</div><div class="codeline">        (6,  1.07)</div><div class="clear"></div>
<div class="linenb">176</div><div class="codeline">        (7,  1.06)</div><div class="clear"></div>
<div class="linenb">177</div><div class="codeline">        (8,  1.05)</div><div class="clear"></div>
<div class="linenb">178</div><div class="codeline">        (9,  1.03)</div><div class="clear"></div>
<div class="linenb">179</div><div class="codeline">        (10, 1.04)</div><div class="clear"></div>
<div class="linenb">180</div><div class="codeline">      };</div><div class="clear"></div>
<div class="linenb">181</div><div class="codeline">      \addlegendentry{Official}</div><div class="clear"></div>
<div class="linenb">182</div><div class="codeline">      \addlegendentry{Official (no wait)}</div><div class="clear"></div>
<div class="linenb">183</div><div class="codeline">      \addlegendentry{Native}</div><div class="clear"></div>
<div class="linenb">184</div><div class="codeline">      \addlegendentry{Web}</div><div class="clear"></div>
<div class="linenb">185</div><div class="codeline">    <span class="keyword2">\end{axis}</span></div><div class="clear"></div>
<div class="linenb">186</div><div class="codeline">  <span class="keyword2">\end{tikzpicture}</span></div><div class="clear"></div>
<div class="linenb">187</div><div class="codeline">  <span class="keyword1">\caption</span>{GASchunky benchmark (lower is faster).}<span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">188</div><div class="codeline">  <span class="keyword1">\label</span>{fig:gachunky-plot}</div><div class="clear"></div>
<div class="linenb">189</div><div class="codeline"><span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">190</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">191</div><div class="codeline">It is clearly visible that the new Emulator is several times faster than the official implementation.</div><div class="clear"></div>
<div class="linenb">192</div><div class="codeline">On average, the official emulator without modifications takes around 36 seconds to render the full animation once.</div><div class="clear"></div>
<div class="linenb">193</div><div class="codeline">Meanwhile the Web version of the new emulator manages to achieve the same result in just one second on average.</div><div class="clear"></div>
<div class="linenb">194</div><div class="codeline">The native version of the new emulator which uses SDL to render the internal display is even slightly faster.</div><div class="clear"></div>
<div class="linenb">195</div><div class="codeline">While the official emulator can be sped up drastically, it still does not come close.</div><div class="clear"></div>
<div class="linenb">196</div><div class="codeline">This shows us that even though the new emulator only uses a single thread and runs in a browser, it still offers massive performance benefits over the official implementation.</div><div class="clear"></div>
</div>
<h2 class="filename">tex/implementation.tex</h2>

<p>Found 6 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;&nbsp;1</div><div class="codeline"><span class="keyword1">\section</span>{Implementation} <span class="keyword1">\label</span>{implementation}</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;2</div><div class="codeline">In this project, both the VM emulator and the CPU emulator were implemented.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;3</div><div class="codeline">However, the decision to also implement the CPU emulator was made relatively late in the implementation process, as it was difficult to accurately estimate the time required to implement the VM.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;4</div><div class="codeline">The CPU emulator is also much simpler than the VM and can reuse some of the code from the VM implementation.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;5</div><div class="codeline">Accordingly, most of this section focuses only on the VM emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;6</div><div class="codeline">If no emulator is explicitly specified, the text always refers to the VM.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;7</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;8</div><div class="codeline"><span class="keyword1">\subsection</span>{General approach}</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;9</div><div class="codeline">With any project, one must first decide on a course of action.</div><div class="clear"></div>
<div class="linenb">&nbsp;10</div><div class="codeline">Due to the relatively unique requirements of this project, the order in which the features are to be implemented is not immediately obvious.</div><div class="clear"></div>
<div class="linenb">&nbsp;11</div><div class="codeline">There are basically two possible approaches.</div><div class="clear"></div>
<div class="linenb">&nbsp;12</div><div class="codeline">A top-down approach would with the user interface (UI) implementation first and fill in the gaps later.</div><div class="clear"></div>
<div class="linenb">&nbsp;13</div><div class="codeline">But since the application has different user interfaces depending on the intended use, it makes more sense to develop from the bottom up.</div><div class="clear"></div>
<div class="linenb">&nbsp;14</div><div class="codeline">This allows for a more test-driven approach, where the internal logic of the emulator is developed first and only later integrated into the user interface.</div><div class="clear"></div>
<div class="linenb">&nbsp;15</div><div class="codeline">In order to be able to test the VM properly, it made sense to implement the bytecode parser first~\ref{parser-dev}, as it would significantly reduce the effort required to write unit tests for the VM.</div><div class="clear"></div>
<div class="linenb">&nbsp;16</div><div class="codeline">Once the parser was completed, the VM could be implemented in isolation and independent of the future user interface.</div><div class="clear"></div>
<div class="linenb">&nbsp;17</div><div class="codeline">The various instructions of the VM vary in complexity, so it made sense to postpone the implementation of the Function, Call and Return instructions until all other instructions had been implemented and sufficiently tested.</div><div class="clear"></div>
<div class="linenb">&nbsp;18</div><div class="codeline">Here the tests in the course projects, which were intended to test the participants' compiler implementation, helped to ensure the correct functionality of the emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;19</div><div class="codeline">Although there was no way to parse the test scripts directly at this point, they were still very useful because they could easily be translated directly into Rust code by hand.</div><div class="clear"></div>
<div class="linenb">&nbsp;20</div><div class="codeline">After all instructions were implemented according to their specification~\cite{nisan2005}, the emulator was fully functional and the standard library was simply loaded in its bytecode form, which made it possible to execute any VM program without any modifications.</div><div class="clear"></div>
<div class="linenb">&nbsp;21</div><div class="codeline">This approach unfortunately leads to performance issues, which is why the standard library was later implemented in Rust~\ref{jack-stdlib-in-rust}.</div><div class="clear"></div>
<div class="linenb">&nbsp;22</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;23</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsubsection</span>{Test driven development of the VM without an UI}</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;24</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;25</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> first implement bytecode parser, because it can be used in VM Tests</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;26</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> basic VM features (everything except for function, call, return)</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;27</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> testing with unit tests (Translations of VME.tst tests)</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;28</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> rest of the VM instructions</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;29</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> stdlib only as vm bytecode</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;30</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;31</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;32</div><div class="codeline"><span class="keyword1">\subsection</span>{Architectural overview}</div><div class="clear"></div>
<div class="linenb">&nbsp;33</div><div class="codeline">The general architecture of the application is outlined in \cref{fig:arch}.</div><div class="clear"></div>
<div class="linenb">&nbsp;34</div><div class="codeline">Every box in this diagram represents a Rust module, which can either be a single file or an entire directory.</div><div class="clear"></div>
<div class="linenb">&nbsp;35</div><div class="codeline">The architecture is divided into three major areas: the actual simulators, the parsers, and the interfaces that serve as entry points into the application.</div><div class="clear"></div>
<div class="linenb">&nbsp;36</div><div class="codeline">Although the CPU and VM are commonly referred to as emulators, the module is called simulators because this is a more general term that also applies to the hardware simulator, which was not implemented as part of this work~\ref{future-work}.</div><div class="clear"></div>
<div class="linenb">&nbsp;37</div><div class="codeline">This is the naming convention used by the official tools, where the emulators are also part of the simulators package~\cite{n2tsimulators}.</div><div class="clear"></div>
<div class="linenb">&nbsp;38</div><div class="codeline">The two terms are therefore used interchangeably in the following sections.</div><div class="clear"></div>
<div class="linenb">&nbsp;39</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;40</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;41</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">&nbsp;42</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">&nbsp;43</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=12cm]{fig/architecture.png}</div><div class="clear"></div>
<div class="linenb">&nbsp;44</div><div class="codeline">    <span class="keyword1">\caption</span>{Architecture overview diagram.}<span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">&nbsp;45</div><div class="codeline">    <span class="keyword1">\label</span>{fig:arch}</div><div class="clear"></div>
<div class="linenb">&nbsp;46</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;47</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;48</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;49</div><div class="codeline"><span class="keyword1">\subsubsection</span>{Interfaces} <span class="keyword1">\label</span>{interfaces}</div><div class="clear"></div>
<div class="linenb">&nbsp;50</div><div class="codeline">There are three possible entry points for the application, listed in the ``Interfaces'' section of the figure.</div><div class="clear"></div>
<div class="linenb">&nbsp;51</div><div class="codeline">Two of them are intended for use via the command line.</div><div class="clear"></div>
<div class="linenb">&nbsp;52</div><div class="codeline">Both provide the ability to use the test scripts included in the project within the new emulator, but work in slightly different ways, as the VM emulator can run without a test script, while the CPU emulator does not currently have this capability.</div><div class="clear"></div>
<div class="linenb">&nbsp;53</div><div class="codeline">For this reason, the VM emulator can either accept a path to such a test script or a path to a directory containing bytecode, while the CPU emulator accepts only a file path for a test script as input.</div><div class="clear"></div>
<div class="linenb">&nbsp;54</div><div class="codeline">If the user passes a path to a directory, the application loads all files with the vm extension from that directory and then tries to execute them.</div><div class="clear"></div>
<div class="linenb">&nbsp;55</div><div class="codeline">If a test script is passed instead, that script is executed as described in~\cref{test-script-workflow}.</div><div class="clear"></div>
<div class="linenb">&nbsp;56</div><div class="codeline">In the first case, a window is displayed if the application was compiled with the desktop function enabled.</div><div class="clear"></div>
<div class="linenb">&nbsp;57</div><div class="codeline">Otherwise, a message is printed telling the user that the application is running in headless mode.</div><div class="clear"></div>
<div class="linenb">&nbsp;58</div><div class="codeline">Other options are also available to the user, such as the ability to set the tick speed or print the output of the test script to stdout instead of writing it into the output file described in the test script.</div><div class="clear"></div>
<div class="linenb">&nbsp;59</div><div class="codeline">There is also the possibility to use the bytecode implementation of the whole standard library instead of the one written in Rust.</div><div class="clear"></div>
<div class="linenb">&nbsp;60</div><div class="codeline">All of the options can be listed with the ``-h'' flag.</div><div class="clear"></div>
<div class="linenb">&nbsp;61</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;62</div><div class="codeline">The third entry point is the most important for the majority of users.</div><div class="clear"></div>
<div class="linenb">&nbsp;63</div><div class="codeline">The Web UI, a JavaScript application that calls the emulator implementations as a WebAssembly library, is easily accessible in any standard web browser.</div><div class="clear"></div>
<div class="linenb">&nbsp;64</div><div class="codeline">Unlike the other two entry points, which can only use one of the emulators at a time, the Web UI can use both, indicated in the diagram by an arrow pointing to the outer simulator module.</div><div class="clear"></div>
<div class="linenb">&nbsp;65</div><div class="codeline">Though test scripts are currently not supported here~\ref{future-work}.</div><div class="clear"></div>
<div class="linenb">&nbsp;66</div><div class="codeline">This entry point can be used without the need to install additional software on the user's system by simply launching a web page in the browser.</div><div class="clear"></div>
<div class="linenb">&nbsp;67</div><div class="codeline">The current address of this web page is given in the readme file in the root directory of the project.</div><div class="clear"></div>
<div class="linenb">&nbsp;68</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;69</div><div class="codeline"><span class="keyword1">\subsubsection</span>{Simulators and Parsers}</div><div class="clear"></div>
<div class="linenb">&nbsp;70</div><div class="codeline">The two emulators in the Simulators module are structurally very similar. Both have a Command module that contains the instruction enum~\ref{rust-vm-dev}, an Error module that contains the error enum for the respective emulator and a Script module that handles the emulators execution if run via a test script.</div><div class="clear"></div>
<div class="linenb">&nbsp;71</div><div class="codeline">The VM is more complex, however, and also includes the Stdlib module, which contains the Rust implementation of the Jack standard library~\ref{jack-stdlib-in-rust}.</div><div class="clear"></div>
<div class="linenb">&nbsp;72</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;73</div><div class="codeline">Unlike the simulators module, the Parsing module actually contains three different submodules, as the script parsing is mostly independent from the emulator implementation used.</div><div class="clear"></div>
<div class="linenb">&nbsp;74</div><div class="codeline">All of the parsers share a lot of common code, so it makes sense to combine them into one module.</div><div class="clear"></div>
<div class="linenb">&nbsp;75</div><div class="codeline">Having said that, there are some emulator specific instructions in the scripts, which were already highlighted in~\cref{test-scripts}.</div><div class="clear"></div>
<div class="linenb">&nbsp;76</div><div class="codeline">The code to parse these special instructions is contained in the Script module of the respective emulator, instead of the module with the shared code.</div><div class="clear"></div>
<div class="linenb">&nbsp;77</div><div class="codeline">This division was done intentionally, because parsing those instructions is only a small part of the whole script parsing process and is closely linked to the way the script is interpreted by the emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;78</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;79</div><div class="codeline"><span class="keyword1">\subsection</span>{VM development in Rust} <span class="keyword1">\label</span>{rust-vm-dev}</div><div class="clear"></div>
<div class="linenb">&nbsp;80</div><div class="codeline">The following sections offer a mix of general techniques for VM development in Rust while explaining the specific choices made during the development of this project.</div><div class="clear"></div>
<div class="linenb">&nbsp;81</div><div class="codeline">All processors and their emulators basically follow the same three-step cycle. They first fetch the next instruction to be executed. The internal number containing the current instruction is called program counter in the following sections.</div><div class="clear"></div>
<div class="linenb">&nbsp;82</div><div class="codeline">After the instruction is fetched, it is decoded, i.e., the emulator determines what type of instruction it has just fetched and decodes the arguments for that instruction if necessary.</div><div class="clear"></div>
<div class="linenb">&nbsp;83</div><div class="codeline">The final step is the actual execution, which is of course specific to the instruction in question~\cite{nystrom2021crafting}.</div><div class="clear"></div>
<div class="linenb">&nbsp;84</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;85</div><div class="codeline"><span class="keyword1">\subsubsection</span>{The internal representation of bytecode}</div><div class="clear"></div>
<div class="linenb">&nbsp;86</div><div class="codeline">Before starting to implement a VM, one must first decide on an internal representation for the bytecode that will run on that VM.</div><div class="clear"></div>
<div class="linenb">&nbsp;87</div><div class="codeline">The design of the bytecode will always require a tradeoff between performance and ease of use during development.</div><div class="clear"></div>
<div class="linenb">&nbsp;88</div><div class="codeline">In the original emulator implementation, a very inefficient representation was chosen where each instruction is an object of an instruction class.</div><div class="clear"></div>
<div class="linenb">&nbsp;89</div><div class="codeline">This class contains a field for the opcode, the integer which identifies each instruction, and several fields for possible arguments, plus another integer that determines the number of arguments.</div><div class="clear"></div>
<div class="linenb">&nbsp;90</div><div class="codeline">On top of that, it also contains a string argument that is used for call instructions, because functions are actually called by their name at runtime.</div><div class="clear"></div>
<div class="linenb">&nbsp;91</div><div class="codeline">This design has several disadvantages from a performance standpoint.</div><div class="clear"></div>
<div class="linenb">&nbsp;92</div><div class="codeline">Each instruction must be allocated on the heap and therefore requires pointer indirection during execution, which is know to have drastic impacts on performance as it reduces spatial locality~\cite{6498541}.</div><div class="clear"></div>
<div class="linenb">&nbsp;93</div><div class="codeline">Furthermore, using strings to dispatch call instructions is a lot less efficient than just jumping to the correct bytecode position directly.</div><div class="clear"></div>
<div class="linenb">&nbsp;94</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;95</div><div class="codeline">There are two fundamental ways to represent instructions in an emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;96</div><div class="codeline">Instructions can either have a fixed size, or they can have varying sizes.</div><div class="clear"></div>
<div class="linenb">&nbsp;97</div><div class="codeline">Making all instructions the same fixed size makes development simpler, as a single element in the program vector corresponds to a single instruction.</div><div class="clear"></div>
<div class="linenb">&nbsp;98</div><div class="codeline">But, representing an instruction set like the VM bytecode, where some instructions take arguments and some do not~\ref{table:vm-instructions} with a fixed size means, that some instructions require padding.</div><div class="clear"></div>
<div class="linenb">&nbsp;99</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">100</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">101</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">102</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=12cm]{fig/instruction-size.png}</div><div class="clear"></div>
<div class="linenb">103</div><div class="codeline">    <span class="keyword1">\caption</span>{The difference between fixed and varying size instructions.}</div><div class="clear"></div>
<div class="linenb">104</div><div class="codeline">    <span class="keyword1">\label</span>{fig:instruction-size}</div><div class="clear"></div>
<div class="linenb">105</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">106</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">107</div><div class="codeline">In the fixed size vector in~\cref{fig:instruction-size}, the add instruction has the same size as the push instructions.</div><div class="clear"></div>
<div class="linenb">108</div><div class="codeline">Because the add instruction has no arguments and therefore stores less information than the push instructions, this wastes some space.</div><div class="clear"></div>
<div class="linenb">109</div><div class="codeline">In constrast, the varying size vector does not waste any space, but each instruction is now represented by multiple elements.</div><div class="clear"></div>
<div class="linenb">110</div><div class="codeline">The instructions have essentially been split into bytes without any high level structure.</div><div class="clear"></div>
<div class="linenb">111</div><div class="codeline">As we will see later, the composition of bytecode in real applications makes the advantage of not wasting space far less significant than one might first assume.</div><div class="clear"></div>
<div class="linenb">112</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">113</div><div class="codeline">Actually implementing the varying size approach in code~\ref{lst:original-bytecode} requires the usage of unions, which are similar to structs, but only one declared field can be used in a particular instance at one time~\cite{klabnik2019rust}.</div><div class="clear"></div>
<div class="linenb">114</div><div class="codeline"><span class="comment"><span class="comment">% Two different bytecode designs were considered during the development of the new emulator.</span></span></div><div class="clear"></div>
<div class="linenb">115</div><div class="codeline"><span class="comment"><span class="comment">% The first, which is more efficient but also posed serious problems from an implementation point of view, uses unions to minimize the space required for storing the instruction vector~\ref{lst:original-bytecode}.</span></span></div><div class="clear"></div>
<div class="linenb">116</div><div class="codeline"><span class="comment"><span class="comment">% A union</span></span></div><div class="clear"></div>
<div class="linenb">117</div><div class="codeline"><span class="comment"><span class="comment">% This allows putting opcodes, segments, and constants into a single type.</span></span></div><div class="clear"></div>
<div class="linenb">118</div><div class="codeline">Since each of the union variants can be represented by a single byte, the entire union also fits into only a single byte.</div><div class="clear"></div>
<div class="linenb">119</div><div class="codeline"><span class="comment"><span class="comment">% This byte can then be interpreted either as an opcode, as a segment or as a constant byte, depending on the context, with a complete instruction consisting of several instances of this union.</span></span></div><div class="clear"></div>
<div class="linenb">120</div><div class="codeline"><span class="comment"><span class="comment">% Using this approach has the advantage that each instruction takes up only as much space as it actually needs, without padding bytes.</span></span></div><div class="clear"></div>
<div class="linenb">121</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">122</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">123</div><div class="codeline">  language=Rust,</div><div class="clear"></div>
<div class="linenb">124</div><div class="codeline">  label={lst:original-bytecode},</div><div class="clear"></div>
<div class="linenb">125</div><div class="codeline">  caption={Bytecode representation based on unions (not implemented)},</div><div class="clear"></div>
<div class="linenb">126</div><div class="codeline">  captionpos=b</div><div class="clear"></div>
<div class="linenb">127</div><div class="codeline">  ]</div><div class="clear"></div>
<div class="linenb">128</div><div class="codeline">  pub enum Segment {</div><div class="clear"></div>
<div class="linenb">129</div><div class="codeline">    Argument,</div><div class="clear"></div>
<div class="linenb">130</div><div class="codeline">    Local,</div><div class="clear"></div>
<div class="linenb">131</div><div class="codeline">    // [...]</div><div class="clear"></div>
<div class="linenb">132</div><div class="codeline">    Constant,</div><div class="clear"></div>
<div class="linenb">133</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">134</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">135</div><div class="codeline">  pub enum Instruction {</div><div class="clear"></div>
<div class="linenb">136</div><div class="codeline">    Add,</div><div class="clear"></div>
<div class="linenb">137</div><div class="codeline">    Sub,</div><div class="clear"></div>
<div class="linenb">138</div><div class="codeline">    // [...]</div><div class="clear"></div>
<div class="linenb">139</div><div class="codeline">    Function,</div><div class="clear"></div>
<div class="linenb">140</div><div class="codeline">    Call</div><div class="clear"></div>
<div class="linenb">141</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">142</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">143</div><div class="codeline">  pub union Opcode {</div><div class="clear"></div>
<div class="linenb">144</div><div class="codeline">    instruction: Instruction,</div><div class="clear"></div>
<div class="linenb">145</div><div class="codeline">    segment: Segment,</div><div class="clear"></div>
<div class="linenb">146</div><div class="codeline">    constant: u8,</div><div class="clear"></div>
<div class="linenb">147</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">148</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">149</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">150</div><div class="codeline">Each byte can then be interpreted depending on the state of the VM.</div><div class="clear"></div>
<div class="linenb">151</div><div class="codeline">This approach is efficient, but also has drawbacks.</div><div class="clear"></div>
<div class="linenb">152</div><div class="codeline">Reading the values requires unsafe Rust code, since there is no runtime information about the nature of each union instance contained in the instance itself.</div><div class="clear"></div>
<div class="linenb">153</div><div class="codeline">More importantly, a single instruction in the textual representation of the bytecode can now correspond to multiple entries in the instruction vector, e.g.\ ``push segment 3'' requires three entries in the program vector.</div><div class="clear"></div>
<div class="linenb">154</div><div class="codeline">As a result, the index of a statement in the program at runtime is often significantly larger than the line number of the instruction in the input.</div><div class="clear"></div>
<div class="linenb">155</div><div class="codeline"><span class="comment"><span class="comment">% The first and less important is that additional metadata is required to determine the line number in the input from the current instruction in the runtime representation, which drastically increases the complexity needed to implement the code view in the UI.</span></span></div><div class="clear"></div>
<div class="linenb">156</div><div class="codeline">This is a problem because jump instructions in hack bytecode are absolute, i.e., a jump must know the index of its target instruction in the program vector, not just its position relative to itself.</div><div class="clear"></div>
<div class="linenb">157</div><div class="codeline">For example, the add instruction in the fixed size representation in~\cref{fig:instruction-size} has the index two, but in the varying size vector its index is actually six.</div><div class="clear"></div>
<div class="linenb">158</div><div class="codeline">This means that by assigning multiple indices to each instruction, the number of available jump locations is reduced significantly, which prohibits loading bigger projects like Hackenstein~\ref{fig:hackenstein-official}.</div><div class="clear"></div>
<div class="linenb">159</div><div class="codeline"><span class="comment"><span class="comment">% Alternatively, we could dispense with the one-to-one mapping of addresses and bytecode indices, but that would further complicate the VM implementation.</span></span></div><div class="clear"></div>
<div class="linenb">160</div><div class="codeline">A similar problem has already been discussed in~\cref{pynand} to explain why translating bytecode to assembly is not a good solution for this project.</div><div class="clear"></div>
<div class="linenb">161</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">162</div><div class="codeline">For the reasons mentioned above, the new emulator actually uses the fixed size bytecode representation, which was implemented with enums~\ref{lst:enum-bytecode}.</div><div class="clear"></div>
<div class="linenb">163</div><div class="codeline">Enums allow the programmer to define a type by enumerating its possible variants~\cite[<span class="highlight-sh" title="Do not refer to chapters using hard-coded numbers. Use \ref instead. [sh:hccha]">Chapter~6</span>]{klabnik2019rust}.</div><div class="clear"></div>
<div class="linenb">164</div><div class="codeline">Unlike unions, enums contain the information to identify the content currently stored in them.</div><div class="clear"></div>
<div class="linenb">165</div><div class="codeline">Their variants can also have different fields, which makes them much more powerful than enums in C.</div><div class="clear"></div>
<div class="linenb">166</div><div class="codeline">Rust enums are closer to tagged unions in C, a combination of a union with a tag to identify the variant used.</div><div class="clear"></div>
<div class="linenb">167</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">168</div><div class="codeline">  language=Rust,</div><div class="clear"></div>
<div class="linenb">169</div><div class="codeline">  label={lst:enum-bytecode},</div><div class="clear"></div>
<div class="linenb">170</div><div class="codeline">  caption={The bytecode representation used in the final implementation.},</div><div class="clear"></div>
<div class="linenb">171</div><div class="codeline">  captionpos=b</div><div class="clear"></div>
<div class="linenb">172</div><div class="codeline">  ]</div><div class="clear"></div>
<div class="linenb">173</div><div class="codeline">  pub enum Instruction {</div><div class="clear"></div>
<div class="linenb">174</div><div class="codeline">    Add,</div><div class="clear"></div>
<div class="linenb">175</div><div class="codeline">    Sub,</div><div class="clear"></div>
<div class="linenb">176</div><div class="codeline">    // [...]</div><div class="clear"></div>
<div class="linenb">177</div><div class="codeline">    Push { segment: Segment, index: Word },</div><div class="clear"></div>
<div class="linenb">178</div><div class="codeline">    Pop { segment: Segment, index: Word },</div><div class="clear"></div>
<div class="linenb">179</div><div class="codeline">    Function { n_locals: Word },</div><div class="clear"></div>
<div class="linenb">180</div><div class="codeline">    Call { function: Word, n_args: Word },</div><div class="clear"></div>
<div class="linenb">181</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">182</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">183</div><div class="codeline">Enums are typically used in conjunction with pattern matching, a feature that allows the programmer to compare a value against a series of patterns and then execute code based on which pattern matches~\cite[<span class="highlight-sh" title="Do not refer to chapters using hard-coded numbers. Use \ref instead. [sh:hccha]">Chapter~6</span>.2]{klabnik2019rust}.</div><div class="clear"></div>
<div class="linenb">184</div><div class="codeline">This makes it very easy to not only identify the current instruction, but also extract all the necessary data from it.</div><div class="clear"></div>
<div class="linenb">185</div><div class="codeline">With this approach, an entire instruction with all of its arguments is now contained in a single instance of the instruction enum.</div><div class="clear"></div>
<div class="linenb">186</div><div class="codeline">\cref{lst:bytecode-pattern-matching} shows how pattern matching can be used in combination with enums to implement the decoding phase of the VM cycle in a clear and concise way by directly extracting the arguments of, for example, push and function instructions and binding them to new local names.</div><div class="clear"></div>
<div class="linenb">187</div><div class="codeline">The ``tos\_binary!'' and ``?'' will be explained in~\cref{macros-and-error-handling}.</div><div class="clear"></div>
<div class="linenb">188</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">189</div><div class="codeline">  language=Rust,</div><div class="clear"></div>
<div class="linenb">190</div><div class="codeline">  label={lst:bytecode-pattern-matching},</div><div class="clear"></div>
<div class="linenb">191</div><div class="codeline">  caption={Using pattern matching to deconstruct the instruction data.},</div><div class="clear"></div>
<div class="linenb">192</div><div class="codeline">  captionpos=b</div><div class="clear"></div>
<div class="linenb">193</div><div class="codeline">  ]</div><div class="clear"></div>
<div class="linenb">194</div><div class="codeline">  match instruction {</div><div class="clear"></div>
<div class="linenb">195</div><div class="codeline">    Add =&gt; tos_binary!(self, +),</div><div class="clear"></div>
<div class="linenb">196</div><div class="codeline">    // [...]</div><div class="clear"></div>
<div class="linenb">197</div><div class="codeline">    Push { segment, index } =&gt; {</div><div class="clear"></div>
<div class="linenb">198</div><div class="codeline">      let value = self.get_value(segment, index)?;</div><div class="clear"></div>
<div class="linenb">199</div><div class="codeline">      self.push(value)?;</div><div class="clear"></div>
<div class="linenb">200</div><div class="codeline">    }</div><div class="clear"></div>
<div class="linenb">201</div><div class="codeline">    // [...]</div><div class="clear"></div>
<div class="linenb">202</div><div class="codeline">    Function { n_locals } =&gt; {</div><div class="clear"></div>
<div class="linenb">203</div><div class="codeline">      // initialize all local variables to zero</div><div class="clear"></div>
<div class="linenb">204</div><div class="codeline">      for _ in 0..n_locals {</div><div class="clear"></div>
<div class="linenb">205</div><div class="codeline">        self.push(0)?;</div><div class="clear"></div>
<div class="linenb">206</div><div class="codeline">      }</div><div class="clear"></div>
<div class="linenb">207</div><div class="codeline">    }</div><div class="clear"></div>
<div class="linenb">208</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">209</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">210</div><div class="codeline"><span class="keyword1">\label</span>{call-instruction}</div><div class="clear"></div>
<div class="linenb">211</div><div class="codeline">The size of the enum type corresponds to the size of its largest variant in addition to a tag, so padding bytes must be added at the end of smaller variants.</div><div class="clear"></div>
<div class="linenb">212</div><div class="codeline">So why is the disadvantage of wasting space for smaller instructions not as significant as it first seems?</div><div class="clear"></div>
<div class="linenb">213</div><div class="codeline">By writing a script that groups the lines of all bytecode files in a directory based on their first word, one can analyze the frequency of different instructions in VM programs.</div><div class="clear"></div>
<div class="linenb">214</div><div class="codeline">In fact, analysis of several different Jack programs~\ref{table:tested} and the Jack standard library showed that push and pop together account for about 70\% of all bytecode instructions in real programs, while call instructions make up another 10\%.</div><div class="clear"></div>
<div class="linenb">215</div><div class="codeline">Call instructions in the new emulator are not dispatched based on the function name.</div><div class="clear"></div>
<div class="linenb">216</div><div class="codeline">Instead, the bytecode parser already resolves the name to the index of the function within the bytecode vector~\ref{bytecode-parser}, therefore enabling the VM to simply set the program counter to that value directly.</div><div class="clear"></div>
<div class="linenb">217</div><div class="codeline">This has the additional benefit of making the Call instruction, which would otherwise be the largest variant, the same size as the push and pop instructions.</div><div class="clear"></div>
<div class="linenb">218</div><div class="codeline">Since these instructions have the same maximum size, only 20\% of instructions need padding at all.</div><div class="clear"></div>
<div class="linenb">219</div><div class="codeline">Based on this, the padding caused by using enums is not really relevant for the memory requirements and cache efficiency of actual programs.</div><div class="clear"></div>
<div class="linenb">220</div><div class="codeline">Compared to the bytecode representation in the official emulator, this enum based approach is also still more efficient because it contains no pointers and therefore no indirections.</div><div class="clear"></div>
<div class="linenb">221</div><div class="codeline">It also does not resolve functions by their names at runtime, which makes call instructions faster.</div><div class="clear"></div>
<div class="linenb">222</div><div class="codeline">For the above reasons, the fixed size representation is a good choice, both for performance and ease of use during development.</div><div class="clear"></div>
<div class="linenb">223</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">224</div><div class="codeline"><span class="keyword1">\subsubsection</span>{Step by step execution with pattern matching} <span class="keyword1">\label</span>{step-by-step}</div><div class="clear"></div>
<div class="linenb">225</div><div class="codeline">The architecture with its different entry points and ways to use the emulators~\ref{fig:arch} places unique demands on the VM implementation.</div><div class="clear"></div>
<div class="linenb">226</div><div class="codeline">In order to satisfy all those requirements, the VM runs in a way that executes one step at a time and is able to be suspended after each of those steps.</div><div class="clear"></div>
<div class="linenb">227</div><div class="codeline">This constraint will be especially important for the interaction with native rust code in the standard library~\ref{jack-stdlib-in-rust}.</div><div class="clear"></div>
<div class="linenb">228</div><div class="codeline">In each step, the VM first fetches the current instruction from the loaded program, then performs pattern matching to extract all the required data and finally executes the instruction.</div><div class="clear"></div>
<div class="linenb">229</div><div class="codeline">The matching process can be seen in \cref{lst:bytecode-pattern-matching}, where the segment and index of a push instruction are extracted and then used to first load the value with another method and then push it onto the stack.</div><div class="clear"></div>
<div class="linenb">230</div><div class="codeline">Rusts pattern matching handles the selection of the correct branch automatically.</div><div class="clear"></div>
<div class="linenb">231</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">232</div><div class="codeline"><span class="keyword1">\subsubsection</span>{Macros and error handling in Rust} <span class="keyword1">\label</span>{macros-and-error-handling}</div><div class="clear"></div>
<div class="linenb">233</div><div class="codeline">Macros are a way of writing code that writes other code, which is known as metaprogramming~\cite[<span class="highlight-sh" title="Do not refer to chapters using hard-coded numbers. Use \ref instead. [sh:hccha]">Chapter~1</span>9.5]{klabnik2019rust}.</div><div class="clear"></div>
<div class="linenb">234</div><div class="codeline">They allow the programmer to extend the language in certain ways that would not be possible with functions alone.</div><div class="clear"></div>
<div class="linenb">235</div><div class="codeline">One of those ways is the ability to pass language operators, such as ``+'', as arguments.</div><div class="clear"></div>
<div class="linenb">236</div><div class="codeline">Passing an operator to a function would only be possible if that operator was also wrapped in another function, but with macros any token can be passed as an argument.</div><div class="clear"></div>
<div class="linenb">237</div><div class="codeline">Another advantage of macros is that, unlike functions, they have no runtime overhead, since the code is only inserted at the position of the caller, without an actual function call at runtime.</div><div class="clear"></div>
<div class="linenb">238</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">239</div><div class="codeline">In the code examples in the sections above, there are several lines that end with a question mark.</div><div class="clear"></div>
<div class="linenb">240</div><div class="codeline">This is a direct consequence of the fact that Rust does not support exceptions.</div><div class="clear"></div>
<div class="linenb">241</div><div class="codeline">Instead it groups errors into two major categories: recoverable and unrecoverable errors~\cite[<span class="highlight-sh" title="Do not refer to chapters using hard-coded numbers. Use \ref instead. [sh:hccha]">Chapter~9</span>]{klabnik2019rust}.</div><div class="clear"></div>
<div class="linenb">242</div><div class="codeline">Functions that have recoverable errors, such as a file not found error, return an explicit result type that can be either an error or the expected return type.</div><div class="clear"></div>
<div class="linenb">243</div><div class="codeline">Of course, this result type is implemented as an enum, which allows the use of pattern matching to handle errors.</div><div class="clear"></div>
<div class="linenb">244</div><div class="codeline">To simplify the handling of recoverable errors, Rust offers the question mark operator.</div><div class="clear"></div>
<div class="linenb">245</div><div class="codeline">This operator can be placed after any expression that has a result type.</div><div class="clear"></div>
<div class="linenb">246</div><div class="codeline">If the expression was an error, that error is immediately returned as the return value of the entire function.</div><div class="clear"></div>
<div class="linenb">247</div><div class="codeline">On the other hand, if the expression was an actual value, that value is automatically unwrapped, allowing it to be used without further checking.</div><div class="clear"></div>
<div class="linenb">248</div><div class="codeline">This drastically reduces the amount of code required to handle errors, while still keeping all the error handling explicit.</div><div class="clear"></div>
<div class="linenb">249</div><div class="codeline">\cref{lst:bytecode-pattern-matching} shows this in three of its lines.</div><div class="clear"></div>
<div class="linenb">250</div><div class="codeline">The \verb+get_value+ method in line 5 returns a result that should contain the value of the memory at the specified index in the specified segment.</div><div class="clear"></div>
<div class="linenb">251</div><div class="codeline">But it could also be an error if the calculated address is outside the available memory area.</div><div class="clear"></div>
<div class="linenb">252</div><div class="codeline">If it is an error, the surrounding function returns immediately with this error as return value.</div><div class="clear"></div>
<div class="linenb">253</div><div class="codeline">Otherwise, the following code can assume that a correct value was read.</div><div class="clear"></div>
<div class="linenb">254</div><div class="codeline">The emulator specific error types are located inside the error package of each emulator module~\ref{fig:arch}.</div><div class="clear"></div>
<div class="linenb">255</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">256</div><div class="codeline">Unrecoverable errors, in contrast, do not need to be visible to the programmer because, by definition, the programmer cannot handle them.</div><div class="clear"></div>
<div class="linenb">257</div><div class="codeline">They will cause the program to abort immediately and should be used only when absolutely necessary.</div><div class="clear"></div>
<div class="linenb">258</div><div class="codeline">To provide a good user experience, none of the emulator-related code contains unrecoverable errors.</div><div class="clear"></div>
<div class="linenb">259</div><div class="codeline">The only errors of this kind are in the native interfaces to the application, for example, if the window could not be initialized in desktop mode because the application is running on a server without graphical capabilities.</div><div class="clear"></div>
<div class="linenb">260</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">261</div><div class="codeline"><span class="keyword1">\subsection</span>{Parser development in Rust} <span class="keyword1">\label</span>{parser-dev}</div><div class="clear"></div>
<div class="linenb">262</div><div class="codeline">Parsing usually consists of at least two stages, the first being lexical analysis, also known as tokenization.</div><div class="clear"></div>
<div class="linenb">263</div><div class="codeline">At this stage, the individual characters of the input are grouped into tokens, which are assigned tags such as symbol, number, or keyword.</div><div class="clear"></div>
<div class="linenb">264</div><div class="codeline">This is followed by the actual parsing stage, where the tokens are further grouped into constructs, such as arithmetic expressions or loops.</div><div class="clear"></div>
<div class="linenb">265</div><div class="codeline">In its simplest form, a token is a tuple of a piece of the original source code, called a lexeme, and the tag that assigns a specific meaning to the lexeme.</div><div class="clear"></div>
<div class="linenb">266</div><div class="codeline"><span class="comment"><span class="comment">% Some things, such as parsing integer literals from strings into actual numbers, can be done either within the lexer or, alternatively, only during the actual code generation or interpretation of the program~\cite{nystrom2021crafting}.</span></span></div><div class="clear"></div>
<div class="linenb">267</div><div class="codeline">Neither bytecode nor assembly really has any complex constructs, since both are already flat lists of instructions.</div><div class="clear"></div>
<div class="linenb">268</div><div class="codeline">The test scripts, on the other hand, also contain more complex instructions, such as repeat, which is essentially a for loop.</div><div class="clear"></div>
<div class="linenb">269</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">270</div><div class="codeline"><span class="keyword1">\subsubsection</span>{Generic lexer}</div><div class="clear"></div>
<div class="linenb">271</div><div class="codeline">Much of the lexical analysis code can be shared by all three parsers.</div><div class="clear"></div>
<div class="linenb">272</div><div class="codeline">At its core, a lexer only needs to consume characters as long as certain conditions are met, and then return a token containing those characters, their position in the original source code for error reporting, and the type of token that was consumed.</div><div class="clear"></div>
<div class="linenb">273</div><div class="codeline">The generic lexer therefore offers a method \verb+take_chars_while+, which again takes a higher order predicate function as its argument.</div><div class="clear"></div>
<div class="linenb">274</div><div class="codeline">This predicate function is evaluated for each character, starting from the current position of the lexer, until it returns false for the first time.</div><div class="clear"></div>
<div class="linenb">275</div><div class="codeline">Then all characters that evaluated true when applied to the predicate are returned as a single string with information about the token's position.</div><div class="clear"></div>
<div class="linenb">276</div><div class="codeline">A possible predicate might be \verb+char::is_numeric+ which tests if a given character is a digit.</div><div class="clear"></div>
<div class="linenb">277</div><div class="codeline">So calling \verb+generic_lexer.take_chars_while(char::is_numeric)+ would consume an entire number from the input string and return it wrapped in a span.</div><div class="clear"></div>
<div class="linenb">278</div><div class="codeline"><span class="keyword1">\label</span>{spans}</div><div class="clear"></div>
<div class="linenb">279</div><div class="codeline">The span is a structure that can wrap any generic inner type with information about its position in the source code, e.g.\ the line where the element occured.</div><div class="clear"></div>
<div class="linenb">280</div><div class="codeline">This information can later be used to improve error messages for the programmer by indicating not only what went wrong, but also where the error happened.</div><div class="clear"></div>
<div class="linenb">281</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">282</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsubsection</span>{Peekable as an example for the usefulness of traits}</span></span></div><div class="clear"></div>
<div class="linenb">283</div><div class="codeline"><span class="comment"><span class="comment">% Each parser has its own lexer, which in turn uses the generic lexer internally.</span></span></div><div class="clear"></div>
<div class="linenb">284</div><div class="codeline"><span class="comment"><span class="comment">% The lexers themselves are quite simple.</span></span></div><div class="clear"></div>
<div class="linenb">285</div><div class="codeline"><span class="comment"><span class="comment">% They simply encode the rules for each token into predicates, which are then passed to the generic lexer, and then convert the string returned by that lexer into the correct token type.</span></span></div><div class="clear"></div>
<div class="linenb">286</div><div class="codeline"><span class="comment"><span class="comment">% To provide a more uniform interface, these lexers also implement one of Rust's most important traits, the Iterator trait.</span></span></div><div class="clear"></div>
<div class="linenb">287</div><div class="codeline"><span class="comment"><span class="comment">% This interface allows the use of types within for-each loops by providing a ``next'' method that can return the next element or nothing.</span></span></div><div class="clear"></div>
<div class="linenb">288</div><div class="codeline"><span class="comment"><span class="comment">% This would be useful in and of itself, but Rusts powerful type system offers the ability to extend types that satisfy certain conditions by wrapping them with other types that offer even more functionality.</span></span></div><div class="clear"></div>
<div class="linenb">289</div><div class="codeline"><span class="comment"><span class="comment">% One such type is called Peekable, which can be wrapped around any other type that implements the Iterator trait, allowing the user to peek at the next item without actually consuming it.</span></span></div><div class="clear"></div>
<div class="linenb">290</div><div class="codeline"><span class="comment"><span class="comment">% Rust calls features like this ``zero cost abstractions'' because there is no runtime overhead compared to adding the functionality directly to each lexer.</span></span></div><div class="clear"></div>
<div class="linenb">291</div><div class="codeline"><span class="comment"><span class="comment">% It is not implemented via dynamic dispatch, but is fully resolved at compile time.</span></span></div><div class="clear"></div>
<div class="linenb">292</div><div class="codeline"><span class="comment"><span class="comment">% In addition, the Peekable type itself also implements the Iterator trait, so it just extends the interface without removing any functionality.</span></span></div><div class="clear"></div>
<div class="linenb">293</div><div class="codeline"><span class="comment"><span class="comment">% Any type that implements the Iterator trait automatically has a ``peekable'' method that returns the Iterator instance wrapped in this type.</span></span></div><div class="clear"></div>
<div class="linenb">294</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">295</div><div class="codeline"><span class="keyword1">\subsubsection</span>{The bytecode parser} <span class="keyword1">\label</span>{bytecode-parser}</div><div class="clear"></div>
<div class="linenb">296</div><div class="codeline">The bytecode parser is the simplest of the three parsers.</div><div class="clear"></div>
<div class="linenb">297</div><div class="codeline">As shown in~\cref{lst:hack-bytecode}, it is a flat and simple format, with simple and well-defined rules.</div><div class="clear"></div>
<div class="linenb">298</div><div class="codeline">Nevertheless, it has some complexity due to the way symbols are resolved.</div><div class="clear"></div>
<div class="linenb">299</div><div class="codeline">Functions and labels both declare symbols, which can be referenced before they are declared.</div><div class="clear"></div>
<div class="linenb">300</div><div class="codeline">This is relevant because, as described in~\cref{call-instruction}, call instructions and labels are resolved into indices in the program vector during parsing.</div><div class="clear"></div>
<div class="linenb">301</div><div class="codeline">To achieve this, the parsing is divided into two different steps.</div><div class="clear"></div>
<div class="linenb">302</div><div class="codeline">The first step is to parse the source code from beginning to end.</div><div class="clear"></div>
<div class="linenb">303</div><div class="codeline">At this stage, the bytecode vector does not yet contain the completed instructions.</div><div class="clear"></div>
<div class="linenb">304</div><div class="codeline">It instead contains instances of an enum, which can be either a fully resolved instruction or a partially constructed instruction with an symbol it is waiting for.</div><div class="clear"></div>
<div class="linenb">305</div><div class="codeline">While reading the source code, the parser keeps track of all declared functions and labels.</div><div class="clear"></div>
<div class="linenb">306</div><div class="codeline">When such an symbol is referenced in the code, the parser tries to find it in the environment.</div><div class="clear"></div>
<div class="linenb">307</div><div class="codeline">If the symbol is already declared, the instruction is inserted into the result vector as a fully resolved instruction.</div><div class="clear"></div>
<div class="linenb">308</div><div class="codeline">However, if the instruction references an undeclared symbol, the instruction is inserted with a placeholder and another string with the name of the missing symbol.</div><div class="clear"></div>
<div class="linenb">309</div><div class="codeline">These placeholders are then replaced with the correct indices in the second stage.</div><div class="clear"></div>
<div class="linenb">310</div><div class="codeline">Here the parser iterates over the previous result vector and handles any instructions with placeholders.</div><div class="clear"></div>
<div class="linenb">311</div><div class="codeline">This process of filling in the missing information is commonly referred to as backpatching.</div><div class="clear"></div>
<div class="linenb">312</div><div class="codeline">At the end, the parser performs a final check to see if there are any unresolved symbols left.</div><div class="clear"></div>
<div class="linenb">313</div><div class="codeline">Should this be the case, it returns an error, otherwise the parser is done.</div><div class="clear"></div>
<div class="linenb">314</div><div class="codeline">One thing which has yet to be explained: If function dispatching is based on the function's index in the program's bytecode vector, how are built-in standard library functions called?</div><div class="clear"></div>
<div class="linenb">315</div><div class="codeline">These functions are not part of the bytecode and therefore not included in the parsed program.</div><div class="clear"></div>
<div class="linenb">316</div><div class="codeline">They are assigned the highest possible addresses that would be valid indices into the bytecode vector.</div><div class="clear"></div>
<div class="linenb">317</div><div class="codeline">So if \(N\) is the largest integer that still fits into the index type, and if \(n\) is the number of standard library functions, then the addresses in the range \([N - n + 1, N]\) are used to call those functions.</div><div class="clear"></div>
<div class="linenb">318</div><div class="codeline">These addresses are not really part of the bytecode, they are just numbers known to the emulator that resolve to the implementation of a function in the native standard library, rather than a real instruction in the bytecode.</div><div class="clear"></div>
<div class="linenb">319</div><div class="codeline">The exact index for each standard library function is determined before parsing, so the parser can simply replace any symbol referring to such a function with the correct index.</div><div class="clear"></div>
<div class="linenb">320</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">321</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">322</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">323</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=12cm]{fig/bytecode-parsing.png}</div><div class="clear"></div>
<div class="linenb">324</div><div class="codeline">    <span class="keyword1">\caption</span>{The two stages of bytecode parsing.}</div><div class="clear"></div>
<div class="linenb">325</div><div class="codeline">    <span class="keyword1">\label</span>{fig:bytecode-parsing}</div><div class="clear"></div>
<div class="linenb">326</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">327</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">328</div><div class="codeline">The connection between this index and the associated symbol can be resolved bidirectionally, so the VM can also resolve any call with an index greater than \(N - n\) to the appropriate native function.</div><div class="clear"></div>
<div class="linenb">329</div><div class="codeline">This process can be seen in~\cref{fig:bytecode-parsing}, were the \verb+foo+ call is resolved to an actual index in the result, while the \verb+Math.multiply+ call is resolved to the highest possible index.</div><div class="clear"></div>
<div class="linenb">330</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">331</div><div class="codeline"><span class="keyword1">\subsection</span>{The test script workflow} <span class="keyword1">\label</span>{test-script-workflow}</div><div class="clear"></div>
<div class="linenb">332</div><div class="codeline">To allow automatic testing of student submissions, the Nand to Tetris course includes test scripts for most of its projects.</div><div class="clear"></div>
<div class="linenb">333</div><div class="codeline">These scripts are able to load programs depending on the emulator, set internal values in the emulator's memory, execute the program in a certain way, and then compare the values at specific memory addresses in the emulator with expected values loaded from a file.</div><div class="clear"></div>
<div class="linenb">334</div><div class="codeline">This functionality is not only useful for students, but also for the instructors of the course.</div><div class="clear"></div>
<div class="linenb">335</div><div class="codeline">As described in~\cref{test-scripts}, Test scripts share most of their functionality and syntax between all three simulators, but there are some simulator-specific features that pose a challenge to implementation.</div><div class="clear"></div>
<div class="linenb">336</div><div class="codeline">The application must know which emulator the script is to be run in, so that only the correct instructions are parsed and executed.</div><div class="clear"></div>
<div class="linenb">337</div><div class="codeline">Since the different emulators actually produce different executables~\ref{interfaces}, the emulator is already known, but it is not immediately obvious how to structure the code to allow only some of the possible commands to occur and be executed based on the current interface, while sharing as much code as possible.</div><div class="clear"></div>
<div class="linenb">338</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">339</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsubsection</span>{Traits as an alternative to inheritance}</span></span></div><div class="clear"></div>
<div class="linenb">340</div><div class="codeline">In an object-oriented language, functionality like that described above would probably be implemented using abstract classes or interfaces.</div><div class="clear"></div>
<div class="linenb">341</div><div class="codeline">There might be an abstract test script parser from which the specific parsers for the VM, CPU, and hardware simulator would inherit.</div><div class="clear"></div>
<div class="linenb">342</div><div class="codeline">The simulators could also inherit from an abstract script executor class that would implement most of the commands, leaving only the emulator-specific commands to the subclasses.</div><div class="clear"></div>
<div class="linenb">343</div><div class="codeline">While Rust supports dynamic dispatch, it does not provide inheritance as a feature of the language.</div><div class="clear"></div>
<div class="linenb">344</div><div class="codeline">But it does offer a powerful system of type parameters and traits to specify constraints on those types.</div><div class="clear"></div>
<div class="linenb">345</div><div class="codeline">Methods can be implemented not only directly on types, but also conditionally if a combination of types matches certain properties.</div><div class="clear"></div>
<div class="linenb">346</div><div class="codeline">The generic test script parser expects an emulator-specific command parser as its type parameter.</div><div class="clear"></div>
<div class="linenb">347</div><div class="codeline">All methods of the generic parser are not actually implemented directly on this parser.</div><div class="clear"></div>
<div class="linenb">348</div><div class="codeline">They are instead implemented only if the combination of the generic base parser and the simulator-specific parser together implement the ScriptParser trait.</div><div class="clear"></div>
<div class="linenb">349</div><div class="codeline">The actual implementation of the parser interface is therefore not part of the module containing the generic parser.</div><div class="clear"></div>
<div class="linenb">350</div><div class="codeline">Rather, it is implemented in the simulator-specific modules.</div><div class="clear"></div>
<div class="linenb">351</div><div class="codeline">This process is more complicated than the object-oriented solution, but has the advantage of working without dynamic dispatch.</div><div class="clear"></div>
<div class="linenb">352</div><div class="codeline">The type parameters for the simulator-specific commands can also be used to guarantee that the emulator really expects the same commands that the parser returns.</div><div class="clear"></div>
<div class="linenb">353</div><div class="codeline">The code is presented in a simplified version in~\cref{lst:generic-parser} and~\cref{lst:vm-parser}.</div><div class="clear"></div>
<div class="linenb">354</div><div class="codeline">In the real program, this code is more complicated due to some details of the Rust type system that do not add to the understanding of the core principles at work, so those have been omitted.</div><div class="clear"></div>
<div class="linenb">355</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">356</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">357</div><div class="codeline">  language=Rust,</div><div class="clear"></div>
<div class="linenb">358</div><div class="codeline">  label={lst:generic-parser},</div><div class="clear"></div>
<div class="linenb">359</div><div class="codeline">  caption={The generic base parser for test scripts},</div><div class="clear"></div>
<div class="linenb">360</div><div class="codeline">  captionpos=b</div><div class="clear"></div>
<div class="linenb">361</div><div class="codeline">  ]</div><div class="clear"></div>
<div class="linenb">362</div><div class="codeline">  // P is the simulator specific parser</div><div class="clear"></div>
<div class="linenb">363</div><div class="codeline">  // C is the simulator specific command</div><div class="clear"></div>
<div class="linenb">364</div><div class="codeline">  pub struct ScriptParser&lt;P, C&gt; {</div><div class="clear"></div>
<div class="linenb">365</div><div class="codeline">    // fields like the peekable lexer</div><div class="clear"></div>
<div class="linenb">366</div><div class="codeline">    [...]</div><div class="clear"></div>
<div class="linenb">367</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">368</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">369</div><div class="codeline">  impl ScriptParser&lt;P, C&gt;</div><div class="clear"></div>
<div class="linenb">370</div><div class="codeline">  where ScriptParser&lt;P, C&gt;: SimulatorCommandParser&lt;C&gt;,</div><div class="clear"></div>
<div class="linenb">371</div><div class="codeline">  {</div><div class="clear"></div>
<div class="linenb">372</div><div class="codeline">    [...]</div><div class="clear"></div>
<div class="linenb">373</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">374</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">375</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">376</div><div class="codeline">The ScriptParser implementation block only becomes relevant if there is an emulator-specific parser that implements the missing parts, as shown for the VM emulator parser in~\cref{lst:vm-parser}.</div><div class="clear"></div>
<div class="linenb">377</div><div class="codeline">Here the SimulatorCommandParser trait is implemented for the ScriptParser in combination with the specific VMEmulatorCommandParser, neither of which would implement the trait on their own.</div><div class="clear"></div>
<div class="linenb">378</div><div class="codeline">This implementation has to contain the missing parse function for VM specific commands.</div><div class="clear"></div>
<div class="linenb">379</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">380</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">381</div><div class="codeline">  language=Rust,</div><div class="clear"></div>
<div class="linenb">382</div><div class="codeline">  label={lst:vm-parser},</div><div class="clear"></div>
<div class="linenb">383</div><div class="codeline">  caption={The VM emulator specific parser for test scripts},</div><div class="clear"></div>
<div class="linenb">384</div><div class="codeline">  captionpos=b</div><div class="clear"></div>
<div class="linenb">385</div><div class="codeline">  ]</div><div class="clear"></div>
<div class="linenb">386</div><div class="codeline">  pub struct VMEmulatorCommandParser {}</div><div class="clear"></div>
<div class="linenb">387</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">388</div><div class="codeline">  impl SimulatorCommandParser&lt;VMEmulatorCommand&gt;</div><div class="clear"></div>
<div class="linenb">389</div><div class="codeline">  for ScriptParser&lt;VMEmulatorCommandParser, VMEmulatorCommand&gt;</div><div class="clear"></div>
<div class="linenb">390</div><div class="codeline">  {</div><div class="clear"></div>
<div class="linenb">391</div><div class="codeline">    [...]</div><div class="clear"></div>
<div class="linenb">392</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">393</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">394</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">395</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsubsection</span>{Compile time check for the combination of parser and executor}</span></span></div><div class="clear"></div>
<div class="linenb">396</div><div class="codeline">So far we have looked at the implementation of the test script parser, but of course the scripts need to be executed to be useful.</div><div class="clear"></div>
<div class="linenb">397</div><div class="codeline">Just like parsing, most of the logic is shared among all simulators, which means that individual emulators should implement only the commands that are unique to them and share all other code.</div><div class="clear"></div>
<div class="linenb">398</div><div class="codeline">The trait that specifies these methods also has a generic type parameter, just like the ``C'' parameter in~\cref{lst:generic-parser}.</div><div class="clear"></div>
<div class="linenb">399</div><div class="codeline">This ensures at compile time that the parser and executor are compatible.</div><div class="clear"></div>
<div class="linenb">400</div><div class="codeline">Rust's powerful type inference even allows it to determine the correct script parser implementation based on the executor provided.</div><div class="clear"></div>
<div class="linenb">401</div><div class="codeline">The various interfaces can simply call the \verb+execute_script+ function with one of the simulators as its argument and the compiler will automatically infer the correct parser.</div><div class="clear"></div>
<div class="linenb">402</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">403</div><div class="codeline"><span class="keyword1">\subsection</span>{The native standard library protocol} <span class="keyword1">\label</span>{jack-stdlib-in-rust}</div><div class="clear"></div>
<div class="linenb">404</div><div class="codeline">Theoretically, the VM could simply use the implementation of the standard library written directly in bytecode.</div><div class="clear"></div>
<div class="linenb">405</div><div class="codeline">From a functionality point of view, this implementation is almost identical to the Java implementation in the official emulator~\ref{sys.wait-example}.</div><div class="clear"></div>
<div class="linenb">406</div><div class="codeline">The reason the official emulator still has a version of this library implemented in Java is the same reason the new emulator has a Rust version of the standard library.</div><div class="clear"></div>
<div class="linenb">407</div><div class="codeline">It is much faster.</div><div class="clear"></div>
<div class="linenb">408</div><div class="codeline">A simple example to show the huge impact is \verb+Math.multiply+.</div><div class="clear"></div>
<div class="linenb">409</div><div class="codeline">The VM does not have its own multiply instruction, but relies on a software solution within the standard library.</div><div class="clear"></div>
<div class="linenb">410</div><div class="codeline">During code generation, the compiler automatically converts any multiplication in the source code into a call to this function.</div><div class="clear"></div>
<div class="linenb">411</div><div class="codeline">The multiplication function contains 92 lines of code with calls to \verb+Math.abs+ and a loop that executes 16 times, once for each bit in the two-byte integer.</div><div class="clear"></div>
<div class="linenb">412</div><div class="codeline">A simple multiplication therefore requires hundreds of VM ticks to execute.</div><div class="clear"></div>
<div class="linenb">413</div><div class="codeline">In the native Rust implementation, it requires only a single tick.</div><div class="clear"></div>
<div class="linenb">414</div><div class="codeline">Other, more complicated functions may be executed less frequently, but the performance impact here is even greater.</div><div class="clear"></div>
<div class="linenb">415</div><div class="codeline">Providing a native implementation of these functions is therefore one of the most important possible performance improvements.</div><div class="clear"></div>
<div class="linenb">416</div><div class="codeline">Unfortunately, it is not trivial to provide such an implementation for several reasons.</div><div class="clear"></div>
<div class="linenb">417</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">418</div><div class="codeline"><span class="keyword1">\subsubsection</span>{The issues with native functions in the virtual machine} <span class="keyword1">\label</span>{stdlib-issues}</div><div class="clear"></div>
<div class="linenb">419</div><div class="codeline">There are several problems with integrating native code with bytecode.</div><div class="clear"></div>
<div class="linenb">420</div><div class="codeline">First and foremost is the fundamentally different execution model.</div><div class="clear"></div>
<div class="linenb">421</div><div class="codeline">The VM runs tick-based, i.e.\ it executes one instruction per tick, so it is possible to stop after each instruction.</div><div class="clear"></div>
<div class="linenb">422</div><div class="codeline">This is not the case with Rust code, as we cannot stop a function in the middle of execution and resume it at a later time.</div><div class="clear"></div>
<div class="linenb">423</div><div class="codeline">It is also not possible to simply run the entire function to completion within a single VM tick.</div><div class="clear"></div>
<div class="linenb">424</div><div class="codeline">Some functions in the standard library run in an infinite loop, such as \verb+Keyboard.readLine+, which does not return until the user presses the Enter key on their keyboard.</div><div class="clear"></div>
<div class="linenb">425</div><div class="codeline">Another difficult function is \verb+Sys.wait+, which takes a number as input and waits approximately that many milliseconds.</div><div class="clear"></div>
<div class="linenb">426</div><div class="codeline">Targeting the web browser makes this function difficult to implement, as WebAssembly does not support multiple threads at the time of writing.</div><div class="clear"></div>
<div class="linenb">427</div><div class="codeline">\verb+Sys.wait+ cannot block the only available thread, because this would cause the entire application to become unreponsive.</div><div class="clear"></div>
<div class="linenb">428</div><div class="codeline">The implementation is further complicated by the fact that the communication is bidirectional.</div><div class="clear"></div>
<div class="linenb">429</div><div class="codeline">Jack's standard library may only be partially implemented natively and partially as VM bytecode.</div><div class="clear"></div>
<div class="linenb">430</div><div class="codeline">This is especially likely in Project 12, where students are expected to implement the standard library themselves.</div><div class="clear"></div>
<div class="linenb">431</div><div class="codeline">Some functions of the standard library depend on other functions of the standard library, such as \verb+Output.printString+, which must call \verb+String.length+ to work.</div><div class="clear"></div>
<div class="linenb">432</div><div class="codeline">The call to the actual length function is important here because the internal representation of strings is not part of the specification, only the interface.</div><div class="clear"></div>
<div class="linenb">433</div><div class="codeline">To summarize, the bytecode must be able to call native Rust functions, and these native Rust functions must in turn be able to call functions implemented in bytecode.</div><div class="clear"></div>
<div class="linenb">434</div><div class="codeline">In addition, there must be a way to stop the native functions like any other bytecode function, with the ability to resume execution at any time in the future, either based on user input, elapsed time, or other conditions.</div><div class="clear"></div>
<div class="linenb">435</div><div class="codeline">The official implementation can work around many of these problems by using multiple threads that can actually be paused and resumed based on conditions.</div><div class="clear"></div>
<div class="linenb">436</div><div class="codeline">Since this is not possible in WebAssembly, a new way of handling native standard library functions is required.</div><div class="clear"></div>
<div class="linenb">437</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">438</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">439</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> step by step execution -&gt; no waiting</span></span></div><div class="clear"></div>
<div class="linenb">440</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> vm functions can call rust functions</span></span></div><div class="clear"></div>
<div class="linenb">441</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> rust functions can call vm functions</span></span></div><div class="clear"></div>
<div class="linenb">442</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">443</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">444</div><div class="codeline"><span class="keyword1">\subsubsection</span>{Solving those issues with a Finite-state machine}</div><div class="clear"></div>
<div class="linenb">445</div><div class="codeline">To solve the problems described above, the new emulator uses finite-state machines.</div><div class="clear"></div>
<div class="linenb">446</div><div class="codeline">Finite-state machines (FSMs) are a common model in computer science with a wide range of applications.</div><div class="clear"></div>
<div class="linenb">447</div><div class="codeline">An FSM can only ever be in one of a finite number of states and can transition between these states based on conditions~\cite{sakarovitch2009elements}.</div><div class="clear"></div>
<div class="linenb">448</div><div class="codeline">The functions in the Jack standard library do not need to be able to pause at any point in the code.</div><div class="clear"></div>
<div class="linenb">449</div><div class="codeline">Instead, there are certain points at which the function can be paused, such as by calling another function, whether a VM or a native function, or by explicitly waiting for the next tick.</div><div class="clear"></div>
<div class="linenb">450</div><div class="codeline">This allows these functions to be represented as FSMs, where each state is a non-interruptible code block after which the function is automatically suspended.</div><div class="clear"></div>
<div class="linenb">451</div><div class="codeline">Each of these code blocks returns the next state to be executed as a return value and thus serves as a transition.</div><div class="clear"></div>
<div class="linenb">452</div><div class="codeline">When the function finishes its execution, a special state is returned, otherwise the function continues in the state returned by the last block in the next tick of the VM.</div><div class="clear"></div>
<div class="linenb">453</div><div class="codeline">In practice, this means that each time a native function is called in the VM, a state argument is passed in addition to the VM instance and formal parameters.</div><div class="clear"></div>
<div class="linenb">454</div><div class="codeline">This state is actually just a 32-bit integer that is initially set to zero.</div><div class="clear"></div>
<div class="linenb">455</div><div class="codeline">The emulator manages an internal call stack, in addition to the one that is naturally built on the global stack by the VM function call protocol.</div><div class="clear"></div>
<div class="linenb">456</div><div class="codeline">With every function call, a new element is pushed onto this internal stack.</div><div class="clear"></div>
<div class="linenb">457</div><div class="codeline">For bytecode functions, this is useful for displaying the current call stack in the user interface, but for native functions it is very important for their functionality, since this stack entry contains the state of that function.</div><div class="clear"></div>
<div class="linenb">458</div><div class="codeline">After a native function is suspended, which in Rust just means a normal return, its state in the stack is set to the newly returned state.</div><div class="clear"></div>
<div class="linenb">459</div><div class="codeline">Or the element is removed from the stack altogether if the special final state is returned.</div><div class="clear"></div>
<div class="linenb">460</div><div class="codeline">Each time the VM is instructed to execute a step, it first checks if the top of the internal call stack is a built-in function that needs to be continued.</div><div class="clear"></div>
<div class="linenb">461</div><div class="codeline">If it is, that function is called again, using the previous return value as the new state.</div><div class="clear"></div>
<div class="linenb">462</div><div class="codeline">Continuing the function in the correct place is then as simple as putting the contents of the native function into a match statement that jumps to the correct branch based on the state argument.</div><div class="clear"></div>
<div class="linenb">463</div><div class="codeline">In addition to the state, the native function receives the VM as a mutable reference and the formal arguments as a vector of words.</div><div class="clear"></div>
<div class="linenb">464</div><div class="codeline">Mutable access to the VM is needed for several functions, e.g.\ drawing to the display memory to display something on the screen.</div><div class="clear"></div>
<div class="linenb">465</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">466</div><div class="codeline">This system is powerful enough to solve all of the aforementioned problems if applied correctly, which is not trivial for every function, as can be seen in~\cref{complex-example}.</div><div class="clear"></div>
<div class="linenb">467</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">468</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> args passed as vector</span></span></div><div class="clear"></div>
<div class="linenb">469</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> vm is also passed mutably</span></span></div><div class="clear"></div>
<div class="linenb">470</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> state (integer, initially 0) is always passed to stdlib function</span></span></div><div class="clear"></div>
<div class="linenb">471</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> stdlib function returns either Done or next state</span></span></div><div class="clear"></div>
<div class="linenb">472</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> next time it's called with next state (if not finished)</span></span></div><div class="clear"></div>
<div class="linenb">473</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">474</div><div class="codeline"><span class="keyword1">\subsubsection</span>{Example:<span class="highlight-sh" title="There should be a space after a period. If you are writing a URL or a filename, use the \url{} or \verb markup. [sh:d:002]"> Sys.wa</span>it} <span class="keyword1">\label</span>{sys.wait-example}</div><div class="clear"></div>
<div class="linenb">475</div><div class="codeline">\verb+Sys.wait+~\ref{lst:sys.wait} is a good example of how the state argument can be used.</div><div class="clear"></div>
<div class="linenb">476</div><div class="codeline">Since state is just an alias for u32, a 32-bit unsigned integer, it can be used as a counter.</div><div class="clear"></div>
<div class="linenb">477</div><div class="codeline">The first time the function is called, the state is \(0\), so we enter the first if-statement.</div><div class="clear"></div>
<div class="linenb">478</div><div class="codeline">Unless the user passed a zero as the time to be waited, the function returns \(1\) as the next state.</div><div class="clear"></div>
<div class="linenb">479</div><div class="codeline">When the emulator executes the next step, it checks its internal call stack, which contains the \verb+Sys.wait+ call with state \(1\) as the top element.</div><div class="clear"></div>
<div class="linenb">480</div><div class="codeline">For that reason, instead of executing the next statement, the emulator calls the wait function again, but this time with a state of \(1\).</div><div class="clear"></div>
<div class="linenb">481</div><div class="codeline">This means that the function skips the first if-statement and returns a new state of \(2\) instead.</div><div class="clear"></div>
<div class="linenb">482</div><div class="codeline">This loop then continues until the state is the same size as the first argument multiplied by 1000.</div><div class="clear"></div>
<div class="linenb">483</div><div class="codeline">When this happens, the original first argument is returned inside the special finished state, which means that the function should be removed from the emulator's internal call stack and the next statement can finally be executed.</div><div class="clear"></div>
<div class="linenb">484</div><div class="codeline">The multiplication by 1000 is relatively arbitrary here, since the actual duration depends on the current tick rate, which is a feature of the user interface and therefore unknown to the emulator~\ref{step-by-step}.</div><div class="clear"></div>
<div class="linenb">485</div><div class="codeline">It would be theoretically better to first set the status to the current system time and then decrement it until it reaches zero again.</div><div class="clear"></div>
<div class="linenb">486</div><div class="codeline">But currently this is not possible, because WebAssembly does not provide an API for accessing the system time.</div><div class="clear"></div>
<div class="linenb">487</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">488</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">489</div><div class="codeline">  language=Rust,</div><div class="clear"></div>
<div class="linenb">490</div><div class="codeline">  label={lst:sys.wait},</div><div class="clear"></div>
<div class="linenb">491</div><div class="codeline">  caption={Implementation of the Sys.wait function},</div><div class="clear"></div>
<div class="linenb">492</div><div class="codeline">  captionpos=b</div><div class="clear"></div>
<div class="linenb">493</div><div class="codeline">  ]</div><div class="clear"></div>
<div class="linenb">494</div><div class="codeline">  pub fn wait(_vm: &amp;mut VM, state: State, params: &amp;[Word]) -&gt; StdResult {</div><div class="clear"></div>
<div class="linenb">495</div><div class="codeline">    let duration = params[0] as State * 1000;</div><div class="clear"></div>
<div class="linenb">496</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">497</div><div class="codeline">    if state &lt; duration {</div><div class="clear"></div>
<div class="linenb">498</div><div class="codeline">      return Ok(StdlibOk::ContinueInNextStep(state + 1));</div><div class="clear"></div>
<div class="linenb">499</div><div class="codeline">    }</div><div class="clear"></div>
<div class="linenb">500</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">501</div><div class="codeline">    Ok(StdlibOk::Finished(params[0]))</div><div class="clear"></div>
<div class="linenb">502</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">503</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">504</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">505</div><div class="codeline"><span class="keyword1">\subsubsection</span>{Example:<span class="highlight-sh" title="There should be a space after a period. If you are writing a URL or a filename, use the \url{} or \verb markup. [sh:d:002]"> Output.pr</span>intString} <span class="keyword1">\label</span>{complex-example}</div><div class="clear"></div>
<div class="linenb">506</div><div class="codeline"><span class="comment"><span class="comment">% or Keyboard.readLine (also shows why you can't just execute the entire native function)</span></span></div><div class="clear"></div>
<div class="linenb">507</div><div class="codeline">\cref{lst:output.printstring} shows a more complicated function which uses the system described above.</div><div class="clear"></div>
<div class="linenb">508</div><div class="codeline">This function can be used to output an entire string to the emulator's screen.</div><div class="clear"></div>
<div class="linenb">509</div><div class="codeline">It does not implement all of the functionality itself, instead relying on the string module to iterate over the characters, and the output module's printChar function to print just a single character.</div><div class="clear"></div>
<div class="linenb">510</div><div class="codeline">In theory, this function would be trivial, a simple for loop from zero to the length of the string, with only a single call to the printChar function as the loop body.</div><div class="clear"></div>
<div class="linenb">511</div><div class="codeline">Yet it is not trivial in practice due to the limitations described in~\cref{stdlib-issues}.</div><div class="clear"></div>
<div class="linenb">512</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">513</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">514</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">515</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=10cm]{fig/printString.png}</div><div class="clear"></div>
<div class="linenb">516</div><div class="codeline">    <span class="keyword1">\caption</span>{The Output.printString function as a diagram.}</div><div class="clear"></div>
<div class="linenb">517</div><div class="codeline">    <span class="keyword1">\label</span>{fig:printstring-dfa}</div><div class="clear"></div>
<div class="linenb">518</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">519</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">520</div><div class="codeline">Each time a function is called within a standard native library function, the latter must be stopped, since the former might be a function written in bytecode, and therefore subject to the user interface's stepwise debugger.</div><div class="clear"></div>
<div class="linenb">521</div><div class="codeline">For example, if the native output implementation is used in combination with a string implementation in bytecode, the user might reasonably expect to step through the charAt function called by the printString function in the user interface.</div><div class="clear"></div>
<div class="linenb">522</div><div class="codeline">This is indeed possible with this system.</div><div class="clear"></div>
<div class="linenb">523</div><div class="codeline">Features like this necessitate the complexity of these native implementations, as they cannot be implemented with a normal for loop.</div><div class="clear"></div>
<div class="linenb">524</div><div class="codeline">In the future, it may be possible to implement this in Rust in a more idiomatic way using the planned yield statement, however this is still a proposal at the time of writing.</div><div class="clear"></div>
<div class="linenb">525</div><div class="codeline">Most of the logic is explained in the comments of~\cref{lst:output.printstring}, but the basic idea is simply to use the state argument both as an index for the loop and to store the length of the string.</div><div class="clear"></div>
<div class="linenb">526</div><div class="codeline">This is possible because the state type is a 32-bit integer, whereas the VM emulator uses only 16-bit integers, so the state can contain two different values.</div><div class="clear"></div>
<div class="linenb">527</div><div class="codeline">Depending on whether the state is even or odd, we alternately call the charAt or printChar function until everything has been printed.</div><div class="clear"></div>
<div class="linenb">528</div><div class="codeline">Although the function is actually rather simple, it appears quite complicated in the code, so it is shown again in~\cref{fig:printstring-dfa}, but this time in a graphical representation of the state machine.</div><div class="clear"></div>
<div class="linenb">529</div><div class="codeline">Each state transition in the graphical representation is a suspension point for the function, with the transition to state \(3\) representing the final return in line 28 of the code.</div><div class="clear"></div>
<div class="linenb">530</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">531</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">532</div><div class="codeline">  language=Rust,</div><div class="clear"></div>
<div class="linenb">533</div><div class="codeline">  label={lst:output.printstring},</div><div class="clear"></div>
<div class="linenb">534</div><div class="codeline">  caption={Implementation of the Output.printString function},</div><div class="clear"></div>
<div class="linenb">535</div><div class="codeline">  captionpos=b</div><div class="clear"></div>
<div class="linenb">536</div><div class="codeline">  ]</div><div class="clear"></div>
<div class="linenb">537</div><div class="codeline">  pub fn print_string(vm: &amp;mut VM, state: State, params: &amp;[Word])</div><div class="clear"></div>
<div class="linenb">538</div><div class="codeline">  -&gt; StdResult {</div><div class="clear"></div>
<div class="linenb">539</div><div class="codeline">    // State is 32 bits wide. The upper 16 bits are used to keep</div><div class="clear"></div>
<div class="linenb">540</div><div class="codeline">    // the length information, while</div><div class="clear"></div>
<div class="linenb">541</div><div class="codeline">    // the lower 16 bits are used for the actual state counter</div><div class="clear"></div>
<div class="linenb">542</div><div class="codeline">    let string = params[0];</div><div class="clear"></div>
<div class="linenb">543</div><div class="codeline">    let real_state = state &amp; 0xFFFF;</div><div class="clear"></div>
<div class="linenb">544</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">545</div><div class="codeline">    // in the first tick: get the length of the string to be printed</div><div class="clear"></div>
<div class="linenb">546</div><div class="codeline">    if state == 0 {</div><div class="clear"></div>
<div class="linenb">547</div><div class="codeline">      return call_vm!(vm, state, "String.length", &amp;[string]);</div><div class="clear"></div>
<div class="linenb">548</div><div class="codeline">    }</div><div class="clear"></div>
<div class="linenb">549</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">550</div><div class="codeline">    // the second call of this function is a special case, because the</div><div class="clear"></div>
<div class="linenb">551</div><div class="codeline">    // string length is on the stack instead of in the state</div><div class="clear"></div>
<div class="linenb">552</div><div class="codeline">    let (len, last) = if state == 1 {</div><div class="clear"></div>
<div class="linenb">553</div><div class="codeline">      (vm.pop()? as State, 0)</div><div class="clear"></div>
<div class="linenb">554</div><div class="codeline">    } else {</div><div class="clear"></div>
<div class="linenb">555</div><div class="codeline">      ((state &gt;&gt; 16) &amp; 0xFFFF, vm.pop()?)</div><div class="clear"></div>
<div class="linenb">556</div><div class="codeline">    };</div><div class="clear"></div>
<div class="linenb">557</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">558</div><div class="codeline">    // we need 2 ticks for each i, so divide by 2</div><div class="clear"></div>
<div class="linenb">559</div><div class="codeline">    // also subtract 1 because this will not be executed for state 0</div><div class="clear"></div>
<div class="linenb">560</div><div class="codeline">    let i = (real_state as Word - 1) / 2;</div><div class="clear"></div>
<div class="linenb">561</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">562</div><div class="codeline">    // the exit condition</div><div class="clear"></div>
<div class="linenb">563</div><div class="codeline">    if i &gt;= len {</div><div class="clear"></div>
<div class="linenb">564</div><div class="codeline">      return Ok(Finished(0));</div><div class="clear"></div>
<div class="linenb">565</div><div class="codeline">    }</div><div class="clear"></div>
<div class="linenb">566</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">567</div><div class="codeline">    // keep alternating between these 2 while i &lt; len</div><div class="clear"></div>
<div class="linenb">568</div><div class="codeline">    if state &amp; 1 == 1 {</div><div class="clear"></div>
<div class="linenb">569</div><div class="codeline">      // on odd states call charAt</div><div class="clear"></div>
<div class="linenb">570</div><div class="codeline">      vm.call("String.charAt", &amp;[string, i])?;</div><div class="clear"></div>
<div class="linenb">571</div><div class="codeline">      Ok(ContinueInNextStep((len &lt;&lt; 16) | (state + 1)))</div><div class="clear"></div>
<div class="linenb">572</div><div class="codeline">    } else {</div><div class="clear"></div>
<div class="linenb">573</div><div class="codeline">      // on even states we actually print</div><div class="clear"></div>
<div class="linenb">574</div><div class="codeline">      vm.call("Output.printChar", &amp;[last])?;</div><div class="clear"></div>
<div class="linenb">575</div><div class="codeline">      Ok(ContinueInNextStep((len &lt;&lt; 16) | (state + 1)))</div><div class="clear"></div>
<div class="linenb">576</div><div class="codeline">    }</div><div class="clear"></div>
<div class="linenb">577</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">578</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">579</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">580</div><div class="codeline"><span class="keyword1">\subsection</span>{Using conditional compilation in Rust} <span class="keyword1">\label</span>{conditional-compilation}</div><div class="clear"></div>
<div class="linenb">581</div><div class="codeline">Like C, Rust has the ability to use macros to rewrite code at the AST level during compilation~\ref{macros-and-error-handling}.</div><div class="clear"></div>
<div class="linenb">582</div><div class="codeline">This includes the ability to compile certain parts of the code only under certain conditions.</div><div class="clear"></div>
<div class="linenb">583</div><div class="codeline">Not only does this feature allow features to be used only in certain builds of the application, but it also allows the programmer to specify conditional dependencies that will only be downloaded and compiled if the specific feature is enabled during compilation.</div><div class="clear"></div>
<div class="linenb">584</div><div class="codeline">A perfect example of the usefulness of this ability is the desktop feature in the new emulator.</div><div class="clear"></div>
<div class="linenb">585</div><div class="codeline">When compiled with this feature enabled, the VM emulator can run in a native window that uses SDL2 for rendering and user interaction.</div><div class="clear"></div>
<div class="linenb">586</div><div class="codeline">But there is no need to include SDL2 in a build that runs in the browser.</div><div class="clear"></div>
<div class="linenb">587</div><div class="codeline">So by using macros, we can compile the SDL2-related code and the library itself only when it is actually needed.</div><div class="clear"></div>
<div class="linenb">588</div><div class="codeline">Another use case for conditional compilation is logging.</div><div class="clear"></div>
<div class="linenb">589</div><div class="codeline">Logging has a significant performance overhead if done for every command that runs in the emulator, while being rarely needed.</div><div class="clear"></div>
<div class="linenb">590</div><div class="codeline">It is therefore logical to hide it behind a compilation feature that can be activated when needed and has no other drawbacks.</div><div class="clear"></div>
<div class="linenb">591</div><div class="codeline">Features are declared in the \verb+Cargo.toml+ file, which contains all project-related configuration such as the binaries built by the project, dependencies, or optimization flags.</div><div class="clear"></div>
<div class="linenb">592</div><div class="codeline">In the code, these features can be checked with a single line of code above the block of code to be conditionally compiled~\ref{lst:conditional-compilation}.</div><div class="clear"></div>
<div class="linenb">593</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">594</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">595</div><div class="codeline">  language=Rust,</div><div class="clear"></div>
<div class="linenb">596</div><div class="codeline">  label={lst:conditional-compilation},</div><div class="clear"></div>
<div class="linenb">597</div><div class="codeline">  caption={A function which is only compiled in desktop mode},</div><div class="clear"></div>
<div class="linenb">598</div><div class="codeline">  captionpos=b</div><div class="clear"></div>
<div class="linenb">599</div><div class="codeline">  ]</div><div class="clear"></div>
<div class="linenb">600</div><div class="codeline">  #[cfg(feature = "desktop")]</div><div class="clear"></div>
<div class="linenb">601</div><div class="codeline">  fn run(vm: &amp;mut VM, steps_per_tick: usize) {</div><div class="clear"></div>
<div class="linenb">602</div><div class="codeline">    [...]</div><div class="clear"></div>
<div class="linenb">603</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">604</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">605</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">606</div><div class="codeline"><span class="keyword1">\subsection</span>{Integrating the emulator into the Web UI}</div><div class="clear"></div>
<div class="linenb">607</div><div class="codeline">So far, all sections have dealt with the internals of the emulator.</div><div class="clear"></div>
<div class="linenb">608</div><div class="codeline">The primary goal of the project, however, is to provide the user with a web-based interface.</div><div class="clear"></div>
<div class="linenb">609</div><div class="codeline">Integrating the emulator into a web page is done by first compiling the Rust code into a Wasm library, which is then used by a ReactJS application~\ref{react-js}.</div><div class="clear"></div>
<div class="linenb">610</div><div class="codeline">The exact boundary between JavaScript and Rust is arbitrary and has actually changed during the development of the application.</div><div class="clear"></div>
<div class="linenb">611</div><div class="codeline">In the finished version, the JavaScript code requests the current frame of the screen from the Rust code, which then renders the pixel data into a JavaScript ImageData buffer, a type provided by the web-sys crate~\ref{web-sys}, and returns it.</div><div class="clear"></div>
<div class="linenb">612</div><div class="codeline">The JavaScript code then simply displays the data inside a normal canvas element.</div><div class="clear"></div>
<div class="linenb">613</div><div class="codeline">In fact, the Rust code doesn't do anything by itself, it just provides functions that can be used by the ReactJS application.</div><div class="clear"></div>
<div class="linenb">614</div><div class="codeline">Another example of this principle is the handling of keyboard events, which are received by JavaScript, then passed to Rust and processed accordingly inside the emulator.</div><div class="clear"></div>
<div class="linenb">615</div><div class="codeline">So the main loops, both for running the VM and for displaying the current frame, are written in JavaScript.</div><div class="clear"></div>
<div class="linenb">616</div><div class="codeline">To improve performance, however, the step calls to the VM are batched.</div><div class="clear"></div>
<div class="linenb">617</div><div class="codeline">When the emulator runs in a loop, a single iteration of the loop in the interface actually corresponds to thousands of ticks for the emulator, depending on the position of the speed slider~\ref{ui-showcase}.</div><div class="clear"></div>
<div class="linenb">618</div><div class="codeline">This does not happen during debugging, of course, where a single step in the user interface usually corresponds to a single tick in the emulator.</div><div class="clear"></div>
<div class="linenb">619</div><div class="codeline">The only exception to this rule is that the front-end automatically keeps ticking as long as the emulator is executing a built-in standard library function.</div><div class="clear"></div>
<div class="linenb">620</div><div class="codeline">The reason for this becomes immediately clear when one looks at~\cref{sys.wait-example}.</div><div class="clear"></div>
<div class="linenb">621</div><div class="codeline">It is not desirable to click the step button a thousand times for every second you want the emulator to wait.</div><div class="clear"></div>
<div class="linenb">622</div><div class="codeline">By giving the front-end control over all execution, state implementation becomes much simpler, as all user interface elements can be easily updated after an event causes a change in emulator state.</div><div class="clear"></div>
<div class="linenb">623</div><div class="codeline">If this were not the case, the emulator would have to notify the front-end of state changes, or the UI would have to actively ask the emulator for its current state as often as possible.</div><div class="clear"></div>
<div class="linenb">624</div><div class="codeline">The interaction between the JavaScript front-end and the emulator code is facilitated by a thin compatibility layer in Rust.</div><div class="clear"></div>
<div class="linenb">625</div><div class="codeline">This layer provides a unified interface to the front-end that works for both the VM and the CPU emulators.</div><div class="clear"></div>
<div class="linenb">626</div><div class="codeline">As a result, there is no need to implement two different user interfaces, and all JavaScript code is shared between the two emulators.</div><div class="clear"></div>
<div class="linenb">627</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">628</div><div class="codeline"><span class="keyword1">\subsection</span>{Web UI showcase} <span class="keyword1">\label</span>{ui-showcase}</div><div class="clear"></div>
<div class="linenb">629</div><div class="codeline">The web-based user interface is shown in~\cref{fig:ui-demo-desktop}.</div><div class="clear"></div>
<div class="linenb">630</div><div class="codeline">It is divided into four major parts.</div><div class="clear"></div>
<div class="linenb">631</div><div class="codeline">Above everything else, there is a row with all interactive UI elements.</div><div class="clear"></div>
<div class="linenb">632</div><div class="codeline">This row contains the buttons for loading a new program, starting, stopping, advancing a single step or resetting the running program and the slider for changing the VM execution speed.</div><div class="clear"></div>
<div class="linenb">633</div><div class="codeline">In the middle left part of the image the bytecode of the currently loaded program is displayed.</div><div class="clear"></div>
<div class="linenb">634</div><div class="codeline">This information is useful when the user is using the ``Step'' button to debug the loaded program.</div><div class="clear"></div>
<div class="linenb">635</div><div class="codeline">The instruction to be executed next is highlighted in red.</div><div class="clear"></div>
<div class="linenb">636</div><div class="codeline">To the right of that is the most important part of the user interface, the emulator screen.</div><div class="clear"></div>
<div class="linenb">637</div><div class="codeline">Here the screen section of the emulator memory is displayed.</div><div class="clear"></div>
<div class="linenb">638</div><div class="codeline">Below those two, certain parts of the internal memory are shown to improve the debugging experience.</div><div class="clear"></div>
<div class="linenb">639</div><div class="codeline">From left to right, those are the call stack, local variables, arguments to the current function and the stack.</div><div class="clear"></div>
<div class="linenb">640</div><div class="codeline">These fields are updated each time the emulator comes to a stop, i.e.\ after each step or after pressing the stop key.</div><div class="clear"></div>
<div class="linenb">641</div><div class="codeline">Since the emulator executes thousands of ticks per second, updating the values after each tick would be neither feasible nor useful, so they are only updated after stopping~\ref{ui-compatibility}.</div><div class="clear"></div>
<div class="linenb">642</div><div class="codeline">If they are not updated while running, there is no point in displaying them at all, so the bytecode view and the memory segments are hidden while the program is running.</div><div class="clear"></div>
<div class="linenb">643</div><div class="codeline">This allows the screen to fill almost the entire browser window and its contents to become as large as possible.</div><div class="clear"></div>
<div class="linenb">644</div><div class="codeline">In contrast, the button row at the top and the screen are always visible.</div><div class="clear"></div>
<div class="linenb">645</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">646</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">647</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">648</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=12cm]{fig/ui-demo-desktop.png}</div><div class="clear"></div>
<div class="linenb">649</div><div class="codeline">    <span class="keyword1">\caption</span>{The web-based user interface on a desktop computer.}<span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">650</div><div class="codeline">    <span class="keyword1">\label</span>{fig:ui-demo-desktop}</div><div class="clear"></div>
<div class="linenb">651</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">652</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
</div>
<h2 class="filename">tex/conclusions.tex</h2>

<p>Found 0 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;1</div><div class="codeline"><span class="keyword1">\section</span>{Conclusions and future work}</div><div class="clear"></div>
<div class="linenb">&nbsp;2</div><div class="codeline">Overall, this project was a success.</div><div class="clear"></div>
<div class="linenb">&nbsp;3</div><div class="codeline">The original goal of providing an alternative VM emulator implementation in the browser that is faster and better suited for modern displays was achieved.</div><div class="clear"></div>
<div class="linenb">&nbsp;4</div><div class="codeline">On top of that, the CPU emulator has also been rewritten and integrated into the same user interface, and the test script workflow has also been ported to Rust.</div><div class="clear"></div>
<div class="linenb">&nbsp;5</div><div class="codeline">But not every change is an improvement over the original emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;6</div><div class="codeline">The new tools have fewer debugging features than the old ones~\ref{ui-compatibility} and there are still some opportunities for future improvements, as described further down.</div><div class="clear"></div>
<div class="linenb">&nbsp;7</div><div class="codeline">The technologies chosen worked well, by and large, to rewrite a complex desktop application for the modern web, and the potential of Wasm as a compilation target for such applications was demonstrated.</div><div class="clear"></div>
<div class="linenb">&nbsp;8</div><div class="codeline">It can be expected that the already existing trend of developing more and more applications for the web browser will accelerate further, as developers are now no longer limited to JavaScript or languages that can be compiled for it.</div><div class="clear"></div>
<div class="linenb">&nbsp;9</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">10</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{Summary}</span></span></div><div class="clear"></div>
<div class="linenb">11</div><div class="codeline"><span class="comment"><span class="comment">% summary with emphasis on results/comparisons</span></span></div><div class="clear"></div>
<div class="linenb">12</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{Future work}</span></span></div><div class="clear"></div>
<div class="linenb">13</div><div class="codeline"><span class="keyword1">\label</span>{future-work}</div><div class="clear"></div>
<div class="linenb">14</div><div class="codeline">While the project resulted in a working application that fullfills the original goals, there are still multiple things that could be improved in the future.</div><div class="clear"></div>
<div class="linenb">15</div><div class="codeline">First and foremost is the inclusion of the last of the three simulators, the hardware simulator.</div><div class="clear"></div>
<div class="linenb">16</div><div class="codeline">Since this simulator is not affected by performance issues, as only simple tests of the created logic gates are performed, it would benefit least from a rewrite in Rust.</div><div class="clear"></div>
<div class="linenb">17</div><div class="codeline">Having all of the simulators for the course inside of one single application would, however, be a great benefit for the students participating in the course as they would not have to install anything locally anymore.</div><div class="clear"></div>
<div class="linenb">18</div><div class="codeline">This would require not just a new emulator to be written, but also a completely new user interface, while the VM and CPU can share a single interface due to their many similarities.</div><div class="clear"></div>
<div class="linenb">19</div><div class="codeline">Another point that would greatly benefit the students would be the inclusion of further debugging tools, like breakpoints, more memory views~\ref{ui-showcase} and the inclusion of the test script runner into the web based user interface.</div><div class="clear"></div>
<div class="linenb">20</div><div class="codeline">The last point is especially important, as those test scripts show the students that they correctly solved the problem before submitting their solutions.</div><div class="clear"></div>
<div class="linenb">21</div><div class="codeline">Some minor improvements which could be made, are improved error messages and a compatibility mode for the keyboard handler.</div><div class="clear"></div>
<div class="linenb">22</div><div class="codeline">The former should be relatively simple to implement, as the parsers already include the original source code location of each token in their output~\ref{spans}.</div><div class="clear"></div>
<div class="linenb">23</div><div class="codeline">The latter point refers to something already discussed in~\cref{compatibility}.</div><div class="clear"></div>
<div class="linenb">24</div><div class="codeline">Instead of just emulating the behaviour of the official emulator perfectly, it might be useful to make the behaviour of the keyboard handler configurable for users.</div><div class="clear"></div>
<div class="linenb">25</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">26</div><div class="codeline"><span class="comment"><span class="comment">% hardware simulator</span></span></div><div class="clear"></div>
<div class="linenb">27</div><div class="codeline"><span class="comment"><span class="comment">% more debugging tools</span></span></div><div class="clear"></div>
<div class="linenb">28</div><div class="codeline"><span class="comment"><span class="comment">% tst scripts in web ui</span></span></div><div class="clear"></div>
<div class="linenb">29</div><div class="codeline"><span class="comment"><span class="comment">% proper error messages (spans already included)</span></span></div><div class="clear"></div>
<div class="linenb">30</div><div class="codeline"><span class="comment"><span class="comment">% compatibility mode for keyboard uppercase</span></span></div><div class="clear"></div>
</div>
<h2 class="filename">tex/hack.tex</h2>

<p>Found 0 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;&nbsp;1</div><div class="codeline"><span class="keyword1">\section</span>{Nand to Tetris and the Hack Architecture} <span class="keyword1">\label</span>{hack-architecture}</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;2</div><div class="codeline">Nand to Tetris is divided into several sections that can be worked on or skipped more or less independently of each other.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;3</div><div class="codeline">Each section is further removed from the actual hardware than its predecessor.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;4</div><div class="codeline">They each describe a further abstraction in the Hack architecture, the computer system specifically designed for this course, which the students implement themselves.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;5</div><div class="codeline">In the beginning, the students create the necessary chips and logic gates, starting with only a nand gate.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;6</div><div class="codeline">This section is not part of this thesis, but it may become relevant in future additions to the application~\ref{future-work}.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;7</div><div class="codeline">After that, students will work with assembly language~\ref{hack-assembly} and create their own assembler with generated code targeting the CPU from the previous section.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;8</div><div class="codeline">The application created as part of this work contains an emulator that can run that assembly directly without further compilation.</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;9</div><div class="codeline">This allows students to run their assembly code in the same application as their VM code from the later sections.</div><div class="clear"></div>
<div class="linenb">&nbsp;10</div><div class="codeline">In the next section, students work closely with VM bytecode, first writing a translator from bytecode to assembly, and later writing a complete game using the high-level programming language Jack, which was designed for this course.</div><div class="clear"></div>
<div class="linenb">&nbsp;11</div><div class="codeline">At the end, students will create their own compiler for said high-level language.</div><div class="clear"></div>
<div class="linenb">&nbsp;12</div><div class="codeline">They will also implement a standard library for it that abstracts many of the direct interactions with the platform, such as printing text to the screen.</div><div class="clear"></div>
<div class="linenb">&nbsp;13</div><div class="codeline">The last two parts are relevant to this project because students can run both the VM code and their compiled assembly in the emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;14</div><div class="codeline">The main focus of this project is on the game mentioned above, which is created in Project 9.</div><div class="clear"></div>
<div class="linenb">&nbsp;15</div><div class="codeline">It may seem strange to develop a whole new emulator mainly to improve a single project out of twelve, but this one exercise is the ``Tetris'' referred to in the title of the course.</div><div class="clear"></div>
<div class="linenb">&nbsp;16</div><div class="codeline">Although Project 9 is not the final project, for many it is the highlight of the course.</div><div class="clear"></div>
<div class="linenb">&nbsp;17</div><div class="codeline">This is illustrated by the fact that nine of the twelve examples listed under the ``Cool Stuff''~\cite{n2tweb} tab on the official website are Jack programs that would qualify as Project 9 solutions.</div><div class="clear"></div>
<div class="linenb">&nbsp;18</div><div class="codeline">So if the goal is to improve the overall student experience, it makes sense to focus on this part.</div><div class="clear"></div>
<div class="linenb">&nbsp;19</div><div class="codeline">Nevertheless, the emulators created as part of this thesis can also improve the experience for other projects~\ref{evaluation}.</div><div class="clear"></div>
<div class="linenb">&nbsp;20</div><div class="codeline">It is important to keep in mind, that both the VM bytecode and the assembly are meant as intermediate steps for the compilation of Jack code into machine language, even though this project is about interpreting them directly.</div><div class="clear"></div>
<div class="linenb">&nbsp;21</div><div class="codeline">The entire pipeline with many of the relevant terms that will be used throughout the thesis is shown in~\cref{fig:hack-pipeline}.</div><div class="clear"></div>
<div class="linenb">&nbsp;22</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;23</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;24</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">&nbsp;25</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">&nbsp;26</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=14cm]{fig/hack-pipeline.png}</div><div class="clear"></div>
<div class="linenb">&nbsp;27</div><div class="codeline">    <span class="keyword1">\caption</span>{The transformation from Jack code to machine code.}</div><div class="clear"></div>
<div class="linenb">&nbsp;28</div><div class="codeline">    <span class="keyword1">\label</span>{fig:hack-pipeline}</div><div class="clear"></div>
<div class="linenb">&nbsp;29</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;30</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;31</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;32</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{The sections of Nand to Tetris}</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;33</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;34</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Chips und Logic Gates (nicht Teil der Arbeit)</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;35</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> CPU und Assembly</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;36</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Virtuelle Machine</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;37</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> High level Sprache und Betriebssystem (nicht Teil der Arbeit)</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;38</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;39</div><div class="codeline"><span class="comment"><span class="comment">%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;40</div><div class="codeline"><span class="keyword1">\subsection</span>{Hack assembly} <span class="keyword1">\label</span>{hack-assembly}</div><div class="clear"></div>
<div class="linenb">&nbsp;41</div><div class="codeline">There are three different languages in the Nand to Tetris course, which are important for this work.</div><div class="clear"></div>
<div class="linenb">&nbsp;42</div><div class="codeline">The first and least complex of the three is the assembly language.</div><div class="clear"></div>
<div class="linenb">&nbsp;43</div><div class="codeline">Assembly in this case simply means that the language has a direct mapping to the machine language which the CPU can actually understand.</div><div class="clear"></div>
<div class="linenb">&nbsp;44</div><div class="codeline">Each assembly instruction can be mapped to a single number which can be understood by the hardware of the machine.</div><div class="clear"></div>
<div class="linenb">&nbsp;45</div><div class="codeline">Assembly in modern systems is often complicated with a plethora of different instructions, but Hack assembly only has two different instructions.</div><div class="clear"></div>
<div class="linenb">&nbsp;46</div><div class="codeline">These two instructions are used to manipulate two physical registers called A and D.</div><div class="clear"></div>
<div class="linenb">&nbsp;47</div><div class="codeline">In addition, there is a third register, called M, which is actually just the memory cell pointed to by the address in the A register.</div><div class="clear"></div>
<div class="linenb">&nbsp;48</div><div class="codeline">This allows the assembly to work without any dedicated instructions for memory manipulation.</div><div class="clear"></div>
<div class="linenb">&nbsp;49</div><div class="codeline">The first instruction is called A-Instruction because the only thing it does, is putting a constant value into the A register.</div><div class="clear"></div>
<div class="linenb">&nbsp;50</div><div class="codeline">In the assembly code it is written as ``@value'', so for example ``@42'' would write the value 42 into the A-register.</div><div class="clear"></div>
<div class="linenb">&nbsp;51</div><div class="codeline">The C-Instruction, on the other hand, can perform a multitude of different functions.</div><div class="clear"></div>
<div class="linenb">&nbsp;52</div><div class="codeline">These range from negating the value of a single register to performing a binary-or operation on two registers and jumping to another instruction when that value is greater than zero.</div><div class="clear"></div>
<div class="linenb">&nbsp;53</div><div class="codeline">The target of that jump would be determined by the value inside the A register.</div><div class="clear"></div>
<div class="linenb">&nbsp;54</div><div class="codeline">C-Instructions consist of one or multiple target registers, an equals sign, an expression, such as D-A and optionally a jump.</div><div class="clear"></div>
<div class="linenb">&nbsp;55</div><div class="codeline">Understanding the functionality of Hack assembly on a deeper level than this is not required to understand the following sections.</div><div class="clear"></div>
<div class="linenb">&nbsp;56</div><div class="codeline">\cref{lst:hack-assembly} shows a simple assembly program, which checks if the value in memory at address 3 is equal to 5 and if it is, jumps to address instruction 100.</div><div class="clear"></div>
<div class="linenb">&nbsp;57</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;58</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">&nbsp;59</div><div class="codeline">  language=HackAsm,</div><div class="clear"></div>
<div class="linenb">&nbsp;60</div><div class="codeline">  caption={A simple Hack assembly program},</div><div class="clear"></div>
<div class="linenb">&nbsp;61</div><div class="codeline">  label={lst:hack-assembly},</div><div class="clear"></div>
<div class="linenb">&nbsp;62</div><div class="codeline">  captionpos=b]</div><div class="clear"></div>
<div class="linenb">&nbsp;63</div><div class="codeline">@3</div><div class="clear"></div>
<div class="linenb">&nbsp;64</div><div class="codeline">D=M   // D == RAM[3]</div><div class="clear"></div>
<div class="linenb">&nbsp;65</div><div class="codeline">@5</div><div class="clear"></div>
<div class="linenb">&nbsp;66</div><div class="codeline">D=D-A // D := D - 5</div><div class="clear"></div>
<div class="linenb">&nbsp;67</div><div class="codeline">@100</div><div class="clear"></div>
<div class="linenb">&nbsp;68</div><div class="codeline">D;JEQ // if (D == 0) goto 100</div><div class="clear"></div>
<div class="linenb">&nbsp;69</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;70</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;71</div><div class="codeline"><span class="keyword1">\subsection</span>{Hack bytecode}</div><div class="clear"></div>
<div class="linenb">&nbsp;72</div><div class="codeline"><span class="keyword1">\label</span>{hack-bytecode}</div><div class="clear"></div>
<div class="linenb">&nbsp;73</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{The operating principles of the Hack VM}</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;74</div><div class="codeline">Hack bytecode is the most important language for this thesis, as it is the language interpreted by the VM emulator.</div><div class="clear"></div>
<div class="linenb">&nbsp;75</div><div class="codeline">Since it has way more instructions than the assembly, it makes sense to start with an example instead of explaining each instruction in detail.</div><div class="clear"></div>
<div class="linenb">&nbsp;76</div><div class="codeline">The simple C program in~\cref{lst:c-add-123} shows how one might write a loop that adds the numbers 1, 2, and 3 together.</div><div class="clear"></div>
<div class="linenb">&nbsp;77</div><div class="codeline">In mathematical notation, it would be written as \(\sum_{i=1}^{3}i\).</div><div class="clear"></div>
<div class="linenb">&nbsp;78</div><div class="codeline">This program may seem unremarkable at first glance, but it incorporates quite a few important concepts of modern programming languages, such as variables, loops, conditions, and arithmetic operations.</div><div class="clear"></div>
<div class="linenb">&nbsp;79</div><div class="codeline">Although the program itself is trivial, its translation into machine code and subsequent execution by the computer is not.</div><div class="clear"></div>
<div class="linenb">&nbsp;80</div><div class="codeline">Since machine code is highly dependent on the target architecture, the following section is specific to the Hack platform. That being said, the concepts discussed are important not only for most other VM implementations, but also for machine code generated by a C or Rust compiler.</div><div class="clear"></div>
<div class="linenb">&nbsp;81</div><div class="codeline">This is especially true for the stack, which is an important concept in almost every existing programming language.</div><div class="clear"></div>
<div class="linenb">&nbsp;82</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;83</div><div class="codeline">C is an imperative language, which means that we have to tell the computer how to calculate the result instead of just telling it what we want.</div><div class="clear"></div>
<div class="linenb">&nbsp;84</div><div class="codeline">The program begins with the declaration of two variables called \(i\) and \(sum\).</div><div class="clear"></div>
<div class="linenb">&nbsp;85</div><div class="codeline">The first is used to hold the number of iterations performed, while the second holds the final result, which is the sum of all \(i\) we iterated over.</div><div class="clear"></div>
<div class="linenb">&nbsp;86</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;87</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">&nbsp;88</div><div class="codeline">  language=C,</div><div class="clear"></div>
<div class="linenb">&nbsp;89</div><div class="codeline">  caption={A C program to calculate \(\sum_{i=1}^{3}i\).},</div><div class="clear"></div>
<div class="linenb">&nbsp;90</div><div class="codeline">  label={lst:c-add-123},</div><div class="clear"></div>
<div class="linenb">&nbsp;91</div><div class="codeline">  captionpos=b]</div><div class="clear"></div>
<div class="linenb">&nbsp;92</div><div class="codeline">  int i = 1;</div><div class="clear"></div>
<div class="linenb">&nbsp;93</div><div class="codeline">  int sum = 0;</div><div class="clear"></div>
<div class="linenb">&nbsp;94</div><div class="codeline">  while (i &lt;= 3) {</div><div class="clear"></div>
<div class="linenb">&nbsp;95</div><div class="codeline">    sum += i;</div><div class="clear"></div>
<div class="linenb">&nbsp;96</div><div class="codeline">    i++;</div><div class="clear"></div>
<div class="linenb">&nbsp;97</div><div class="codeline">  }</div><div class="clear"></div>
<div class="linenb">&nbsp;98</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;99</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">100</div><div class="codeline">To translate the program above into something that can be interpreted by the Hack VM, one must first understand the stack.</div><div class="clear"></div>
<div class="linenb">101</div><div class="codeline">A stack is an abstract data structure with only two fundamental operations: Push and Pop.</div><div class="clear"></div>
<div class="linenb">102</div><div class="codeline">The push operation adds an element to the top of the stack, while the pop operation removes the top element.</div><div class="clear"></div>
<div class="linenb">103</div><div class="codeline">This means that the element that was pushed onto the stack last is removed first when a pop is performed.</div><div class="clear"></div>
<div class="linenb">104</div><div class="codeline">For this reason, the stack model is called last-in-first-out (LIFO)~\cite{nisan2005}.</div><div class="clear"></div>
<div class="linenb">105</div><div class="codeline">This model is simple but powerful and allows a very elegant description of calculations.</div><div class="clear"></div>
<div class="linenb">106</div><div class="codeline">For example, to perform an addition, first both operands are pushed onto the stack, then the addition instruction pops these two numbers from the stack and pushes the result of the addition onto it instead.</div><div class="clear"></div>
<div class="linenb">107</div><div class="codeline">This is illustrated in~\cref{fig:stack-add}, where 2 is pushed on top of 1 before adding both.</div><div class="clear"></div>
<div class="linenb">108</div><div class="codeline">The stack is often represented as growing downward, but in the Hack architecture it actually grows upward, so this representation is more appropriate.</div><div class="clear"></div>
<div class="linenb">109</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">110</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">111</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">112</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">113</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=14cm]{fig/stack-add.png}</div><div class="clear"></div>
<div class="linenb">114</div><div class="codeline">    <span class="keyword1">\caption</span>{Adding 1 and 2 in a stack based VM.}</div><div class="clear"></div>
<div class="linenb">115</div><div class="codeline">    <span class="keyword1">\label</span>{fig:stack-add}</div><div class="clear"></div>
<div class="linenb">116</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">117</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">118</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">119</div><div class="codeline">Unlike many other architectures, push and pop in the Hack architecture can also be used to read and write arbitrary memory addresses, so no other memory-related instructions are required. For this reason, they are the only instructions in Hack that can manipulate memory outside the stack.</div><div class="clear"></div>
<div class="linenb">120</div><div class="codeline">This is made possible by extending both instructions with a segment and an index. The segment acts as an offset that the VM adds to the index that follows it.</div><div class="clear"></div>
<div class="linenb">121</div><div class="codeline">The address for the instruction is therefore computed as \(address=offset(segment)+index\).</div><div class="clear"></div>
<div class="linenb">122</div><div class="codeline">It is used either as the destination where the result of a pop operation is written, or as the source location of a value to be pushed.</div><div class="clear"></div>
<div class="linenb">123</div><div class="codeline">\cref{table:segments} in the appendix shows all of the possible segments and their purpose.</div><div class="clear"></div>
<div class="linenb">124</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">125</div><div class="codeline">Only two of the eight possible segments are used in~\cref{lst:hack-bytecode}.</div><div class="clear"></div>
<div class="linenb">126</div><div class="codeline">The local offset reads its offset from the first memory cell: \(address=RAM[1]+index\). So a ``pop local 3'' would remove the top most element of the stack and write it to \(RAM[1]+3\).</div><div class="clear"></div>
<div class="linenb">127</div><div class="codeline">In contrast, the constant segment differs from all other segments in that it does not add anything to the index before treating the result as an address, but simply pushes the index directly onto the stack without performing a memory read.</div><div class="clear"></div>
<div class="linenb">128</div><div class="codeline">This means that the constant segment cannot be used with the pop instruction.</div><div class="clear"></div>
<div class="linenb">129</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">130</div><div class="codeline">With this knowledge the bytecode~\ref{lst:hack-bytecode} becomes readable.</div><div class="clear"></div>
<div class="linenb">131</div><div class="codeline">It starts by initializing \(i\) and \(sum\) to one and zero respectively, just like the C code~\ref{lst:c-add-123}.</div><div class="clear"></div>
<div class="linenb">132</div><div class="codeline">Afterwards, a label is declared, which is simply a position in the bytecode that can be used as a target for goto instructions.</div><div class="clear"></div>
<div class="linenb">133</div><div class="codeline">The loop is implemented between this label and the label on the last line and can be divided into three parts.</div><div class="clear"></div>
<div class="linenb">134</div><div class="codeline">The first part performs the exit condition check to determine if the loop body should be executed.</div><div class="clear"></div>
<div class="linenb">135</div><div class="codeline">To do this, it first puts the value of \(i\) on the stack and then jumps out of the loop if \(\neg(i &lt; 4)\), which is equivalent to \(i &gt; 3\).</div><div class="clear"></div>
<div class="linenb">136</div><div class="codeline">If the aforementioned check was false, the loop body is executed.</div><div class="clear"></div>
<div class="linenb">137</div><div class="codeline">This means that the actual implementation of a loop condition works the other way around than in the C example, where we enter the loop if the condition was true.</div><div class="clear"></div>
<div class="linenb">138</div><div class="codeline">This inversion is done because the code does not perform a jump when the loop is executed.</div><div class="clear"></div>
<div class="linenb">139</div><div class="codeline">Since most loops are run more than once, this saves a lot of jumps in the program flow, which are often quite expensive.</div><div class="clear"></div>
<div class="linenb">140</div><div class="codeline">To update \(sum\), the VM loads the current value of \(sum\) onto the stack, then the current value of \(i\), and after adding the two, the result is written back to \(sum\).</div><div class="clear"></div>
<div class="linenb">141</div><div class="codeline">Updating \(i\) works basically the same way, but with a constant value of one instead of another local variable being added.</div><div class="clear"></div>
<div class="linenb">142</div><div class="codeline">Then we simply jump back to the beginning of the loop, where the next check for the exit condition is performed, and continue this process until that condition is met.</div><div class="clear"></div>
<div class="linenb">143</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">144</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">145</div><div class="codeline">  language=Hack,</div><div class="clear"></div>
<div class="linenb">146</div><div class="codeline">  caption={A Hack VM program to calculate \(\sum_{i=1}^{3}i\).},</div><div class="clear"></div>
<div class="linenb">147</div><div class="codeline">  label={lst:hack-bytecode},</div><div class="clear"></div>
<div class="linenb">148</div><div class="codeline">  captionpos=b]</div><div class="clear"></div>
<div class="linenb">149</div><div class="codeline">  // i = 1</div><div class="clear"></div>
<div class="linenb">150</div><div class="codeline">  push constant 1</div><div class="clear"></div>
<div class="linenb">151</div><div class="codeline">  pop local 0</div><div class="clear"></div>
<div class="linenb">152</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">153</div><div class="codeline">  // sum = 0</div><div class="clear"></div>
<div class="linenb">154</div><div class="codeline">  push constant 0</div><div class="clear"></div>
<div class="linenb">155</div><div class="codeline">  pop local 1</div><div class="clear"></div>
<div class="linenb">156</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">157</div><div class="codeline">  label LOOP_START</div><div class="clear"></div>
<div class="linenb">158</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">159</div><div class="codeline">  // the Hack bytecode does not have an &lt;= instruction,</div><div class="clear"></div>
<div class="linenb">160</div><div class="codeline">  // therefore use i &lt; 4 instead of i &lt;= 3</div><div class="clear"></div>
<div class="linenb">161</div><div class="codeline">  // if i &gt;= 4 jump out of the loop</div><div class="clear"></div>
<div class="linenb">162</div><div class="codeline">  push local 0</div><div class="clear"></div>
<div class="linenb">163</div><div class="codeline">  push constant 4</div><div class="clear"></div>
<div class="linenb">164</div><div class="codeline">  lt</div><div class="clear"></div>
<div class="linenb">165</div><div class="codeline">  not</div><div class="clear"></div>
<div class="linenb">166</div><div class="codeline">  if-goto LOOP_END</div><div class="clear"></div>
<div class="linenb">167</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">168</div><div class="codeline">  // sum = sum + i</div><div class="clear"></div>
<div class="linenb">169</div><div class="codeline">  push local 1</div><div class="clear"></div>
<div class="linenb">170</div><div class="codeline">  push local 0</div><div class="clear"></div>
<div class="linenb">171</div><div class="codeline">  add</div><div class="clear"></div>
<div class="linenb">172</div><div class="codeline">  pop local 1</div><div class="clear"></div>
<div class="linenb">173</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">174</div><div class="codeline">  // i = i + 1</div><div class="clear"></div>
<div class="linenb">175</div><div class="codeline">  push local 0</div><div class="clear"></div>
<div class="linenb">176</div><div class="codeline">  push constant 1</div><div class="clear"></div>
<div class="linenb">177</div><div class="codeline">  add</div><div class="clear"></div>
<div class="linenb">178</div><div class="codeline">  pop local 0</div><div class="clear"></div>
<div class="linenb">179</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">180</div><div class="codeline">  // jump to the beginning of the loop again</div><div class="clear"></div>
<div class="linenb">181</div><div class="codeline">  goto LOOP_START</div><div class="clear"></div>
<div class="linenb">182</div><div class="codeline">  label LOOP_END</div><div class="clear"></div>
<div class="linenb">183</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
<div class="linenb">184</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">185</div><div class="codeline">\cref{table:vm-instructions} lists most instructions in the VM bytecode.</div><div class="clear"></div>
<div class="linenb">186</div><div class="codeline">As they all work the same way, ``add'' represents every instruction which pops two arguments from the stack, such as ``sub'', ``lt'' (less than) and ``or''.</div><div class="clear"></div>
<div class="linenb">187</div><div class="codeline">The ``Arguments'' column here refers to arguments given in the source code, such as ``argument'' and ``1'' for the instruction ``push argument 1''.</div><div class="clear"></div>
<div class="linenb">188</div><div class="codeline">This differs, for example, from the addition instruction, which takes its arguments from the stack.</div><div class="clear"></div>
<div class="linenb">189</div><div class="codeline">TOS means top of stack, the value which was pushed last.</div><div class="clear"></div>
<div class="linenb">190</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">191</div><div class="codeline"><span class="keyword2">\begin{table}</span>[h]</div><div class="clear"></div>
<div class="linenb">192</div><div class="codeline">  <span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">193</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">194</div><div class="codeline">    <span class="keyword2">\begin{tabular}</span>{@{}lllll@{}}</div><div class="clear"></div>
<div class="linenb">195</div><div class="codeline">      \toprule</div><div class="clear"></div>
<div class="linenb">196</div><div class="codeline">      Name     &amp; Purpose                                                        &amp; Arguments \\</div><div class="clear"></div>
<div class="linenb">197</div><div class="codeline">      \midrule</div><div class="clear"></div>
<div class="linenb">198</div><div class="codeline">      add      &amp; Add the two numbers on top of the stack                        &amp; - \\</div><div class="clear"></div>
<div class="linenb">199</div><div class="codeline">      not      &amp; Bit-invert the value on TOS                                    &amp; - \\</div><div class="clear"></div>
<div class="linenb">200</div><div class="codeline">      neg      &amp; Multiply the TOS with -1                                       &amp; - \\</div><div class="clear"></div>
<div class="linenb">201</div><div class="codeline">      push     &amp; Push \(RAM[offset(segment)+index]\) onto the stack             &amp; segment, index \\</div><div class="clear"></div>
<div class="linenb">202</div><div class="codeline">      pop      &amp; Pop the TOS and write it to \(RAM[offset(segment)+index]\)     &amp; segment, index \\</div><div class="clear"></div>
<div class="linenb">203</div><div class="codeline">      label    &amp; Declare a label, i.e., a name referring to a line of code       &amp; label \\</div><div class="clear"></div>
<div class="linenb">204</div><div class="codeline">      goto     &amp; Jump to the specified label                                    &amp; label \\</div><div class="clear"></div>
<div class="linenb">205</div><div class="codeline">      if-goto  &amp; Jump to the label, which is passed as an argument if TOS != 0  &amp; label \\</div><div class="clear"></div>
<div class="linenb">206</div><div class="codeline">      function &amp; Declare a new function and push \(n_{local}\) zeros to the stack &amp; function name, \(n_{local}\) \\</div><div class="clear"></div>
<div class="linenb">207</div><div class="codeline">      call     &amp; Call a function with \(n_{args}\) arguments                     &amp; function name, \(n_{args}\) \\</div><div class="clear"></div>
<div class="linenb">208</div><div class="codeline">      return   &amp; Return from a function                                         &amp;         - \\</div><div class="clear"></div>
<div class="linenb">209</div><div class="codeline">      \bottomrule</div><div class="clear"></div>
<div class="linenb">210</div><div class="codeline">    <span class="keyword2">\end{tabular}</span></div><div class="clear"></div>
<div class="linenb">211</div><div class="codeline">    <span class="keyword1">\caption</span>{The Hack VM bytecode instructions.}</div><div class="clear"></div>
<div class="linenb">212</div><div class="codeline">    <span class="keyword1">\label</span>{table:vm-instructions}</div><div class="clear"></div>
<div class="linenb">213</div><div class="codeline">  <span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">214</div><div class="codeline"><span class="keyword2">\end{table}</span></div><div class="clear"></div>
<div class="linenb">215</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">216</div><div class="codeline"><span class="keyword1">\subsection</span>{Hack test scripts} <span class="keyword1">\label</span>{test-scripts}</div><div class="clear"></div>
<div class="linenb">217</div><div class="codeline">The third and last language relevant to this thesis, is the test script language.</div><div class="clear"></div>
<div class="linenb">218</div><div class="codeline">This script language is special, because students participating in the course usually do not interact with it directly, which is also why the scripts do not appear in~\ref{fig:hack-pipeline}.</div><div class="clear"></div>
<div class="linenb">219</div><div class="codeline">Instead, Schocken and Nisan already supplied test scripts for most of the exercises in the book themselves.</div><div class="clear"></div>
<div class="linenb">220</div><div class="codeline">These scripts are used both by students, to determine if they actually solved the exercise, but also by the teachers grading the project submissions.</div><div class="clear"></div>
<div class="linenb">221</div><div class="codeline">Test scripts can automatically load a program, initialize values in the emulator's memory, run the program, and compare the memory after running for a certain number of ticks with a set of expected values.</div><div class="clear"></div>
<div class="linenb">222</div><div class="codeline">An example of such a script can be seen in~\cref{lst:hack-test-script}.</div><div class="clear"></div>
<div class="linenb">223</div><div class="codeline">All the commands, which are specific to a single emulator, in this case the VM emulator, are highlighted in red.</div><div class="clear"></div>
<div class="linenb">224</div><div class="codeline">The script starts by loading the program it is supposed to test, in this case \verb+MyProgram.vm+.</div><div class="clear"></div>
<div class="linenb">225</div><div class="codeline">Loading behaves differently for the emulators, because the VM emulator is capable of loading an entire directory, while the CPU emulator may only load a single file.</div><div class="clear"></div>
<div class="linenb">226</div><div class="codeline">In order to test the functionality of a program, it is necessary to specify the memory addresses which should be compared and their respective expected values.</div><div class="clear"></div>
<div class="linenb">227</div><div class="codeline">This is done in the next three lines.</div><div class="clear"></div>
<div class="linenb">228</div><div class="codeline">After executing the program, the values specified in output-list will be written in the format dictated after the \%-Symbol into the output-file.</div><div class="clear"></div>
<div class="linenb">229</div><div class="codeline">In the case of~\cref{lst:hack-test-script}, this means writing the values behind the addresses 256 and 300 into \verb+MyProgram.out+, each with one byte of padding on the left and right and a length of six for the value itself.</div><div class="clear"></div>
<div class="linenb">230</div><div class="codeline">The format here will be decimal, as specified by the D.</div><div class="clear"></div>
<div class="linenb">231</div><div class="codeline">Before any of this can happen, however, the program has to first be executed.</div><div class="clear"></div>
<div class="linenb">232</div><div class="codeline">To do this, the test script can first set any value in the emulator's memory to a constant value.</div><div class="clear"></div>
<div class="linenb">233</div><div class="codeline">This is done with the set command, which is specific to each emulator, since each emulator has different requirements.</div><div class="clear"></div>
<div class="linenb">234</div><div class="codeline">The CPU emulator, for example, has no understanding of a stack pointer (sp) or a local segment, as those terms are specific to the VM emulator.</div><div class="clear"></div>
<div class="linenb">235</div><div class="codeline">When everything has been setup, the emulator is interpreted step-by-step with the repeat instruction, in this case 42 VM ticks will be executed.</div><div class="clear"></div>
<div class="linenb">236</div><div class="codeline">The instruction to step the emulator has a different name for each one, but fundamentally behaves the same.</div><div class="clear"></div>
<div class="linenb">237</div><div class="codeline">Finally, the output command writes all the values from the output-list into the output-file which is then compared to the compare-to file.</div><div class="clear"></div>
<div class="linenb">238</div><div class="codeline">These two files should be identical if the program ran correctly, if not an error will be reported.</div><div class="clear"></div>
<div class="linenb">239</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">240</div><div class="codeline"><span class="keyword2">\begin{lstlisting}</span>[</div><div class="clear"></div>
<div class="linenb">241</div><div class="codeline">  language=HackScript,</div><div class="clear"></div>
<div class="linenb">242</div><div class="codeline">  caption={A simple script to test a bytecode program (red means simulator-specific).},</div><div class="clear"></div>
<div class="linenb">243</div><div class="codeline">  label={lst:hack-test-script},</div><div class="clear"></div>
<div class="linenb">244</div><div class="codeline">  captionpos=b]</div><div class="clear"></div>
<div class="linenb">245</div><div class="codeline">load MyProgram.vm,</div><div class="clear"></div>
<div class="linenb">246</div><div class="codeline">output-file MyProgram.out,</div><div class="clear"></div>
<div class="linenb">247</div><div class="codeline">compare-to MyProgram.cmp,</div><div class="clear"></div>
<div class="linenb">248</div><div class="codeline">output-list RAM[256]<span class="comment">%D1.6.1 RAM[300]%D1.6.1</span></div><div class="clear"></div>
<div class="linenb">249</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">250</div><div class="codeline">set sp 256,        // sp contains the address of the top of the stack</div><div class="clear"></div>
<div class="linenb">251</div><div class="codeline">set local 300,     // the base address of the local segment</div><div class="clear"></div>
<div class="linenb">252</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">253</div><div class="codeline">repeat 42 {        // run for 42 ticks</div><div class="clear"></div>
<div class="linenb">254</div><div class="codeline">  vmstep;</div><div class="clear"></div>
<div class="linenb">255</div><div class="codeline">}</div><div class="clear"></div>
<div class="linenb">256</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">257</div><div class="codeline">// Outputs the values specified in output-list to the output-file</div><div class="clear"></div>
<div class="linenb">258</div><div class="codeline">output;</div><div class="clear"></div>
<div class="linenb">259</div><div class="codeline"><span class="keyword2">\end{lstlisting}</span></div><div class="clear"></div>
</div>
<h2 class="filename">tex/related.tex</h2>

<p>Found 0 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;1</div><div class="codeline"><span class="keyword1">\section</span>{Related work}</div><div class="clear"></div>
<div class="linenb">&nbsp;2</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;3</div><div class="codeline">This project builds on much existing material by being both a modern rewrite of an existing tool and a case study about the viability of a number of technologies for porting complex desktop applications to the browser.</div><div class="clear"></div>
<div class="linenb">&nbsp;4</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;5</div><div class="codeline">It naturally is closely related to the Nand to Tetris~\cite{n2tweb} course. All of the high-level functionality was designed and specified by Nisan and Schocken.</div><div class="clear"></div>
<div class="linenb">&nbsp;6</div><div class="codeline">Since the goal of this project is to develop an alternative emulator implementation, care was taken to follow the specifications described in the companion book, specifically the sections 4.2, 7.2, 8.2 and 9.2.7~\cite{nisan2005}.</div><div class="clear"></div>
<div class="linenb">&nbsp;7</div><div class="codeline">In addition, many of the integration tests are direct ports of test cases from the Nand to Tetris course.</div><div class="clear"></div>
<div class="linenb">&nbsp;8</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;9</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">10</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> VM Bytecode design und high level Funktionalitt</span></span></div><div class="clear"></div>
<div class="linenb">11</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> CPU Assembly design und high level Funktionalitt</span></span></div><div class="clear"></div>
<div class="linenb">12</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> TST design und high level Funktionalitt</span></span></div><div class="clear"></div>
<div class="linenb">13</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> Viele Tests fr Emulatoren aus N2T Projekten</span></span></div><div class="clear"></div>
<div class="linenb">14</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">15</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">16</div><div class="codeline"><span class="keyword1">\subsection</span>{Existing emulator implementations}</div><div class="clear"></div>
<div class="linenb">17</div><div class="codeline">The main implementation of a Nand to Tetris Emulator is, of course, the official one, which can be downloaded directly from the course website and contains every necessary tool to complete all projects~\cite[Software]{n2tweb}.</div><div class="clear"></div>
<div class="linenb">18</div><div class="codeline"><span class="keyword1">\label</span>{pynand}</div><div class="clear"></div>
<div class="linenb">19</div><div class="codeline">That being said, there are other people who have tried to provide an alternative emulator experience.</div><div class="clear"></div>
<div class="linenb">20</div><div class="codeline">One of these is pynand, which aims to provide a better experience by eliminating the need to install Java and by making the interface less ``clunky''~\cite{pynand}.</div><div class="clear"></div>
<div class="linenb">21</div><div class="codeline">However, the developer made several decisions that limit its usefulness.</div><div class="clear"></div>
<div class="linenb">22</div><div class="codeline">It does little to improve the performance of the emulator and also severely limits the programs that can be run.</div><div class="clear"></div>
<div class="linenb">23</div><div class="codeline">This limitation of possible programs is a direct consequence of its architecture, which translates the VM bytecode~\ref{hack-bytecode} into machine code for the hack architecture~\ref{hack-architecture} instead of interpreting it directly.</div><div class="clear"></div>
<div class="linenb">24</div><div class="codeline">At first glance this may seem reasonable, since it is closer to a theoretical implementation of the system in hardware, but it severely limits the possibilities of the VM emulator, since each VM instruction corresponds to several assembly instructions.</div><div class="clear"></div>
<div class="linenb">25</div><div class="codeline">This causes more complex VM programs to quickly overflow the available memory for instructions, limiting the emulator to relatively short programs.</div><div class="clear"></div>
<div class="linenb">26</div><div class="codeline">Since the goal of this project was to partially replace the official VM emulator implementation, which allows for larger programs than should theoretically be possible, this approach is not an option here.</div><div class="clear"></div>
<div class="linenb">27</div><div class="codeline">It also doesn't provide a user interface outside of the display, which makes debugging complex programs difficult. Besides, the user still has to install software on his computer, just Python instead of Java.</div><div class="clear"></div>
<div class="linenb">28</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">29</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">30</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> https://github.com/itoshkov/nand2tetris-emu</span></span></div><div class="clear"></div>
<div class="linenb">31</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> https://github.com/mossprescott/pynand</span></span></div><div class="clear"></div>
<div class="linenb">32</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">33</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">34</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{Emulators in WebAssembly}</span></span></div><div class="clear"></div>
<div class="linenb">35</div><div class="codeline">In recent years, there have been several projects that implemented other emulators in WebAssembly. Notably, an emulator for Intel's 8086 microprocessor~\cite{9824078}, also written in Rust and using a ReactJS front-end. This already demonstrates the viability of these technologies for creating web-based emulators, but obviously offers no benefit to participants of the Nand to Tetris course, which is the main goal of this work.</div><div class="clear"></div>
<div class="linenb">36</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">37</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">38</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> https://ieeexplore.ieee.org/abstract/document/9824078</span></span></div><div class="clear"></div>
<div class="linenb">39</div><div class="codeline"><span class="comment"><span class="comment">%   <span class="keyword1">\item</span> https://wasm4.org/</span></span></div><div class="clear"></div>
<div class="linenb">40</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">41</div><div class="codeline"><span class="keyword1">\subsection</span>{Dependencies}</div><div class="clear"></div>
<div class="linenb">42</div><div class="codeline"><span class="keyword1">\label</span>{rust-deps}</div><div class="clear"></div>
<div class="linenb">43</div><div class="codeline">One of the main reasons why Rust was chosen as the language for this project is its strong ecosystem, especially in regard to WebAssembly~\ref{rust-vs-other-wasm}.</div><div class="clear"></div>
<div class="linenb">44</div><div class="codeline">Therefore, it is not surprising that several other Rust projects were used here to be both more efficient and to produce a more stable and reliable final program.</div><div class="clear"></div>
<div class="linenb">45</div><div class="codeline">At the same time, it is also important to use as few dependencies as possible, as any dependency could become a future liability if that library is ever abandoned or compromised by malicious actors.</div><div class="clear"></div>
<div class="linenb">46</div><div class="codeline">For this reason, each library used in this project has a clear purpose and provides enough value to justify its inclusion. Libraries are often referred to as crates in Rust, so these terms are used interchangeably throughout the text.</div><div class="clear"></div>
<div class="linenb">47</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">48</div><div class="codeline">This section summarizes the rationale for including each crate.</div><div class="clear"></div>
<div class="linenb">49</div><div class="codeline">Rust does not currently allow static constants that require runtime code for initialization. This is however a very useful feature, for example to use hashmaps to define lookup tables.</div><div class="clear"></div>
<div class="linenb">50</div><div class="codeline">The lazy\_static crate is one of the most used libraries in the Rust ecosystem~\cite[Downloads all time]{lazystatic} because it provides exactly this functionality in the form of a single macro~\ref{macros-and-error-handling}. Among other things, it is used for the lookup table in the keyboard handler that maps special symbols like the escape key to the corresponding key codes in the emulator.</div><div class="clear"></div>
<div class="linenb">51</div><div class="codeline">Regular expressions are a very handy tool for simple parsing tasks. They are used to parse some tokens in the test scripts for the emulator. Rust does not provide regular expressions in its standard library, so the regex crate was used.</div><div class="clear"></div>
<div class="linenb">52</div><div class="codeline"><span class="keyword1">\label</span>{web-sys}</div><div class="clear"></div>
<div class="linenb">53</div><div class="codeline">The two most important libraries when it comes to the value of Rust for this project are wasm-bindgen and web-sys.</div><div class="clear"></div>
<div class="linenb">54</div><div class="codeline">While the former is responsible for creating bindings between Rust and JavaScript so that the two can call each other as if they were the same language, the latter provides implementations for common JavaScript APIs in Rust.</div><div class="clear"></div>
<div class="linenb">55</div><div class="codeline">It builds directly on top of wasm-bindgen to provide most of the functionality that users would normally have to manually write bindings for.</div><div class="clear"></div>
<div class="linenb">56</div><div class="codeline">These two libraries are further complemented by console\_error\_panic\_hook and wasm-pack.</div><div class="clear"></div>
<div class="linenb">57</div><div class="codeline">The former simply prints the stack trace of any unrecoverable Rust error~\ref{macros-and-error-handling} to the JavaScript console.</div><div class="clear"></div>
<div class="linenb">58</div><div class="codeline">Wasm-pack, on the other hand, is a build tool that simplifies working with Rust in the context of Wasm by providing a command-line tool that builds and packages Rust applications into Wasm modules automatically.</div><div class="clear"></div>
<div class="linenb">59</div><div class="codeline">This tool is only used at compile time and is therefore only needed to compile the application, not to run it.</div><div class="clear"></div>
<div class="linenb">60</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">61</div><div class="codeline">The above dependencies are all that is needed for the web version of the emulator. If the native version is used instead, two different dependencies are used instead of the Wasm-focused dependencies.</div><div class="clear"></div>
<div class="linenb">62</div><div class="codeline">The first is SDL2, which is only included if the application is compiled with the desktop flag enabled~\ref{conditional-compilation}.</div><div class="clear"></div>
<div class="linenb">63</div><div class="codeline">Finally, there is clap, an easy-to-use parsing library for command line arguments.</div><div class="clear"></div>
<div class="linenb">64</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">65</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">66</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\item</span> lazy\_static (hack um rust weniger nervig zu machen)</span></span></div><div class="clear"></div>
<div class="linenb">67</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\item</span> regex</span></span></div><div class="clear"></div>
<div class="linenb">68</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\item</span> wasm-bindgen (rust code fr JS zugnglich machen)</span></span></div><div class="clear"></div>
<div class="linenb">69</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\item</span> web-sys (js stdlib in Rust nutzen)</span></span></div><div class="clear"></div>
<div class="linenb">70</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\item</span> console\_error\_panic\_hook (rust panics zu JS exeptions)</span></span></div><div class="clear"></div>
<div class="linenb">71</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\item</span> sdl2 (native UI (eigentlich nur zum Testen))</span></span></div><div class="clear"></div>
<div class="linenb">72</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\item</span> clap (CLI parsing)</span></span></div><div class="clear"></div>
<div class="linenb">73</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\item</span> wasm-pack (rust -&gt; wasm Kompilierung einfacher machen)</span></span></div><div class="clear"></div>
<div class="linenb">74</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{itemize}</span></span></span></div><div class="clear"></div>
<div class="linenb">75</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">76</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsubsection</span>{JavaScript Dependencies}</span></span></div><div class="clear"></div>
<div class="linenb">77</div><div class="codeline">ReactJS is the only JavaScript dependency for the web-based user interface.</div><div class="clear"></div>
<div class="linenb">78</div><div class="codeline">Since most of the logic is implemented in Rust, the code needed for the user interface is mainly focused on displaying the internal state of the emulator.</div><div class="clear"></div>
<div class="linenb">79</div><div class="codeline">There are no complex UI components or procedures that would justify the use of separate libraries.</div><div class="clear"></div>
<div class="linenb">80</div><div class="codeline">The entire front-end simply uses React hooks for all state handling.</div><div class="clear"></div>
<div class="linenb">81</div><div class="codeline">In addition, the interface was intentionally kept minimalist to match the emulator's black-and-white display, so no external CSS libraries are required.</div><div class="clear"></div>
<div class="linenb">82</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">83</div><div class="codeline">The appendix also contains a table with every dependency used in the project~\ref{table:dependencies}.</div><div class="clear"></div>
</div>
<h2 class="filename">tex/intro.tex</h2>

<p>Found 0 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;1</div><div class="codeline"><span class="keyword1">\section</span>{Introduction}</div><div class="clear"></div>
<div class="linenb">&nbsp;2</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{Motivation}</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;3</div><div class="codeline">Over the decades since its inception, the field of computer science has become increasingly complex and confusing.</div><div class="clear"></div>
<div class="linenb">&nbsp;4</div><div class="codeline">This has caused students today to lose track of the picture at large and instead specialize on specific aspects of the field.</div><div class="clear"></div>
<div class="linenb">&nbsp;5</div><div class="codeline">Shimon Schocken and Noam Nisam believe that this is an issue and that the best way to understand how computers actually work is to build one from scratch yourself.~\cite[Preface]{nisan2005}</div><div class="clear"></div>
<div class="linenb">&nbsp;6</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;7</div><div class="codeline">In order to allow students to take this seemingly impossible approach, Schocken and Nisan developed the Nand to Tetris course in 2004, which gives students the opportunity to build an entire computer system themselves.~\cite{1408798}</div><div class="clear"></div>
<div class="linenb">&nbsp;8</div><div class="codeline">The system that the participants create over the course of twelve projects is powerful enough to enable the implementation of complex applications and games.\ref{fig:hackenstein-official}</div><div class="clear"></div>
<div class="linenb">&nbsp;9</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">10</div><div class="codeline"><span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">11</div><div class="codeline">  <span class="keyword2">\begin{figure}</span>[ht]</div><div class="clear"></div>
<div class="linenb">12</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">13</div><div class="codeline">    <span class="keyword1">\includegraphics</span>[width=10cm]{fig/hackenstein-official.png}</div><div class="clear"></div>
<div class="linenb">14</div><div class="codeline">    <span class="keyword1">\caption</span>{A simple Wolfenstein 3D Clone running in the VM Emulator.}<span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">15</div><div class="codeline">    <span class="keyword1">\label</span>{fig:hackenstein-official}</div><div class="clear"></div>
<div class="linenb">16</div><div class="codeline">  <span class="keyword2">\end{figure}</span></div><div class="clear"></div>
<div class="linenb">17</div><div class="codeline"><span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">18</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">19</div><div class="codeline">To improve performance, enable students to work on the included projects in a different order than intended, and to provide a better debugging experience, the authors have included a hardware simulator for the initial projects and two different emulators that can simulate the preceding stages of the course.</div><div class="clear"></div>
<div class="linenb">20</div><div class="codeline">These emulators are, however, also a frequent point of criticism from course participants, as they increasingly no longer meet the demands of modern users.</div><div class="clear"></div>
<div class="linenb">21</div><div class="codeline">Written in Java using the Swing framework, they are not only slow, but also do not adapt to today's higher screen resolutions, making it difficult to actually see the contents of the running application~\ref{fig:hackenstein-official}.</div><div class="clear"></div>
<div class="linenb">22</div><div class="codeline">The performance also makes some projects that could otherwise have been implemented on the platform infeasible.</div><div class="clear"></div>
<div class="linenb">23</div><div class="codeline">It therefore makes sense to rewrite these emulators to make the course more accessible and thus increase the number of participants.</div><div class="clear"></div>
<div class="linenb">24</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">25</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{Contributions}</span></span></div><div class="clear"></div>
<div class="linenb">26</div><div class="codeline">As part of this work, the two emulators were rewritten as a browser application using WebAssembly. This not only allows support for larger screens and significantly improved performance, but also allows the tools to be used without having to be installed on the student's computer.</div><div class="clear"></div>
<div class="linenb">27</div><div class="codeline">The new emulator implementations can now be accessed simply by visiting a URL in a web browser and submitting the bytecode or assembly files via a file selection dialog. Performance has improved significantly, as shown in ~\cref{sec:benchmarks}, allowing users to create even more complex games and applications than before.</div><div class="clear"></div>
<div class="linenb">28</div><div class="codeline">In addition, both emulators can be compiled into stand-alone executables that can run the course's test scripts without user input, allowing instructors and course reviewers to use the new emulators to grade submissions.</div><div class="clear"></div>
</div>
<h2 class="filename">thesis.tex</h2>

<p>Found 1 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;&nbsp;1</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;2</div><div class="codeline"><span class="comment"><span class="comment">% Universitt Dsseldorf                                                       %</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;3</div><div class="codeline"><span class="comment"><span class="comment">% Lehrstuhl fr Softwaretechnik und Programmiersprachen                        %</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;4</div><div class="codeline"><span class="comment"><span class="comment">% Vorlage fr Bachelor- und Masterarbeiten                                     %</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;5</div><div class="codeline"><span class="comment"><span class="comment">% Erstellt: 2019-09-03                                                         %</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;6</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;7</div><div class="codeline"><span class="keyword1">\documentclass</span>{hhuthesis}</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;8</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;&nbsp;9</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;10</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;11</div><div class="codeline"><span class="comment"><span class="comment">%% Einstellungen zur Personalisierung                                         %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;12</div><div class="codeline"><span class="comment"><span class="comment">%%                                                                            %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;13</div><div class="codeline"><span class="comment"><span class="comment">%% Im Folgenden knnen Sie Ihre Arbeit personalisieren.                       %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;14</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;15</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;16</div><div class="codeline"><span class="comment"><span class="comment">%% Spracheinstellung</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;17</div><div class="codeline"><span class="comment"><span class="comment">%% Kommentieren Sie die entsprechende Zeile ein bzw. aus.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;18</div><div class="codeline"><span class="comment"><span class="comment">%% Wir empfehlen jedem sich an einer englischen Arbeit zu versuchen.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;19</div><div class="codeline"><span class="keyword1">\usepackage</span>[ngerman,english]{babel} <span class="comment">% English</span></div><div class="clear"></div>
<div class="linenb">&nbsp;20</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\usepackage</span>[english,ngerman]{babel} % Deutsch</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;21</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;22</div><div class="codeline"><span class="comment"><span class="comment">%% Ihr Name</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;23</div><div class="codeline">\author{Felix Schoeller}</div><div class="clear"></div>
<div class="linenb">&nbsp;24</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;25</div><div class="codeline"><span class="comment"><span class="comment">%% Der Titel der Arbeit</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;26</div><div class="codeline"><span class="keyword1">\title</span>{VM development targeting the web browser with Rust and WebAssembly}</div><div class="clear"></div>
<div class="linenb">&nbsp;27</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;28</div><div class="codeline"><span class="comment"><span class="comment">%% Der zu erreichende Abschluss, entweder Bachelor oder Master</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;29</div><div class="codeline">\gratuationtype{Bachelor}</div><div class="clear"></div>
<div class="linenb">&nbsp;30</div><div class="codeline"><span class="comment"><span class="comment">% \gratuationtype{Master}</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;31</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;32</div><div class="codeline"><span class="comment"><span class="comment">%% Beginn- und Abgabedaten der Arbeit</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;33</div><div class="codeline">\begindate{17. September 2022} <span class="comment">% Beginn</span></div><div class="clear"></div>
<div class="linenb">&nbsp;34</div><div class="codeline">\duedate{17. Dezember 2022} <span class="comment">% Abgabe</span></div><div class="clear"></div>
<div class="linenb">&nbsp;35</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;36</div><div class="codeline"><span class="comment"><span class="comment">%% Erst- und Zweitgutachter</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;37</div><div class="codeline">\firstexaminer{Dr.~John~Witulski}</div><div class="clear"></div>
<div class="linenb">&nbsp;38</div><div class="codeline">\secondexaminer{Prof.~Dr.~Michael~Schttner}</div><div class="clear"></div>
<div class="linenb">&nbsp;39</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;40</div><div class="codeline"><span class="comment"><span class="comment">%% Farb- oder Schwarzweidruck</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;41</div><div class="codeline"><span class="comment"><span class="comment">% Benutzen Sie das Kommando \blackwhiteprint,</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;42</div><div class="codeline"><span class="comment"><span class="comment">% wenn sie in schwarzwei drucken mchten.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;43</div><div class="codeline"><span class="comment"><span class="comment">% Im Farbdruck ist jede farbige Seite idR teurer.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;44</div><div class="codeline"><span class="comment"><span class="comment">% \blackwhiteprint  % Kommentarzeichen entfernen fr Schwarzweidruck</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;45</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;46</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;47</div><div class="codeline"><span class="comment"><span class="comment">%% (Ende) Einstellungen zur Personalisierung                                  %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;48</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;49</div><div class="codeline"><span class="comment"><span class="comment">%% LaTeX Packages in Nutzung                                                  %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;50</div><div class="codeline"><span class="comment"><span class="comment">%%                                                                            %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;51</div><div class="codeline"><span class="comment"><span class="comment">%% Im folgenden knnen Sie fr die Niederschrift Ihrer Arbeit bentigte       %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;52</div><div class="codeline"><span class="comment"><span class="comment">%% LaTeX-Pakete einbinden.                                                    %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;53</div><div class="codeline"><span class="comment"><span class="comment">%% Diese Vorlage kommt bereits mit einigen ntzlichen inkludierten Paketen.   %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;54</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;55</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;56</div><div class="codeline"><span class="comment"><span class="comment">%% Macht den \todo-Befehl verfgbar.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;57</div><div class="codeline"><span class="comment"><span class="comment">%% Hiermit knnen Sie Abschnitte annotieren,</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;58</div><div class="codeline"><span class="comment"><span class="comment">%% welche weiterer Bearbeitung bedrfen.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;59</div><div class="codeline"><span class="keyword1">\usepackage</span>[textsize=scriptsize]{todonotes}</div><div class="clear"></div>
<div class="linenb">&nbsp;60</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;61</div><div class="codeline"><span class="comment"><span class="comment">%% Zeige Zeilennummern in der Arbeit an.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;62</div><div class="codeline"><span class="comment"><span class="comment">%% Der \linenumbers Befehl muss hierzu aufgerufen werden.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;63</div><div class="codeline"><span class="comment"><span class="comment">%% Praktisch fr Feedback Ihrer potentiellen Korrekturleser!</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;64</div><div class="codeline"><span class="keyword1">\usepackage</span>{lineno}</div><div class="clear"></div>
<div class="linenb">&nbsp;65</div><div class="codeline"><span class="comment"><span class="comment">% \linenumbers % &lt;- Kommentar entfernen!</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;66</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;67</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;68</div><div class="codeline"><span class="comment"><span class="comment">%% Hufig benutzte mathematische Packages.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;69</div><div class="codeline"><span class="keyword1">\usepackage</span>{amsfonts}</div><div class="clear"></div>
<div class="linenb">&nbsp;70</div><div class="codeline"><span class="keyword1">\usepackage</span>{amsmath}</div><div class="clear"></div>
<div class="linenb">&nbsp;71</div><div class="codeline"><span class="keyword1">\usepackage</span>{amssymb}</div><div class="clear"></div>
<div class="linenb">&nbsp;72</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;73</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;74</div><div class="codeline"><span class="keyword1">\usepackage</span>{listings} <span class="comment">% Einbindung von Code</span></div><div class="clear"></div>
<div class="linenb">&nbsp;75</div><div class="codeline"><span class="keyword1">\usepackage</span>{algorithmicx} <span class="comment">% Angabe von Algorithmen in Pseudocode</span></div><div class="clear"></div>
<div class="linenb">&nbsp;76</div><div class="codeline"><span class="keyword1">\usepackage</span>{siunitx} <span class="comment">% \num Befehl zum einfacheren Formatieren von Zahlen.</span></div><div class="clear"></div>
<div class="linenb">&nbsp;77</div><div class="codeline"><span class="keyword1">\usepackage</span>{enumitem} <span class="comment">% Leichter konfigurierbare enumerate-Umgebungen.</span></div><div class="clear"></div>
<div class="linenb">&nbsp;78</div><div class="codeline"><span class="keyword1">\usepackage</span>{subcaption} <span class="comment">% Unterteilung von Figures in Subfigures.</span></div><div class="clear"></div>
<div class="linenb">&nbsp;79</div><div class="codeline"><span class="keyword1">\usepackage</span>{hyperref} <span class="comment">% Klickbare Referenzen (z.B. im Inhaltsverzeichnis)</span></div><div class="clear"></div>
<div class="linenb">&nbsp;80</div><div class="codeline"><span class="keyword1">\usepackage</span>{url} <span class="comment">% \url Kommando fr Darstellung von Links</span></div><div class="clear"></div>
<div class="linenb">&nbsp;81</div><div class="codeline"><span class="keyword1">\usepackage</span>{csquotes} <span class="comment">% Improved quoting.</span></div><div class="clear"></div>
<div class="linenb">&nbsp;82</div><div class="codeline"><span class="keyword1">\usepackage</span>{xspace} <span class="comment">% Nicht terminierte Kommandos essen keinen Whitespace mehr.</span></div><div class="clear"></div>
<div class="linenb">&nbsp;83</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;84</div><div class="codeline"><span class="comment"><span class="comment">%% Tabellen</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;85</div><div class="codeline"><span class="keyword1">\usepackage</span>{tabularx} <span class="comment">% tabularx Umgebung fr mehr Kontrolle ber Tabellen.</span></div><div class="clear"></div>
<div class="linenb">&nbsp;86</div><div class="codeline"><span class="keyword1">\usepackage</span>{booktabs} <span class="comment">% \toprule, \midrule, \bottomrule</span></div><div class="clear"></div>
<div class="linenb">&nbsp;87</div><div class="codeline"><span class="keyword1">\usepackage</span>{multirow}</div><div class="clear"></div>
<div class="linenb">&nbsp;88</div><div class="codeline"><span class="keyword1">\usepackage</span>{multicol}</div><div class="clear"></div>
<div class="linenb">&nbsp;89</div><div class="codeline"><span class="keyword1">\usepackage</span>{longtable} <span class="comment">% Groe Tabellen gehen ber mehrere Seiten.</span></div><div class="clear"></div>
<div class="linenb">&nbsp;90</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;91</div><div class="codeline"><span class="comment"><span class="comment">%% Intelligenteres Referenzieren mittels \cref.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;92</div><div class="codeline"><span class="comment"><span class="comment">%% \languagename um dynamisch zwischen ngerman oder english zu wechseln.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;93</div><div class="codeline"><span class="keyword1">\usepackage</span>[\languagename,capitalize]{cleveref}</div><div class="clear"></div>
<div class="linenb">&nbsp;94</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;95</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;96</div><div class="codeline"><span class="comment"><span class="comment">%% (Ende) LaTeX Packages in Nutzung                                           %%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;97</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;98</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;99</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">100</div><div class="codeline"><span class="comment"><span class="comment">%% Custom Syntax highlighting                                                 %%</span></span></div><div class="clear"></div>
<div class="linenb">101</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">102</div><div class="codeline"><span class="keyword1">\usepackage</span>{xcolor}</div><div class="clear"></div>
<div class="linenb">103</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">104</div><div class="codeline">\definecolor{commentsColor}{rgb}{0.497495, 0.497587, 0.497464}</div><div class="clear"></div>
<div class="linenb">105</div><div class="codeline">\definecolor{keywordsColor}{rgb}{0.000000, 0.000000, 0.635294}</div><div class="clear"></div>
<div class="linenb">106</div><div class="codeline">\definecolor{stringColor}{rgb}{0.558215, 0.000000, 0.135316}</div><div class="clear"></div>
<div class="linenb">107</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">108</div><div class="codeline">\lstset{ <span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">109</div><div class="codeline">  backgroundcolor=\color{white},   <span class="comment">% choose the background color; you must add <span class="keyword1">\usepackage</span>{color} or <span class="keyword1">\usepackage</span>{xcolor}</span></div><div class="clear"></div>
<div class="linenb">110</div><div class="codeline">  basicstyle=\footnotesize,        <span class="comment">% the size of the fonts that are used for the code</span></div><div class="clear"></div>
<div class="linenb">111</div><div class="codeline">  breakatwhitespace=false,         <span class="comment">% sets if automatic breaks should only happen at whitespace</span></div><div class="clear"></div>
<div class="linenb">112</div><div class="codeline">  breaklines=true,                 <span class="comment">% sets automatic line breaking</span></div><div class="clear"></div>
<div class="linenb">113</div><div class="codeline">  captionpos=b,                    <span class="comment">% sets the caption-position to bottom</span></div><div class="clear"></div>
<div class="linenb">114</div><div class="codeline">  commentstyle=\color{commentsColor}<span class="keyword1">\textit</span>,    <span class="comment">% comment style</span></div><div class="clear"></div>
<div class="linenb">115</div><div class="codeline">  deletekeywords={...},            <span class="comment">% if you want to delete keywords from the given language</span></div><div class="clear"></div>
<div class="linenb">116</div><div class="codeline">  escapeinside={\%*}{*)},          <span class="comment">% if you want to add LaTeX within your code</span></div><div class="clear"></div>
<div class="linenb">117</div><div class="codeline">  extendedchars=true,              <span class="comment">% lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8</span></div><div class="clear"></div>
<div class="linenb">118</div><div class="codeline">  <span class="comment">% frame=tb,	                     % adds a frame around the code</span></div><div class="clear"></div>
<div class="linenb">119</div><div class="codeline">  keepspaces=true,                 <span class="comment">% keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)</span></div><div class="clear"></div>
<div class="linenb">120</div><div class="codeline">  keywordstyle=\color{keywordsColor}\bfseries,       <span class="comment">% keyword style</span></div><div class="clear"></div>
<div class="linenb">121</div><div class="codeline">  language=Python,                 <span class="comment">% the language of the code (can be overrided per snippet)</span></div><div class="clear"></div>
<div class="linenb">122</div><div class="codeline">  otherkeywords={*,...},           <span class="comment">% if you want to add more keywords to the set</span></div><div class="clear"></div>
<div class="linenb">123</div><div class="codeline">  numbers=left,                    <span class="comment">% where to put the line-numbers; possible values are (none, left, right)</span></div><div class="clear"></div>
<div class="linenb">124</div><div class="codeline">  numbersep=5pt,                   <span class="comment">% how far the line-numbers are from the code</span></div><div class="clear"></div>
<div class="linenb">125</div><div class="codeline">  numberstyle=\tiny\color{commentsColor}, <span class="comment">% the style that is used for the line-numbers</span></div><div class="clear"></div>
<div class="linenb">126</div><div class="codeline">  rulecolor=\color{black},         <span class="comment">% if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))</span></div><div class="clear"></div>
<div class="linenb">127</div><div class="codeline">  showspaces=false,                <span class="comment">% show spaces everywhere adding particular underscores; it overrides 'showstringspaces'</span></div><div class="clear"></div>
<div class="linenb">128</div><div class="codeline">  showstringspaces=false,          <span class="comment">% underline spaces within strings only</span></div><div class="clear"></div>
<div class="linenb">129</div><div class="codeline">  showtabs=false,                  <span class="comment">% show tabs within strings adding particular underscores</span></div><div class="clear"></div>
<div class="linenb">130</div><div class="codeline">  stepnumber=1,                    <span class="comment">% the step between two line-numbers. If it's 1, each line will be numbered</span></div><div class="clear"></div>
<div class="linenb">131</div><div class="codeline">  stringstyle=\color{stringColor}, <span class="comment">% string literal style</span></div><div class="clear"></div>
<div class="linenb">132</div><div class="codeline">  tabsize=2,                       <span class="comment">% sets default tabsize to 2 spaces</span></div><div class="clear"></div>
<div class="linenb">133</div><div class="codeline">  title=\lstname,                  <span class="comment">% show the filename of files included with \lstinputlisting; also try caption instead of title</span></div><div class="clear"></div>
<div class="linenb">134</div><div class="codeline">  columns=fixed                    <span class="comment">% Using fixed column width (for e.g. nice alignment)</span></div><div class="clear"></div>
<div class="linenb">135</div><div class="codeline">}</div><div class="clear"></div>
<div class="linenb">136</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">137</div><div class="codeline">\lstdefinelanguage{Hack}{</div><div class="clear"></div>
<div class="linenb">138</div><div class="codeline">  keywords={add, sub, eq, gt, lt, and, or, not, neg, push, pop,</div><div class="clear"></div>
<div class="linenb">139</div><div class="codeline">    if-goto, goto, label, function, call, return},</div><div class="clear"></div>
<div class="linenb">140</div><div class="codeline">  ndkeywords={argument, local, static, constant, this, that, pointer, temp},</div><div class="clear"></div>
<div class="linenb">141</div><div class="codeline">  ndkeywordstyle=\color{darkgray}\bfseries,</div><div class="clear"></div>
<div class="linenb">142</div><div class="codeline">  sensitive=false, <span class="comment">% keywords are not case-sensitive</span></div><div class="clear"></div>
<div class="linenb">143</div><div class="codeline">  alsoletter=-,</div><div class="clear"></div>
<div class="linenb">144</div><div class="codeline">  morecomment=[l]{//}, <span class="comment">% l is for line comment</span></div><div class="clear"></div>
<div class="linenb">145</div><div class="codeline">  morecomment=[s]{/*}{*/}, <span class="comment">% s is for start and end delimiter</span></div><div class="clear"></div>
<div class="linenb">146</div><div class="codeline">  morestring=[b]" <span class="comment">% defines that strings are enclosed in double quotes</span></div><div class="clear"></div>
<div class="linenb">147</div><div class="codeline">}</div><div class="clear"></div>
<div class="linenb">148</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">149</div><div class="codeline">\lstdefinelanguage{HackAsm}{</div><div class="clear"></div>
<div class="linenb">150</div><div class="codeline">  keywords={},</div><div class="clear"></div>
<div class="linenb">151</div><div class="codeline">  sensitive=false, <span class="comment">% keywords are not case-sensitive</span></div><div class="clear"></div>
<div class="linenb">152</div><div class="codeline">  morecomment=[l]{//}, <span class="comment">% l is for line comment</span></div><div class="clear"></div>
<div class="linenb">153</div><div class="codeline">  morecomment=[s]{/*}{*/}, <span class="comment">% s is for start and end delimiter</span></div><div class="clear"></div>
<div class="linenb">154</div><div class="codeline">  morestring=[b]" <span class="comment">% defines that strings are enclosed in double quotes</span></div><div class="clear"></div>
<div class="linenb">155</div><div class="codeline">}</div><div class="clear"></div>
<div class="linenb">156</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">157</div><div class="codeline">\lstdefinelanguage{HackScript}{</div><div class="clear"></div>
<div class="linenb">158</div><div class="codeline">  keywords={output-file, compare-to, output-list, repeat, output, set},</div><div class="clear"></div>
<div class="linenb">159</div><div class="codeline">  ndkeywords={sp, local, argument, this, that, vmstep, load},</div><div class="clear"></div>
<div class="linenb">160</div><div class="codeline">  ndkeywordstyle=\color{red}\bfseries,</div><div class="clear"></div>
<div class="linenb">161</div><div class="codeline">  sensitive=false, <span class="comment">% keywords are not case-sensitive</span></div><div class="clear"></div>
<div class="linenb">162</div><div class="codeline">  alsoletter=-,</div><div class="clear"></div>
<div class="linenb">163</div><div class="codeline">  morecomment=[l]{//}, <span class="comment">% l is for line comment</span></div><div class="clear"></div>
<div class="linenb">164</div><div class="codeline">  morecomment=[s]{/*}{*/}, <span class="comment">% s is for start and end delimiter</span></div><div class="clear"></div>
<div class="linenb">165</div><div class="codeline">  morestring=[b]" <span class="comment">% defines that strings are enclosed in double quotes</span></div><div class="clear"></div>
<div class="linenb">166</div><div class="codeline">}</div><div class="clear"></div>
<div class="linenb">167</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">168</div><div class="codeline">\lstdefinelanguage{Rust}{</div><div class="clear"></div>
<div class="linenb">169</div><div class="codeline">  keywords={as,break,const,continue,crate,else,enum,extern,false,fn,for,if,impl,</div><div class="clear"></div>
<div class="linenb">170</div><div class="codeline">    in,let,loop,match,mod,move,mut,pub,ref,return,self,Self,static,struct,super,trait,true,type,unsafe,use,where,while</div><div class="clear"></div>
<div class="linenb">171</div><div class="codeline">  },</div><div class="clear"></div>
<div class="linenb">172</div><div class="codeline">  ndkeywords={i8, i16, i32, i64, u8, u16, u32, u64, usize, isize, f32, f64},</div><div class="clear"></div>
<div class="linenb">173</div><div class="codeline">  ndkeywordstyle=\color{darkgray}\bfseries,</div><div class="clear"></div>
<div class="linenb">174</div><div class="codeline">  identifierstyle=\color{black},</div><div class="clear"></div>
<div class="linenb">175</div><div class="codeline">  sensitive=true, <span class="comment">% keywords are case-sensitive</span></div><div class="clear"></div>
<div class="linenb">176</div><div class="codeline">  comment=[l]{//}, <span class="comment">% l is for line comment</span></div><div class="clear"></div>
<div class="linenb">177</div><div class="codeline">  morecomment=[s]{/*}{*/}, <span class="comment">% s is for start and end delimiter</span></div><div class="clear"></div>
<div class="linenb">178</div><div class="codeline">  morestring=[b]" <span class="comment">% defines that strings are enclosed in double quotes</span></div><div class="clear"></div>
<div class="linenb">179</div><div class="codeline">}</div><div class="clear"></div>
<div class="linenb">180</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">181</div><div class="codeline"><span class="comment"><span class="comment">%% (Ende) Custom Syntax highlighting                                          %%</span></span></div><div class="clear"></div>
<div class="linenb">182</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">183</div><div class="codeline"><span class="keyword2">\begin{document}</span></div><div class="clear"></div>
<div class="linenb">184</div><div class="codeline"><span class="comment"><span class="comment">%% Set up title page, declaration of authorship, abstract, acknowledgements</span></span></div><div class="clear"></div>
<div class="linenb">185</div><div class="codeline">\frontmatter</div><div class="clear"></div>
<div class="linenb">186</div><div class="codeline">\makefrontmatter</div><div class="clear"></div>
<div class="linenb">187</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">188</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">189</div><div class="codeline"><span class="comment"><span class="comment">%% Danksagungen                                                               %%</span></span></div><div class="clear"></div>
<div class="linenb">190</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">191</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\begin{acknowledgements}</span></span></span></div><div class="clear"></div>
<div class="linenb">192</div><div class="codeline"><span class="comment"><span class="comment">%   Im Falle, dass Sie Ihrer Arbeit eine Danksagung fr Ihre Untersttzer</span></span></div><div class="clear"></div>
<div class="linenb">193</div><div class="codeline"><span class="comment"><span class="comment">%   (Familie, Freunde, Betreuer)</span></span></div><div class="clear"></div>
<div class="linenb">194</div><div class="codeline"><span class="comment"><span class="comment">%   hinzufgen mchten, knnen Sie diese hier platzieren.</span></span></div><div class="clear"></div>
<div class="linenb">195</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">196</div><div class="codeline"><span class="comment"><span class="comment">%   Dieser Part ist optional und kann im Quelltext auskommentiert werden.</span></span></div><div class="clear"></div>
<div class="linenb">197</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword2">\end{acknowledgements}</span></span></span></div><div class="clear"></div>
<div class="linenb">198</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">199</div><div class="codeline"><span class="comment"><span class="comment">%% (Ende) Danksagungen                                                        %%</span></span></div><div class="clear"></div>
<div class="linenb">200</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">201</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">202</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">203</div><div class="codeline">\tableofcontents</div><div class="clear"></div>
<div class="linenb">204</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">205</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">206</div><div class="codeline">\mainmatter</div><div class="clear"></div>
<div class="linenb">207</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">208</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">209</div><div class="codeline"><span class="comment"><span class="comment">%% Der Inhalt der Arbeit                                                      %%</span></span></div><div class="clear"></div>
<div class="linenb">210</div><div class="codeline"><span class="comment"><span class="comment">%%                                                                            %%</span></span></div><div class="clear"></div>
<div class="linenb">211</div><div class="codeline"><span class="comment"><span class="comment">%% Hier knnen Sie die schriftliche Ausarbeitung ihrer Arbeit                 %%</span></span></div><div class="clear"></div>
<div class="linenb">212</div><div class="codeline"><span class="comment"><span class="comment">%% niederschreiben. Der bersicht halber bietet sich jedoch an, dies in einer %%</span></span></div><div class="clear"></div>
<div class="linenb">213</div><div class="codeline"><span class="comment"><span class="comment">%% oder mehreren separaten Dateien zu tun, welche mittels \input eingebunden  %%</span></span></div><div class="clear"></div>
<div class="linenb">214</div><div class="codeline"><span class="comment"><span class="comment">%% werden --- wie auch in der Vorlage geschieht.                              %%</span></span></div><div class="clear"></div>
<div class="linenb">215</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">216</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">217</div><div class="codeline">\input{contents.tex}</div><div class="clear"></div>
<div class="linenb">218</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">219</div><div class="codeline"><span class="comment"><span class="comment">%% Dieser Part kann auskommentiert werden, sollte kein Anhang ntig sein</span></span></div><div class="clear"></div>
<div class="linenb">220</div><div class="codeline"><span class="comment"><span class="comment">% \appendix</span></span></div><div class="clear"></div>
<div class="linenb">221</div><div class="codeline"><span class="highlight-sh" title="If you are writing a research paper, do not force page breaks. [sh:nonp]"></span>\newpage</div><div class="clear"></div>
<div class="linenb">222</div><div class="codeline">\input{appendix.tex}</div><div class="clear"></div>
<div class="linenb">223</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">224</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">225</div><div class="codeline"><span class="comment"><span class="comment">%% (Ende) Der Inhalt der Arbeit                                               %%</span></span></div><div class="clear"></div>
<div class="linenb">226</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">227</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">228</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">229</div><div class="codeline">\backmatter</div><div class="clear"></div>
<div class="linenb">230</div><div class="codeline">\listoffigures</div><div class="clear"></div>
<div class="linenb">231</div><div class="codeline">\listoftables</div><div class="clear"></div>
<div class="linenb">232</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">233</div><div class="codeline">\clearpage</div><div class="clear"></div>
<div class="linenb">234</div><div class="codeline">\bibliography{references}</div><div class="clear"></div>
<div class="linenb">235</div><div class="codeline"><span class="comment"><span class="comment">%% Depending on Language, use german alphadin or original alpha</span></span></div><div class="clear"></div>
<div class="linenb">236</div><div class="codeline">\iflanguage{ngerman}{</div><div class="clear"></div>
<div class="linenb">237</div><div class="codeline">  \bibliographystyle{alphadin}</div><div class="clear"></div>
<div class="linenb">238</div><div class="codeline">}{</div><div class="clear"></div>
<div class="linenb">239</div><div class="codeline">  \bibliographystyle{alpha}</div><div class="clear"></div>
<div class="linenb">240</div><div class="codeline">}</div><div class="clear"></div>
<div class="linenb">241</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">242</div><div class="codeline"><span class="keyword2">\end{document}</span></div><div class="clear"></div>
</div>
<h2 class="filename">appendix.tex</h2>

<p>Found 0 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;1</div><div class="codeline"><span class="keyword1">\section</span>{Additional information}</div><div class="clear"></div>
<div class="linenb">&nbsp;2</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">&nbsp;3</div><div class="codeline"><span class="keyword2">\begin{table}</span>[h]</div><div class="clear"></div>
<div class="linenb">&nbsp;4</div><div class="codeline">  <span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">&nbsp;5</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">&nbsp;6</div><div class="codeline">    <span class="keyword2">\begin{tabular}</span>{@{}lllll@{}}</div><div class="clear"></div>
<div class="linenb">&nbsp;7</div><div class="codeline">      \toprule</div><div class="clear"></div>
<div class="linenb">&nbsp;8</div><div class="codeline">      Name        &amp; Author              &amp; URL (if available) \\ \midrule</div><div class="clear"></div>
<div class="linenb">&nbsp;9</div><div class="codeline">      Tetris      &amp; Felix Schoeller     &amp;             -  \\</div><div class="clear"></div>
<div class="linenb">10</div><div class="codeline">      Raytracer   &amp; Alex Quach          &amp; https://github.com/aquach/from-nand-to-raytracer   \\</div><div class="clear"></div>
<div class="linenb">11</div><div class="codeline">      GASchunky   &amp; Gavin Stewart       &amp; https://github.com/gav-/Nand2Tetris-Games\_and\_Demos  \\</div><div class="clear"></div>
<div class="linenb">12</div><div class="codeline">      GABoing     &amp; Gavin Stewart       &amp; https://github.com/gav-/Nand2Tetris-Games\_and\_Demos  \\</div><div class="clear"></div>
<div class="linenb">13</div><div class="codeline">      Hackenstein &amp; Quester Zen         &amp; https://github.com/QuesterZen/hackenstein3D  \\</div><div class="clear"></div>
<div class="linenb">14</div><div class="codeline">      Doom        &amp; Jona Leon Heywinkel &amp;             -  \\</div><div class="clear"></div>
<div class="linenb">15</div><div class="codeline">      *Raycaster  &amp; Julius Armbrster   &amp;             -  \\</div><div class="clear"></div>
<div class="linenb">16</div><div class="codeline">      Axis        &amp; Markus Brenneis     &amp;             -  \\</div><div class="clear"></div>
<div class="linenb">17</div><div class="codeline">      Brainhack   &amp; Markus Brenneis     &amp;             -  \\</div><div class="clear"></div>
<div class="linenb">18</div><div class="codeline">      Minesweeper &amp; Patrick Mller      &amp;             -  \\ \bottomrule</div><div class="clear"></div>
<div class="linenb">19</div><div class="codeline">    <span class="keyword2">\end{tabular}</span></div><div class="clear"></div>
<div class="linenb">20</div><div class="codeline">    \small</div><div class="clear"></div>
<div class="linenb">21</div><div class="codeline">    <span class="keyword1">\item</span> The project by Julius Armbrster did not have a name, so Raycaster was chosen to describe it</div><div class="clear"></div>
<div class="linenb">22</div><div class="codeline">    <span class="keyword1">\caption</span>{The VM programs tested on the new emulator implementation.}<span class="comment">%</span></div><div class="clear"></div>
<div class="linenb">23</div><div class="codeline">    <span class="keyword1">\label</span>{table:tested}</div><div class="clear"></div>
<div class="linenb">24</div><div class="codeline">  <span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">25</div><div class="codeline"><span class="keyword2">\end{table}</span></div><div class="clear"></div>
<div class="linenb">26</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">27</div><div class="codeline"><span class="keyword2">\begin{table}</span>[h]</div><div class="clear"></div>
<div class="linenb">28</div><div class="codeline">  <span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">29</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">30</div><div class="codeline">    <span class="keyword2">\begin{tabularx}</span>{\textwidth}{|l|X|X|}</div><div class="clear"></div>
<div class="linenb">31</div><div class="codeline">      \toprule</div><div class="clear"></div>
<div class="linenb">32</div><div class="codeline">      Segment        &amp; Purpose              &amp; Comments \\ \midrule</div><div class="clear"></div>
<div class="linenb">33</div><div class="codeline">      argument     &amp; Stores the function's arguments    &amp; Allocated dynamically by the VM implementation when the function is entered.  \\ \midrule</div><div class="clear"></div>
<div class="linenb">34</div><div class="codeline">      local     &amp; Stores the function's local variables  &amp; Allocated dynamically by the VM implementation and initialized to 0s when the function is entered.  \\ \midrule</div><div class="clear"></div>
<div class="linenb">35</div><div class="codeline">      static     &amp; Stores static variables shared by all functions in the same .vm le.  &amp; Allocated by the VM imp. for each .vm le; shared by all functions in the .vm le.  \\ \midrule</div><div class="clear"></div>
<div class="linenb">36</div><div class="codeline">      constant     &amp; Pseudo-segment that holds all the constants in the range 0...32767.  &amp; Emulated by the VM implementation; Seen by all the functions in the program.  \\ \midrule</div><div class="clear"></div>
<div class="linenb">37</div><div class="codeline">      this, that     &amp; General-purpose segments. Can be made to correspond to different areas in the heap. Serve various programming needs.  &amp; Any VM function can use these segments to manipulate selected areas on the heap.  \\ \midrule</div><div class="clear"></div>
<div class="linenb">38</div><div class="codeline">      pointer     &amp; A two-entry segment that holds the base addresses of the this and that segments.  &amp; Any VM function can set pointer 0 (or 1) to some address; this has the effect of aligning the this (or that) segment to the heap area beginning in that address.  \\ \midrule</div><div class="clear"></div>
<div class="linenb">39</div><div class="codeline">      temp     &amp; Fixed eight-entry segment that holds temporary variables for general use.  &amp; May be used by any VM function for any purpose. Shared by all functions in the program.  \\</div><div class="clear"></div>
<div class="linenb">40</div><div class="codeline">      \bottomrule</div><div class="clear"></div>
<div class="linenb">41</div><div class="codeline">    <span class="keyword2">\end{tabularx}</span></div><div class="clear"></div>
<div class="linenb">42</div><div class="codeline">    <span class="keyword1">\caption</span>{Every memory segment the Hack bytecode, taken from~\cite{nisan2005}.}</div><div class="clear"></div>
<div class="linenb">43</div><div class="codeline">    <span class="keyword1">\label</span>{table:segments}</div><div class="clear"></div>
<div class="linenb">44</div><div class="codeline">  <span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">45</div><div class="codeline"><span class="keyword2">\end{table}</span></div><div class="clear"></div>
<div class="linenb">46</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">47</div><div class="codeline">\cref{table:segments} was taken directly from the book accompanying the Nand to Tetris course~\cite{nisan2005}.</div><div class="clear"></div>
<div class="linenb">48</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">49</div><div class="codeline"><span class="keyword2">\begin{table}</span>[h]</div><div class="clear"></div>
<div class="linenb">50</div><div class="codeline">  <span class="keyword2">\begin{center}</span></div><div class="clear"></div>
<div class="linenb">51</div><div class="codeline">    \centering</div><div class="clear"></div>
<div class="linenb">52</div><div class="codeline">    <span class="keyword2">\begin{tabularx}</span>{\textwidth}{|l|X|X|}</div><div class="clear"></div>
<div class="linenb">53</div><div class="codeline">      \toprule</div><div class="clear"></div>
<div class="linenb">54</div><div class="codeline">      Dependency        &amp; Purpose              \\ \midrule</div><div class="clear"></div>
<div class="linenb">55</div><div class="codeline">      lazy\_static      &amp; Use statics with runtime initialization code. For example lookup hashmaps \\ \midrule</div><div class="clear"></div>
<div class="linenb">56</div><div class="codeline">      regex      &amp; Regular expressions in rust for simple parsing tasks \\ \midrule</div><div class="clear"></div>
<div class="linenb">57</div><div class="codeline">      wasm-bindgen      &amp; Generate JS bindings for Wasm code compiled from Rust \\ \midrule</div><div class="clear"></div>
<div class="linenb">58</div><div class="codeline">      web-sys      &amp; JS standard library bindings for Rust \\ \midrule</div><div class="clear"></div>
<div class="linenb">59</div><div class="codeline">      console\_error\_panic\_hook      &amp; Print the stack trace of a rust panic to the JS console \\ \midrule</div><div class="clear"></div>
<div class="linenb">60</div><div class="codeline">      wasm-pack      &amp; CLI to compile Rust to Wasm easier. Not a runtime dependency, just compile time \\ \midrule</div><div class="clear"></div>
<div class="linenb">61</div><div class="codeline">      SDL2      &amp; GUI framework. Originally for C, but also usable from Rust \\ \midrule</div><div class="clear"></div>
<div class="linenb">62</div><div class="codeline">      Clap      &amp; Parse CLI arguments \\</div><div class="clear"></div>
<div class="linenb">63</div><div class="codeline">      \bottomrule</div><div class="clear"></div>
<div class="linenb">64</div><div class="codeline">    <span class="keyword2">\end{tabularx}</span></div><div class="clear"></div>
<div class="linenb">65</div><div class="codeline">    <span class="keyword1">\caption</span>{Every dependency of the project.}</div><div class="clear"></div>
<div class="linenb">66</div><div class="codeline">    <span class="keyword1">\label</span>{table:dependencies}</div><div class="clear"></div>
<div class="linenb">67</div><div class="codeline">  <span class="keyword2">\end{center}</span></div><div class="clear"></div>
<div class="linenb">68</div><div class="codeline"><span class="keyword2">\end{table}</span></div><div class="clear"></div>
<div class="linenb">69</div><div class="codeline"><span class="comment"><span class="comment">% Hier knnen Sie Ihren Anhang definieren.</span></span></div><div class="clear"></div>
<div class="linenb">70</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">71</div><div class="codeline"><span class="comment"><span class="comment">% Achten Sie darauf, dass der Anhang in Ihrer \texttt{thesis.tex}</span></span></div><div class="clear"></div>
<div class="linenb">72</div><div class="codeline"><span class="comment"><span class="comment">% initial auskommentiert ist.</span></span></div><div class="clear"></div>
<div class="linenb">73</div><div class="codeline"><span class="comment"><span class="comment">% Der entsprechende Part befindet sich nahe dem Ende der Datei.</span></span></div><div class="clear"></div>
<div class="linenb">74</div><div class="codeline"><span class="comment"><span class="comment">% Entfernen Sie bei Bedarf die Kommentierung um den Anhang nutzen zu knnen.</span></span></div><div class="clear"></div>
<div class="linenb">75</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">76</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">77</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\section</span>{Nutzung}</span></span></div><div class="clear"></div>
<div class="linenb">78</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">79</div><div class="codeline"><span class="comment"><span class="comment">% Der Anhang wird wie die Abschnitte des Hauptteils der Arbeit gestaltet,</span></span></div><div class="clear"></div>
<div class="linenb">80</div><div class="codeline"><span class="comment"><span class="comment">% also mit \texttt{\textbackslash section} Befehlen.</span></span></div><div class="clear"></div>
<div class="linenb">81</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">82</div><div class="codeline"><span class="comment"><span class="comment">% <span class="keyword1">\subsection</span>{Unterabschnitte}</span></span></div><div class="clear"></div>
<div class="linenb">83</div><div class="codeline"><span class="comment"><span class="comment">% Die Verwendung von Unterabschnitten im Anhang</span></span></div><div class="clear"></div>
<div class="linenb">84</div><div class="codeline"><span class="comment"><span class="comment">% mittels \texttt{\textbackslash subsection}</span></span></div><div class="clear"></div>
<div class="linenb">85</div><div class="codeline"><span class="comment"><span class="comment">% funktioniert ebenfalls!</span></span></div><div class="clear"></div>
</div>
<h2 class="filename">contents.tex</h2>

<p>Found 0 warning(s)</p>
<div class="original-file">
<div class="linenb">&nbsp;1</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;2</div><div class="codeline"><span class="comment"><span class="comment">% Diese Datei beinhaltet den eigentlichen Inhalt Ihrer Arbeit.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;3</div><div class="codeline"><span class="comment"><span class="comment">%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;4</div><div class="codeline"><span class="comment"><span class="comment">% Es bietet sich der bersicht halber an, die einzelnen Abschnitte jeweils</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;5</div><div class="codeline"><span class="comment"><span class="comment">% in eigene Dateien zu schreiben und mittels \input einzubinden.</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;6</div><div class="codeline"><span class="comment"><span class="comment">% Eine mgliche Verzeichnisstruktur she entsprechend so aus:</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;7</div><div class="codeline"><span class="comment"><span class="comment">%</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;8</div><div class="codeline"><span class="comment"><span class="comment">% thesis/</span></span></div><div class="clear"></div>
<div class="linenb">&nbsp;9</div><div class="codeline"><span class="comment"><span class="comment">% +- tex/</span></span></div><div class="clear"></div>
<div class="linenb">10</div><div class="codeline"><span class="comment"><span class="comment">% |  +- introduction.tex</span></span></div><div class="clear"></div>
<div class="linenb">11</div><div class="codeline"><span class="comment"><span class="comment">% |  +- motivation.tex</span></span></div><div class="clear"></div>
<div class="linenb">12</div><div class="codeline"><span class="comment"><span class="comment">% |  +- experiments.tex</span></span></div><div class="clear"></div>
<div class="linenb">13</div><div class="codeline"><span class="comment"><span class="comment">% |  |  ...</span></span></div><div class="clear"></div>
<div class="linenb">14</div><div class="codeline"><span class="comment"><span class="comment">% |  +- conclusion.tex</span></span></div><div class="clear"></div>
<div class="linenb">15</div><div class="codeline"><span class="comment"><span class="comment">% +- abstract.tex</span></span></div><div class="clear"></div>
<div class="linenb">16</div><div class="codeline"><span class="comment"><span class="comment">% +- contents.tex</span></span></div><div class="clear"></div>
<div class="linenb">17</div><div class="codeline"><span class="comment"><span class="comment">% +- thesis.tex</span></span></div><div class="clear"></div>
<div class="linenb">18</div><div class="codeline"><span class="comment"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></div><div class="clear"></div>
<div class="linenb">19</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">20</div><div class="codeline"><span class="comment"><span class="comment">% TODO</span></span></div><div class="clear"></div>
<div class="linenb">21</div><div class="codeline"><span class="comment"><span class="comment">% important</span></span></div><div class="clear"></div>
<div class="linenb">22</div><div class="codeline"><span class="comment"><span class="comment">% [x] ehrenwrtliche erklrung unterschreiben</span></span></div><div class="clear"></div>
<div class="linenb">23</div><div class="codeline"><span class="comment"><span class="comment">% [x] table of bytecodes and segments + short explanation (problematic for 5.3.1)</span></span></div><div class="clear"></div>
<div class="linenb">24</div><div class="codeline"><span class="comment"><span class="comment">% [x] CPU besser erklren, auch unterschied CPU und VM (was ist mit assembly hier gemeint)</span></span></div><div class="clear"></div>
<div class="linenb">25</div><div class="codeline"><span class="comment"><span class="comment">% [x] sys.init ist nicht eigenleistung + nicht erklrt</span></span></div><div class="clear"></div>
<div class="linenb">26</div><div class="codeline"><span class="comment"><span class="comment">% [x] 5.2.2 welche emulator spezifischen instruktionen</span></span></div><div class="clear"></div>
<div class="linenb">27</div><div class="codeline"><span class="comment"><span class="comment">% [x] make explanation of bytecode representation (5.3.1) easier (maybe example with 3 different bytecodes in combination)</span></span></div><div class="clear"></div>
<div class="linenb">28</div><div class="codeline"><span class="comment"><span class="comment">% [x] bergang implementierung -&gt; entscheidungen rechtfertigen nicht klar</span></span></div><div class="clear"></div>
<div class="linenb">29</div><div class="codeline"><span class="comment"><span class="comment">% [x] pointer section in bytecode explanation nicht klar</span></span></div><div class="clear"></div>
<div class="linenb">30</div><div class="codeline"><span class="comment"><span class="comment">% [x] closure in macro nicht klar</span></span></div><div class="clear"></div>
<div class="linenb">31</div><div class="codeline"><span class="comment"><span class="comment">% [x] error handling auch nicht klar</span></span></div><div class="clear"></div>
<div class="linenb">32</div><div class="codeline"><span class="comment"><span class="comment">% [x] parser: methods vs predicate nicht klar</span></span></div><div class="clear"></div>
<div class="linenb">33</div><div class="codeline"><span class="comment"><span class="comment">% [x] welche der alternativen in 5 jetzt gewhlt</span></span></div><div class="clear"></div>
<div class="linenb">34</div><div class="codeline"><span class="comment"><span class="comment">% [x] klar den unterschied zwischen assembly, bytecode und scripts erklren</span></span></div><div class="clear"></div>
<div class="linenb">35</div><div class="codeline"><span class="comment"><span class="comment">% [x] verwendung der methoden im generic parser nicht erklrt, worauf hinaus?</span></span></div><div class="clear"></div>
<div class="linenb">36</div><div class="codeline"><span class="comment"><span class="comment">% [x] peekable ohne vorheriges beispiel sinnlos -&gt; lexer erklren</span></span></div><div class="clear"></div>
<div class="linenb">37</div><div class="codeline"><span class="comment"><span class="comment">% [x] was sind identifier in bytecode (5.4.3) -&gt; bild</span></span></div><div class="clear"></div>
<div class="linenb">38</div><div class="codeline"><span class="comment"><span class="comment">% [x] hohe indizes nutzen nicht verstanden (5.4.3)</span></span></div><div class="clear"></div>
<div class="linenb">39</div><div class="codeline"><span class="comment"><span class="comment">%</span></span></div><div class="clear"></div>
<div class="linenb">40</div><div class="codeline"><span class="comment"><span class="comment">% not important</span></span></div><div class="clear"></div>
<div class="linenb">41</div><div class="codeline"><span class="comment"><span class="comment">% [x] conclusions</span></span></div><div class="clear"></div>
<div class="linenb">42</div><div class="codeline"><span class="comment"><span class="comment">% [x] subsections should not be shorter than half a page</span></span></div><div class="clear"></div>
<div class="linenb">43</div><div class="codeline"><span class="comment"><span class="comment">% [x] token span in parser section</span></span></div><div class="clear"></div>
<div class="linenb">44</div><div class="codeline"><span class="comment"><span class="comment">% [x] hack vm erklren, bytecode (vielleicht mit stack bild)</span></span></div><div class="clear"></div>
<div class="linenb">45</div><div class="codeline"><span class="comment"><span class="comment">% [x] abstract Neu</span></span></div><div class="clear"></div>
<div class="linenb">46</div><div class="codeline"><span class="comment"><span class="comment">% [x] list of tested programs in appendix</span></span></div><div class="clear"></div>
<div class="linenb">47</div><div class="codeline"><span class="comment"><span class="comment">% [x] user manual in readme</span></span></div><div class="clear"></div>
<div class="linenb">48</div><div class="codeline"><span class="comment"><span class="comment">% [x] architektur schriftgre erhhen</span></span></div><div class="clear"></div>
<div class="linenb">49</div><div class="codeline"><span class="comment"><span class="comment">% [x] bilder an korrekte stellen (keine bilder und co section mehr)</span></span></div><div class="clear"></div>
<div class="linenb">50</div><div class="codeline"><span class="comment"><span class="comment">% [ ] write more about unit tests in compatability section</span></span></div><div class="clear"></div>
<div class="linenb">51</div><div class="codeline"><span class="comment"><span class="comment">% [ ] benchmarks: speed for web is very browser/os dependent</span></span></div><div class="clear"></div>
<div class="linenb">52</div><div class="codeline"><span class="comment"><span class="comment">% [ ] intro: existenzgrund der emulatoren besser erklren (vielleicht nicht wirklich andere bearbeitungs reihenfolge)</span></span></div><div class="clear"></div>
<div class="linenb">53</div><div class="codeline"><span class="comment"><span class="comment">% [ ] table for 3.2 (deps)</span></span></div><div class="clear"></div>
<div class="linenb">54</div><div class="codeline"><span class="comment"><span class="comment">% [ ] why not just fix the old emulator, why is my emulator more future proof?</span></span></div><div class="clear"></div>
<div class="linenb">55</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">56</div><div class="codeline"><span class="comment"><span class="comment">% Feedback</span></span></div><div class="clear"></div>
<div class="linenb">57</div><div class="codeline"><span class="comment"><span class="comment">% [x] simplify explanation: error handling &amp; macros</span></span></div><div class="clear"></div>
<div class="linenb">58</div><div class="codeline"><span class="comment"><span class="comment">% [ ] rewrite sys.wait to return 1 as the second state or refer to the code</span></span></div><div class="clear"></div>
<div class="linenb">59</div><div class="codeline"><span class="comment"><span class="comment">% [ ] explain dynamic dispatch (maybe glossary)</span></span></div><div class="clear"></div>
<div class="linenb">60</div><div class="codeline"><span class="comment"><span class="comment">% [ ] intro to 6 and 7 is too similar</span></span></div><div class="clear"></div>
<div class="linenb">61</div><div class="codeline"><span class="comment"><span class="comment">% [x] explain hack archicture</span></span></div><div class="clear"></div>
<div class="linenb">62</div><div class="codeline"><span class="comment"><span class="comment">% [x] the term absolute jump may not be known to everyone</span></span></div><div class="clear"></div>
<div class="linenb">63</div><div class="codeline">&nbsp;</div><div class="clear"></div>
<div class="linenb">64</div><div class="codeline">\input{tex/intro.tex}</div><div class="clear"></div>
<div class="linenb">65</div><div class="codeline">\input{tex/technologies.tex}</div><div class="clear"></div>
<div class="linenb">66</div><div class="codeline">\input{tex/related.tex}</div><div class="clear"></div>
<div class="linenb">67</div><div class="codeline">\input{tex/hack.tex}</div><div class="clear"></div>
<div class="linenb">68</div><div class="codeline">\input{tex/implementation.tex}</div><div class="clear"></div>
<div class="linenb">69</div><div class="codeline">\input{tex/evaluation.tex}</div><div class="clear"></div>
<div class="linenb">70</div><div class="codeline">\input{tex/conclusions.tex}</div><div class="clear"></div>
</div>
<hr/>
Output produced by TeXtidote v0.8.2, &copy; 2018-2020 Sylvain Hall&eacute; - All rights reserved.<br/>
See the <a href="https://sylvainhalle.github.io/textidote">TeXtidote website</a> for more information.
</body>
</html>
